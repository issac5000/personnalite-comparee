<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personnalité Comparée | Test MBTI & Ennéagramme Gratuit</title>

  <!-- Supabase JS -->

  <!-- SEO Meta Tags -->
  <meta name="description" content="Découvrez votre vraie personnalité avec notre test MBTI et Ennéagramme gratuit. Analyse objective combinant votre auto-évaluation et l'avis de vos proches.">
  <meta name="keywords" content="test personnalité, MBTI, ennéagramme, psychologie, 16 types, auto-évaluation, gratuit">
  <meta name="author" content="Personnalité Comparée">
  <meta name="robots" content="index, follow">


  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:title" content="Personnalité Comparée | Test MBTI & Ennéagramme Gratuit">
  <meta property="og:description" content="Découvrez votre vraie personnalité avec notre test MBTI et Ennéagramme gratuit. Analyse objective combinant votre auto-évaluation et l'avis de vos proches.">
    <meta property="og:image" content="logo.jpg">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="Personnalité Comparée | Test MBTI & Ennéagramme Gratuit">
    <meta property="twitter:description" content="Découvrez votre vraie personnalité avec notre test MBTI et Ennéagramme gratuit. Analyse objective combinant votre auto-évaluation et l'avis de vos proches.">
      <meta property="twitter:image" content="logo.jpg">
    
    <!-- Favicon -->
      <link rel="icon" type="image/jpeg" href="logo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS library -->
   
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .question-card {
            min-height: 300px;
        }
        .floating-btn {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .personality-badge {
            border-radius: 50px;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* Styles pour les modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .close {
            color: #9ca3af;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .close:hover,
        .close:focus {
            color: #374151;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .mobile-menu {
            display: block;
        }
        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .question-container {
            display: none;
        }
        .question-container.active {
            display: block;
        }
        
        /* Menu mobile caché par défaut */
        .mobile-menu {
            display: none;
        }
    </style>

</head>
<body class="font-sans bg-white text-gray-900">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <img src="logo111.png" alt="Personnalité Comparée logo" class="w-10 h-10 rounded-full object-cover">
<span class="ml-3 text-xl font-bold text-black">Personnalité Comparée</span>
                    </div>
                </div>
                <div class="desktop-nav hidden md:ml-6 md:flex md:items-center md:space-x-8">
                    <a href="#" class="text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-blue-500 text-sm font-medium">Accueil</a>
                    <a href="#mbti" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">MBTI</a>
                    <a href="#enneagram" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">Ennéagramme</a>
                    <a href="#profil-chatbot" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">IA spécialisée</a>
                    <a href="#faq" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">FAQ</a>
                    <button id="profile-btn-desktop" onclick="openProfileModal()" class="ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Mon profil
                    </button>
                </div>
                <div class="-mr-2 flex items-center md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Ouvrir le menu principal</span>
                        <i class="fas fa-bars" id="menu-icon"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Menu mobile -->
        <div class="mobile-menu md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white border-t border-gray-200">
                <a href="#" class="text-gray-900 block px-3 py-2 rounded-md text-base font-medium bg-blue-50">Accueil</a>
                <a href="#mbti" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">MBTI</a>
                <a href="#enneagram" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">Ennéagramme</a>
                <a href="#profil-chatbot" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">IA spécialisée</a>
                <a href="#faq" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">FAQ</a>
                <button id="profile-btn-mobile" onclick="openProfileModal()" class="w-full mt-2 inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                    Mon profil
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section Premium -->
    <div class="relative flex items-center justify-center overflow-hidden bg-gradient-to-br from-gray-50 via-white to-blue-50/30" style="min-height: 80vh;">
        <!-- Grille subtile en arrière-plan -->
        <div class="absolute inset-0 opacity-[0.02]">
            <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, rgb(15 23 42) 1px, transparent 0); background-size: 40px 40px;"></div>
        </div>
        
        <!-- Éléments géométriques minimalistes -->
        <div class="absolute top-1/4 right-1/4 w-2 h-2 bg-blue-400/20 rounded-full"></div>
        <div class="absolute bottom-1/3 left-1/5 w-1 h-1 bg-slate-400/30 rounded-full"></div>
        <div class="absolute top-2/3 right-1/3 w-1.5 h-1.5 bg-blue-300/25 rounded-full"></div>
        
        <div class="relative max-w-5xl mx-auto px-6 py-16 text-center">
<img src="nouveau logo.JPEG" alt="Nouveau logo" class="mx-auto mb-8 w-28 sm:w-32 h-auto">
            
            <!-- Titre principal avec hiérarchie claire -->
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-semibold tracking-tight text-slate-900 mb-6 leading-tight">
                Et si vous vous connaissiez
                <br>
                <span class="text-blue-600 font-medium"><strong>vraiment</strong></span> ?
            </h1>
            
            <!-- Sous-titre épuré -->
   <p class="max-w-2xl mx-auto text-lg md:text-xl text-slate-600 leading-relaxed mb-12 font-light">
    La première plateforme qui combine 
    <span class="font-medium text-slate-800">test MBTI</span> & <span class="font-medium text-slate-800">Ennéagramme</span>, 
    validation par l’entourage et <span class="font-medium text-slate-800">IA spécialisée</span> pour répondre à toutes vos questions.
</p>
            
            <!-- Boutons premium -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-12">
                <a href="#auto-evaluation" class="group relative inline-flex items-center gap-3 px-8 py-4 text-base font-medium text-white bg-slate-900 hover:bg-slate-800 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl">
                    <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Commencer l'analyse
                    <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
                
                <a href="#evaluation-proche" class="group inline-flex items-center gap-3 px-8 py-4 text-base font-medium text-slate-700 bg-white hover:bg-slate-50 border border-slate-200 hover:border-slate-300 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md">
                    <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    Évaluer quelqu'un
                </a>
            </div>
            
            <!-- Indicateurs de confiance intégrés discrètement -->
            <div class="flex items-center justify-center gap-8 text-sm text-slate-500">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                    <span>16 profils MBTI</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                    <span>9 types Ennéagramme</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                    <span>Validation par les proches</span>
                </div>
            </div>
        </div>
        
        
    </div>

    <!-- How it works -->
    <div class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Comment ça marche ?
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    Une approche innovante pour une analyse plus objective de votre personnalité
                </p>
            </div>
            <div class="mt-20">
                <div class="grid grid-cols-1 gap-12 md:grid-cols-3">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-user text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>1. Auto-évaluation</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                Répondez à 16 questions simples pour établir votre propre perception de votre personnalité.
                            </p>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>2. Évaluation par 3 proches</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                Partagez votre code unique avec 3 personnes de votre entourage qui répondront à 20 questions.
                            </p>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-chart-pie text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>3. Profil complet</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                Recevez une analyse pondérée combinant votre auto-évaluation et les évaluations de vos proches.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-evaluation Section -->
    <div id="auto-evaluation" class="bg-gray-50 py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Auto-évaluation
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Répondez à ces 16 questions pour commencer votre analyse
                </p>
            </div>
            
            <!-- Question Cards Container -->
            <div id="questions-container" class="mt-12">
                <!-- Questions will be dynamically inserted here -->
            </div>
            
            <!-- Navigation buttons -->
            <div class="mt-8 flex justify-between">
                <button id="prev-question" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" style="display: none;">
                    <i class="fas fa-arrow-left mr-2"></i> Question précédente
                </button>
                <button id="next-question" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Question suivante <i class="fas fa-arrow-right ml-2"></i>
                </button>
                <button id="finish-test" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                    Terminer le test <i class="fas fa-check ml-2"></i>
                </button>
            </div>
        </div>
    </div>


    <!-- Evaluate a friend Section -->
    <div id="evaluation-proche" class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Évaluer un proche
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Aidez un ami, un membre de votre famille ou un collègue à mieux comprendre sa personnalité
                </p>
            </div>
            
            <div class="mt-12 bg-gray-50 rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-8">
                    <form id="evaluation-form">
                        <div class="mb-6">
                            <label for="code" class="block text-sm font-medium text-gray-700">Code unique de la personne</label>
                            <div class="mt-1 relative rounded-md shadow-sm">
                                <input type="text" name="code" id="code" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-4 pr-12 py-3 sm:text-sm border-gray-300 rounded-md" placeholder="Ex: ABC123" required>
                                <div class="absolute inset-y-0 right-0 flex items-center">
                                    <button type="button" id="search-code" class="h-full rounded-r-md border-transparent bg-gray-100 px-4 text-blue-600 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">Entrez le code que votre proche vous a communiqué</p>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Votre relation avec cette personne</label>
                            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="family" name="relation" type="radio" value="family" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300" required>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="family" class="font-medium text-gray-700">Membre de la famille</label>
                                        <p class="text-gray-500">Parent, frère, sœur, enfant...</p>
                                    </div>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="partner" name="relation" type="radio" value="partner" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300" required>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="partner" class="font-medium text-gray-700">Partenaire amoureux</label>
                                        <p class="text-gray-500">Conjoint, petit(e) ami(e)...</p>
                                    </div>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="friend" name="relation" type="radio" value="friend" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300" required>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="friend" class="font-medium text-gray-700">Ami(e)</label>
                                        <p class="text-gray-500">Ami proche, meilleur ami...</p>
                                    </div>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="colleague" name="relation" type="radio" value="colleague" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300" required>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="colleague" class="font-medium text-gray-700">Collègue de travail</label>
                                        <p class="text-gray-500">Collègue, manager, collaborateur...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center">
                            <button type="button" onclick="startExternalEvaluation()" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Commencer l'évaluation <i class="fas fa-play ml-2"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Section -->
    <section id="profil-chatbot" class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Parler avec Psycho'Bot</h2>
                <p class="mt-4 text-xl text-gray-500">Discutez avec notre assistant IA pour en savoir plus sur les profils MBTI et Ennéagramme.</p>
            </div>
            <div class="mt-8">
                <div id="chat-box" class="h-64 overflow-y-auto border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50"></div>
                <div class="flex">
                    <input id="chat-input" type="text" placeholder="Posez votre question..." class="flex-grow px-4 py-2 border border-gray-300 rounded-l-md focus:ring-blue-500 focus:border-blue-500">
                    <button id="chat-send" class="px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700">Envoyer</button>
                </div>
            </div>
        </div>
    </section>

    <section id="retourver-profil" class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
          <div class="text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl flex justify-center items-center gap-2">
              <i class="fas fa-search text-blue-500 animate-pulse"></i>
              Retrouver un profil
            </h2>
            <p class="mt-4 text-xl text-gray-500">
              Saisis le code unique que tu as reçu pour afficher un profil complet.
            </p>
          </div>
          <form onsubmit="event.preventDefault(); afficherProfilUtilisateur();" autocomplete="off" class="mt-12 max-w-lg mx-auto">
            <div class="flex flex-col sm:flex-row items-center gap-4">
              <label for="code-saisi" class="sr-only">Code reçu</label>
              <input type="text" id="code-saisi" class="flex-1 px-6 py-3 border border-gray-200 rounded-lg focus:ring-blue-500 focus:border-blue-500 placeholder:text-gray-300 text-base text-center shadow-sm transition" placeholder="ABC123" maxlength="12" required>
              <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">
                <i class="fas fa-eye"></i> Voir le profil
              </button>
            </div>
            <div id="profil-resultat" class="mt-8 text-gray-800 text-base leading-relaxed transition-all duration-300"></div>
          </form>
        </div>
      </section>

    <!-- MBTI Types Section -->
    <div id="mbti" class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Les 16 types de personnalité MBTI
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    Découvrez les différents profils de la typologie Myers-Briggs
                </p>
            </div>
            
            <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Analystes (NT) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Architecte</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Visionnaires stratégiques avec un plan pour tout. Indépendants et déterminés à atteindre leurs objectifs.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Commandant</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Leaders naturels, charismatiques et déterminés. Excellents pour organiser et mettre en œuvre des plans.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                                <i class="fas fa-microscope text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INTP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Penseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Penseurs logiques et créatifs, toujours à la recherche de nouvelles idées et possibilités théoriques.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Diplomates (NF) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                                <i class="fas fa-lightbulb text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Donateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Charismatiques et empathiques, motivés par le désir d'aider les autres à réaliser leur potentiel.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-500 rounded-md p-3">
                                <i class="fas fa-heart text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Inspirateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Enthousiastes, créatifs et sociables, toujours à la recherche de nouvelles idées et expériences.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-teal-500 rounded-md p-3">
                                <i class="fas fa-dove text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Avocat</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Idéalistes créatifs et perspicaces, motivés par leurs valeurs profondes et leur vision du futur.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-pink-500 rounded-md p-3">
                                <i class="fas fa-palette text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INFP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Médiateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Poétiques, gentils et altruistes, toujours désireux d'aider une bonne cause ou une personne importante.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sentinelles (SJ) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-gray-600 rounded-md p-3">
                                <i class="fas fa-balance-scale text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Logisticien</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Pratiques et factuels, fiables et responsables. Ils aiment l'ordre et respectent les traditions.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-orange-500 rounded-md p-3">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Protecteur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Chaleureux et consciencieux, toujours prêts à protéger leurs proches et à maintenir l'harmonie.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-600 rounded-md p-3">
                                <i class="fas fa-bullhorn text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Exécutif</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Excellents administrateurs, incomparables pour gérer les choses et les personnes avec efficacité.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-600 rounded-md p-3">
                                <i class="fas fa-hands-helping text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Consul</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Extraordinairement attentionnés, sociables et populaires, toujours désireux d'aider les autres.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Explorateurs (SP) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-yellow-600 rounded-md p-3">
                                <i class="fas fa-tools text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISTP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Virtuose</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Mécaniciens audacieux et pratiques, maîtres de tous les types d'outils et de techniques.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-600 rounded-md p-3">
                                <i class="fas fa-music text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Aventurier</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Artistes flexibles et charmants, toujours prêts à explorer de nouvelles possibilités créatives.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-600 rounded-md p-3">
                                <i class="fas fa-rocket text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESTP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Entrepreneur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Intelligents, énergiques et très perceptifs, vraiment appréciés pour leur spontanéité et leur humour.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-pink-600 rounded-md p-3">
                                <i class="fas fa-theater-masks text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Amuseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Spontanés, énergiques et enthousiastes, la vie n'est jamais ennuyeuse autour d'eux.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Enneagram Types Section -->
    <div id="enneagram" class="bg-gray-50 py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Les 9 types de l'Ennéagramme
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    Découvrez les motivations profondes qui influencent votre personnalité
                </p>
            </div>
            
            <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                <!-- Type 1 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">1</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Perfectionniste</h3>
                                <p class="text-sm text-gray-500">Le Réformateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de vivre correctement, d'améliorer le monde et d'éviter la colère. Ils sont idéalistes, responsables et ont un fort sens moral.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être corrompu, défectueux ou mauvais<br>
                                <strong>Désir fondamental :</strong> Être bon, vertueux et parfait
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('1')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 2 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">2</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Altruiste</h3>
                                <p class="text-sm text-gray-500">L'Aidant</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin d'être aimés et appréciés, et d'exprimer leurs sentiments positifs envers les autres. Ils sont empathiques, sincères et chaleureux.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être indigne d'amour<br>
                                <strong>Désir fondamental :</strong> Se sentir aimé et apprécié
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('2')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 3 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-yellow-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">3</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Bâtisseur</h3>
                                <p class="text-sm text-gray-500">Le Performeur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin d'être productifs, d'atteindre le succès et d'éviter l'échec. Ils sont adaptables, ambitieux et orientés vers les objectifs.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être sans valeur en dehors de leurs réalisations<br>
                                <strong>Désir fondamental :</strong> Se sentir valorisé et digne d'amour
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('3')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 4 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">4</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Artiste</h3>
                                <p class="text-sm text-gray-500">L'Individualiste</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de s'exprimer et d'être compris pour qui ils sont vraiment. Ils sont créatifs, émotionnellement honnêtes et personnels.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> N'avoir ni identité ni importance personnelle<br>
                                <strong>Désir fondamental :</strong> Trouver leur vrai moi et leur importance
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('4')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 5 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">5</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Investigateur</h3>
                                <p class="text-sm text-gray-500">Le Penseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de comprendre le monde qui les entoure. Ils sont intenses, cérébraux, perceptifs et indépendants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être inutile, incapable ou envahi<br>
                                <strong>Désir fondamental :</strong> Être compétent et comprendre l'environnement
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('5')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 6 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">6</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Loyaliste</h3>
                                <p class="text-sm text-gray-500">Le Sceptique</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de sécurité et de soutien. Ils sont engagés, responsables, anxieux et soupçonneux.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être sans soutien ou sans guidance<br>
                                <strong>Désir fondamental :</strong> Avoir sécurité et soutien
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('6')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 7 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-orange-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">7</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Enthousiaste</h3>
                                <p class="text-sm text-gray-500">L'Épicurien</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de maintenir leur bonheur et leur enthousiasme. Ils sont spontanés, polyvalents, distractibles et dispersés.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être piégé dans la douleur ou la privation<br>
                                <strong>Désir fondamental :</strong> Maintenir leur bonheur et leur satisfaction
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('7')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 8 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">8</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Challenger</h3>
                                <p class="text-sm text-gray-500">Le Protecteur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin d'être autonomes et de contrôler leur propre vie. Ils sont puissants, dominants, confiants et confrontants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Être contrôlé ou vulnérable aux autres<br>
                                <strong>Désir fondamental :</strong> Être autonome et contrôler leur propre vie
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('8')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 9 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-teal-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">9</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Médiateur</h3>
                                <p class="text-sm text-gray-500">Le Pacificateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motivés par le besoin de maintenir leur paix intérieure et extérieure. Ils sont réceptifs, rassurants, agréables et complaisants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Perte de connexion et fragmentation<br>
                                <strong>Désir fondamental :</strong> Maintenir leur paix intérieure et extérieure
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('9')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- FAQ Section -->
    <div id="faq" class="bg-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Questions fréquentes
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Trouvez des réponses aux questions les plus courantes
                </p>
            </div>
            
            <div class="mt-12 space-y-6">
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Comment fonctionne le système de pondération ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                Votre auto-évaluation compte pour 10% du résultat final. Les évaluations de vos proches comptent pour 90%, réparties comme suit : 35% pour un membre de votre famille, 35% pour votre partenaire amoureux, et 10% chacun pour un ami et un collègue. Cette pondération permet d'obtenir une vision plus objective de votre personnalité.
                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Combien de temps faut-il pour compléter les tests ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                L'auto-évaluation prend environ 5-10 minutes (16 questions). L'évaluation d'un proche prend environ 10-15 minutes (20 questions). Vous pouvez sauvegarder et reprendre plus tard si nécessaire.
                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Puis-je voir les résultats partiels avant d'avoir toutes les évaluations ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                Non, pour garantir l'objectivité des résultats, le profil complet n'est généré qu'une fois que vous avez complété votre auto-évaluation et que 3 proches ont complété leur évaluation. Vous recevrez une notification par email lorsque votre profil sera prêt.
                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Comment est calculé le score de certitude ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                Le score de certitude (en %) reflète le degré de convergence entre votre auto-évaluation et les retours de vos proches. Plus les évaluations s'accordent sur un même profil, plus ce score augmente, sans jamais dépasser 95%.
                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Mes données sont-elles sécurisées ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                Absolument. Toutes vos données sont chiffrées et stockées de manière sécurisée. Nous ne partageons jamais vos informations personnelles avec des tiers. Vous pouvez supprimer votre profil à tout moment depuis votre espace personnel.
                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Que faire si mes proches ne répondent pas ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
                                Vous pouvez envoyer des rappels automatiques depuis votre tableau de bord. Si certaines personnes ne peuvent pas participer, vous pouvez remplacer leur évaluation par celle d'autres proches. Le système s'adapte automatiquement à la pondération disponible.
                            </p>
                        </div>
                    </button>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <p class="text-gray-600">
                    Vous avez d'autres questions ? <a href="#" class="text-blue-600 hover:text-blue-500 font-medium">Contactez-nous</a>
                </p>
            </div>
        </div>
    </div>

    <!-- About Section -->
    <div class="bg-gradient-to-br from-gray-50 via-white to-blue-50/30 py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                À propos du projet
            </h2>
            <p class="mt-6 text-lg text-gray-600">
                "Personnalité Comparée" est né de la volonté de créer un outil plus objectif pour comprendre sa personnalité. Contrairement aux tests traditionnels qui reposent uniquement sur l'auto-évaluation, notre approche combine votre perception avec celle de votre entourage pour un résultat plus nuancé et fidèle.
            </p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-eye text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Vision objective</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Combiner plusieurs perspectives pour une analyse plus complète
                    </p>
                </div>
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-shield-alt text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Confidentialité</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Vos données sont protégées et ne sont jamais partagées
                    </p>
                </div>
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-graduation-cap text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Base scientifique</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Fondé sur les recherches en psychologie de la personnalité
                    </p>
                </div>
            </div>
            <div class="mt-8">
                <button onclick="showAboutProject()" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    En savoir plus sur le concept <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Personnalité Comparée</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Accueil</a></li>
                        <li><a href="#mbti" class="text-base text-gray-300 hover:text-white transition-colors">MBTI</a></li>
                        <li><a href="#enneagram" class="text-base text-gray-300 hover:text-white transition-colors">Ennéagramme</a></li>
                        <li><a href="#faq" class="text-base text-gray-300 hover:text-white transition-colors">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Tests</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#auto-evaluation" class="text-base text-gray-300 hover:text-white transition-colors">Auto-évaluation</a></li>
                        <li><a href="#evaluation-proche" class="text-base text-gray-300 hover:text-white transition-colors">Évaluer un proche</a></li>
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Mon profil</a></li>
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Mes résultats</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Légal</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" onclick="showPrivacyPolicy(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Confidentialité</a></li>
                        <li><a href="#" onclick="showTermsOfService(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Conditions d'utilisation</a></li>
                        <li><a href="#" onclick="showLegalNotices(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Mentions légales</a></li>
                        <li><a href="#" onclick="showLegalNotices(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Cookies</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Contact</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" onclick="showContact(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Nous contacter</a></li>
                        <li><a href="#" onclick="showContact(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Support</a></li>
                        <li class="flex space-x-6 pt-2">
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">Facebook</span>
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">Instagram</span>
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">TikTok</span>
                                <i class="fab fa-tiktok"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 md:flex md:items-center md:justify-between">
                <div class="flex space-x-6 md:order-2">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">Facebook</span>
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">Instagram</span>
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">TikTok</span>
                        <i class="fab fa-tiktok"></i>
                    </a>
                </div>
                <p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">
                    &copy; 2025 Personnalité Comparée. Tous droits réservés.
                </p>
            </div>
        </div>
    </footer>

   
      
    <script>
        // Configuration et données
        const QUESTIONS_AUTO_EVALUATION = [
            
            {
                id: 1,
                question: "Dans une soirée, vous êtes plutôt :",
                options: [
                    { text: "Au centre de l'attention, à animer la conversation", mbti: { E: 3 }, enneagram: { 3: 2, 7: 1, 8: 1 } },
                    { text: "À discuter en petit groupe avec des personnes que vous connaissez", mbti: { E: 1 }, enneagram: { 2: 2, 9: 1 } },
                    { text: "À observer les autres et à ne parler qu'avec une ou deux personnes", mbti: { I: 2 }, enneagram: { 4: 1, 5: 2, 6: 1 } },
                    { text: "À chercher un moyen de partir discrètement", mbti: { I: 3 }, enneagram: { 5: 2, 9: 1 } }
                ]
            },
            {
                id: 2,
                question: "Quand vous devez prendre une décision importante, vous :",
                options: [
                    { text: "Analysez tous les faits et données disponibles", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "Écoutez votre intuition et vos sentiments", mbti: { F: 3, P: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Demandez conseil à plusieurs personnes de confiance", mbti: { F: 2 }, enneagram: { 2: 1, 6: 2, 9: 1 } },
                    { text: "Pesez rapidement le pour et le contre puis agissez", mbti: { T: 2, J: 2 }, enneagram: { 3: 2, 8: 2 } }
                ]
            },
            {
                id: 3,
                question: "Votre espace de travail idéal est :",
                options: [
                    { text: "Parfaitement organisé avec chaque chose à sa place", mbti: { J: 3, S: 1 }, enneagram: { 1: 3 } },
                    { text: "Créatif et inspirant, même si un peu désordonné", mbti: { P: 2, N: 2 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Fonctionnel et pratique avant tout", mbti: { S: 2, T: 1 }, enneagram: { 3: 1, 5: 1, 8: 1 } },
                    { text: "Chaleureux et accueillant pour recevoir des collègues", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } }
                ]
            },
            {
                id: 4,
                question: "Face à un conflit, votre première réaction est de :",
                options: [
                    { text: "Confronter directement le problème", mbti: { T: 2, E: 1 }, enneagram: { 8: 3, 1: 1 } },
                    { text: "Chercher un compromis qui satisfait tout le monde", mbti: { F: 2 }, enneagram: { 2: 1, 9: 3 } },
                    { text: "Prendre du recul pour analyser la situation", mbti: { I: 2, T: 1 }, enneagram: { 5: 3, 6: 1 } },
                    { text: "Éviter le conflit si possible", mbti: { F: 1, I: 1 }, enneagram: { 4: 1, 9: 2 } }
                ]
            },
            {
                id: 5,
                question: "Vous vous sentez le plus énergisé quand vous :",
                options: [
                    { text: "Interagissez avec beaucoup de personnes différentes", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Travaillez seul sur un projet qui vous passionne", mbti: { I: 3 }, enneagram: { 4: 2, 5: 2 } },
                    { text: "Aidez quelqu'un à résoudre ses problèmes", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } },
                    { text: "Relevez un défi stimulant", mbti: { N: 1, T: 1 }, enneagram: { 3: 2, 8: 2 } }
                ]
            },
            {
                id: 6,
                question: "Votre approche de la planification est :",
                options: [
                    { text: "Planifier chaque détail à l'avance", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Avoir une idée générale et improviser", mbti: { P: 3, N: 1 }, enneagram: { 7: 2, 9: 1 } },
                    { text: "Planifier les grandes étapes seulement", mbti: { N: 2, J: 1 }, enneagram: { 3: 2, 5: 1 } },
                    { text: "Préférer la spontanéité totale", mbti: { P: 3 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 7,
                question: "Quand vous apprenez quelque chose de nouveau, vous préférez :",
                options: [
                    { text: "Comprendre d'abord la théorie puis pratiquer", mbti: { N: 2, T: 1 }, enneagram: { 5: 3 } },
                    { text: "Apprendre en faisant, par l'expérience", mbti: { S: 3, P: 1 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "Avoir quelqu'un qui vous guide étape par étape", mbti: { S: 2, F: 1 }, enneagram: { 2: 1, 6: 2 } },
                    { text: "Explorer librement et découvrir par vous-même", mbti: { N: 2, P: 2 }, enneagram: { 4: 2, 7: 1 } }
                ]
            },
            {
                id: 8,
                question: "Votre plus grande motivation au travail est :",
                options: [
                    { text: "Atteindre l'excellence et la perfection", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "Aider les autres et faire une différence", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Réussir et être reconnu pour vos accomplissements", mbti: { E: 1, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Exprimer votre créativité et votre authenticité", mbti: { N: 2, F: 1 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 9,
                question: "Face à l'incertitude, vous :",
                options: [
                    { text: "Cherchez à obtenir plus d'informations", mbti: { T: 2, J: 1 }, enneagram: { 5: 2, 6: 2 } },
                    { text: "Faites confiance à votre instinct", mbti: { N: 2, F: 1 }, enneagram: { 4: 1, 7: 1, 8: 1 } },
                    { text: "Vous sentez anxieux et cherchez du soutien", mbti: { F: 2 }, enneagram: { 6: 3 } },
                    { text: "Voyez cela comme une aventure excitante", mbti: { P: 2, N: 1 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 10,
                question: "Votre style de communication est :",
                options: [
                    { text: "Direct et factuel", mbti: { T: 3, S: 1 }, enneagram: { 1: 1, 8: 2 } },
                    { text: "Chaleureux et personnel", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Imaginatif et métaphorique", mbti: { N: 3 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Diplomate et nuancé", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 11,
                question: "Votre plus grande peur est :",
                options: [
                    { text: "De faire des erreurs ou d'être imparfait", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "De ne pas être aimé ou apprécié", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } },
                    { text: "D'échouer ou d'être sans valeur", mbti: { T: 1, E: 1 }, enneagram: { 3: 3 } },
                    { text: "De perdre votre identité unique", mbti: { N: 2, F: 1 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 12,
                question: "Dans un groupe, vous êtes naturellement :",
                options: [
                    { text: "Le leader qui organise et dirige", mbti: { E: 2, J: 2 }, enneagram: { 3: 2, 8: 2 } },
                    { text: "Celui qui veille au bien-être de chacun", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "L'observateur qui analyse la dynamique", mbti: { I: 2, T: 1 }, enneagram: { 5: 3 } },
                    { text: "Le médiateur qui maintient l'harmonie", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 13,
                question: "Votre rapport au temps est :",
                options: [
                    { text: "Très structuré, vous respectez toujours les horaires", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Flexible, vous vous adaptez aux circonstances", mbti: { P: 3 }, enneagram: { 7: 2, 9: 1 } },
                    { text: "Orienté vers les objectifs et les échéances", mbti: { J: 2, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Vous perdez facilement la notion du temps", mbti: { P: 2, N: 1 }, enneagram: { 4: 1, 7: 1 } }
                ]
            },
            {
                id: 14,
                question: "Votre environnement idéal pour réfléchir est :",
                options: [
                    { text: "Un endroit calme et silencieux", mbti: { I: 3 }, enneagram: { 5: 2, 9: 1 } },
                    { text: "Entouré de personnes stimulantes", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Dans la nature ou un cadre inspirant", mbti: { N: 2, F: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Un espace organisé avec vos outils", mbti: { S: 2, J: 1 }, enneagram: { 1: 2, 5: 1 } }
                ]
            },
            {
                id: 15,
                question: "Face au changement, vous :",
                options: [
                    { text: "Résistez et préférez la stabilité", mbti: { S: 2, J: 2 }, enneagram: { 1: 1, 6: 2 } },
                    { text: "L'embrassez avec enthousiasme", mbti: { N: 2, P: 2 }, enneagram: { 7: 3 } },
                    { text: "L'analysez soigneusement avant d'accepter", mbti: { T: 2, I: 1 }, enneagram: { 5: 2, 6: 1 } },
                    { text: "Vous adaptez naturellement", mbti: { P: 2, F: 1 }, enneagram: { 3: 1, 9: 2 } }
                ]
            },
            {
                id: 16,
                question: "Votre définition du succès est :",
                options: [
                    { text: "Faire les choses correctement et sans erreur", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "Être utile et apprécié par les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Atteindre vos objectifs et être reconnu", mbti: { E: 1, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Rester fidèle à vous-même et vos valeurs", mbti: { F: 2, I: 1 }, enneagram: { 4: 2, 9: 1 } }
                ]
            }
        ];
        // Récupère les questions externes depuis Supabase si l'utilisateur est un proche
let questions = QUESTIONS_AUTO_EVALUATION;
// 🔐 Génére un code aléatoire
function genererUniqueCode() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code = "";
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

// 🔄 Envoie vers Supabase
async function enregistrerQuestionsPourProches(questionsAutoEvaluation, userCode) {
  // Mettre à jour l'enregistrement existant avec les questions pour les proches
  const { data, error } = await supabase
    .from("users")
    .update({
      external_questions: questionsAutoEvaluation
    })
    .eq('code', userCode);

  if (error) {
    console.error("❌ Erreur lors de l'enregistrement Supabase :", error);
  } else {
    console.log("✅ Questions pour proches enregistrées avec succès :", data);
    alert("Voici ton code à donner à 3 proches : " + userCode);
  }
}


if (window.location.href.includes("external")) {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get("code");
  console.log("Code reçu dans l'URL :", code);

  if (code) {
    // Appelle Supabase pour récupérer les questions liées à ce code
    supabase
      .from("users")
      .select("external_questions")
      .eq("code", code)
      .then(({ data, error }) => {
        if (!error && data && data.length > 0 && data[0].external_questions) {
          questions = data[0].external_questions;
          console.log("Questions externes chargées :", questions);
          afficherQuestions(); // appel explicite
        } else {
          console.error("Aucune question externe trouvée ou erreur :", error);
        }
      });
  }
}


        // État de l'application
        let currentQuestionIndex = 0;
        let answers = {};
        let testType = 'auto'; // 'auto' ou 'proche'
        let userCode = generateUniqueCode();



        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupMobileMenu();
            setupFAQ();
            setupSmoothScrolling();
            setupProgressBars();
            setupEvaluationForm();
            loadFirstQuestion();
        }

        // Menu mobile
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');

            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    const isOpen = mobileMenu.classList.contains('active');
                    
                    if (isOpen) {
                        mobileMenu.classList.remove('active');
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    } else {
                        mobileMenu.classList.add('active');
                        menuIcon.classList.remove('fa-bars');
                        menuIcon.classList.add('fa-times');
                        mobileMenuButton.setAttribute('aria-expanded', 'true');
                    }
                });

                // Fermer le menu quand on clique sur un lien
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.remove('active');
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    });
                });
            }
        }

        // FAQ Accordion
        function setupFAQ() {
            const faqButtons = document.querySelectorAll('.faq-button');
            faqButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const content = this.querySelector('.faq-content');
                    const icon = this.querySelector('i');
                    const isOpen = !content.classList.contains('hidden');
                    
                    // Fermer toutes les autres FAQ
                    faqButtons.forEach(otherButton => {
                        if (otherButton !== this) {
                            const otherContent = otherButton.querySelector('.faq-content');
                            const otherIcon = otherButton.querySelector('i');
                            otherContent.classList.add('hidden');
                            otherIcon.classList.remove('rotate-180');
                        }
                    });
                    
                    // Toggle la FAQ actuelle
                    if (isOpen) {
                        content.classList.add('hidden');
                        icon.classList.remove('rotate-180');
                    } else {
                        content.classList.remove('hidden');
                        icon.classList.add('rotate-180');
                    }
                });
            });
        }

        // Smooth scrolling
        function setupSmoothScrolling() {
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80; // Account for fixed nav
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Animation des barres de progression
        function setupProgressBars() {
            const progressBars = document.querySelectorAll('.progress-bar');
            
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const bar = entry.target;
                        const targetWidth = bar.style.width;
                        bar.style.width = '0';
                        setTimeout(() => {
                            bar.style.width = targetWidth;
                        }, 100);
                    }
                });
            }, observerOptions);
            
            progressBars.forEach(bar => {
                observer.observe(bar);
            });
        }

        // Configuration du formulaire d'évaluation
        function setupEvaluationForm() {
            const evaluationForm = document.getElementById('evaluation-form');
            if (evaluationForm) {
                evaluationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const code = formData.get('code');
                    const relation = formData.get('relation');
                    
                    if (code && relation) {
                        userCode = code;
                        testType = 'proche';
                        startEvaluationTest(relation);
                    } else {
                        alert('Veuillez remplir tous les champs requis.');
                    }
                });
            }
        }

        // Chargement de la première question
        function loadFirstQuestion() {
            const questionsContainer = document.getElementById('questions-container');
            if (questionsContainer) {
                displayQuestion(0);
                setupQuestionNavigation();
            }
        }

        // Affichage d'une question
        function displayQuestion(index) {
            const questionsContainer = document.getElementById('questions-container');
            const question = QUESTIONS_AUTO_EVALUATION[index];
            
            if (!question || !questionsContainer) return;
            
            const progress = ((index + 1) / QUESTIONS_AUTO_EVALUATION.length) * 100;
            
            const questionHTML = `
                <div class="question-container active fade-in bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="px-6 py-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-sm font-medium text-blue-600">Question ${index + 1}/${QUESTIONS_AUTO_EVALUATION.length}</span>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 ml-4">
                                <div class="progress-bar bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <h3 class="text-xl font-medium text-gray-900 mb-6">${question.question}</h3>
                        
                        <div class="space-y-4">
                            ${question.options.map((option, optionIndex) => `
                                <div class="flex items-start">
                                    <input id="q${question.id}-${optionIndex}" name="question${question.id}" type="radio" value="${optionIndex}" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 mt-1" ${answers[question.id] === optionIndex ? 'checked' : ''}>
                                    <label for="q${question.id}-${optionIndex}" class="ml-3 block text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900 transition-colors">
                                        ${option.text}
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            questionsContainer.innerHTML = questionHTML;
            
            // Écouter les changements de réponse
            const radioButtons = questionsContainer.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    answers[question.id] = parseInt(this.value);
                    saveProgress();
                    updateNavigationButtons();
                });
            });
            
            updateNavigationButtons();
        }

        // Configuration de la navigation entre questions
        function setupQuestionNavigation() {
            const prevButton = document.getElementById('prev-question');
            const nextButton = document.getElementById('next-question');
            const finishButton = document.getElementById('finish-test');
            
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    if (currentQuestionIndex > 0) {
                        currentQuestionIndex--;
                        displayQuestion(currentQuestionIndex);
                    }
                });
            }
            
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    if (answers[QUESTIONS_AUTO_EVALUATION[currentQuestionIndex].id] !== undefined) {
                        if (currentQuestionIndex < QUESTIONS_AUTO_EVALUATION.length - 1) {
                            currentQuestionIndex++;
                            displayQuestion(currentQuestionIndex);
                        }
                    } else {
                        alert('Veuillez sélectionner une réponse avant de continuer.');
                    }
                });
            }
            
            if (finishButton) {
                finishButton.addEventListener('click', function() {
                    if (Object.keys(answers).length === QUESTIONS_AUTO_EVALUATION.length) {
                        calculateResults();
                    } else {
                        alert('Veuillez répondre à toutes les questions avant de terminer.');
                    }
                });
            }
        }

        // Mise à jour des boutons de navigation
        function updateNavigationButtons() {
            const prevButton = document.getElementById('prev-question');
            const nextButton = document.getElementById('next-question');
            const finishButton = document.getElementById('finish-test');
            
            if (prevButton) {
                prevButton.style.display = currentQuestionIndex > 0 ? 'inline-flex' : 'none';
            }
            
            const isLastQuestion = currentQuestionIndex === QUESTIONS_AUTO_EVALUATION.length - 1;
            const hasAnswer = answers[QUESTIONS_AUTO_EVALUATION[currentQuestionIndex].id] !== undefined;
            
            if (nextButton && finishButton) {
                if (isLastQuestion) {
                    nextButton.style.display = 'none';
                    finishButton.style.display = hasAnswer ? 'inline-flex' : 'none';
                } else {
                    nextButton.style.display = 'inline-flex';
                    finishButton.style.display = 'none';
                }
            }
        }

        // Sauvegarde de la progression
        function saveProgress() {
            const progressData = {
                currentQuestionIndex,
                answers,
                testType,
                userCode,
                timestamp: Date.now()
            };
            localStorage.setItem('personalityTestProgress', JSON.stringify(progressData));

        }

        // Chargement de la progression sauvegardée
        function loadProgress() {
            const saved = localStorage.getItem('personalityTestProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    // Vérifier si la sauvegarde n'est pas trop ancienne (24h)
                    if (Date.now() - data.timestamp < 24 * 60 * 60 * 1000) {
                        currentQuestionIndex = data.currentQuestionIndex || 0;
                        answers = data.answers || {};
                        testType = data.testType || 'auto';
                        userCode = data.userCode || '';
                        return true;
                    }
                } catch (e) {
                    console.error('Erreur lors du chargement de la progression:', e);
                }
            }
            return false;
        }

        // === Configuration Supabase ===
      
        // 🔐 Génére un code aléatoire

function generateUniqueCode(length = 6) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code = '';
  for (let i = 0; i < length; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}


        const SUPABASE_URL = 'https://swjnpvfkloubshksobau.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3am5wdmZrbG91YnNoa3NvYmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwOTUxMzEsImV4cCI6MjA2OTY3MTEzMX0.A6rnIJyfIIxDT0c2XW_zGeUXpdYCgBFd6MTzBGFZ-Cg';

// Le client Supabase sera initialisé après le chargement du script


        /**
         * Enregistre le profil utilisateur (auto‑évaluation) dans Supabase.
         * Cette fonction insère un enregistrement dans la table "users".
         * @param {Object} userProfile Contient le code unique, les types MBTI/Ennéagramme,
         * les scores détaillés et le score de certitude.
         */
         async function saveUserProfileToSupabase(userProfile) {
  try {
    const { data, error } = await supabase
      .from('users')
      .insert({
        code: userProfile.code,
        mbti_scores: userProfile.mbtiScores,
        enneagram_scores: userProfile.enneagramScores,
        mbti_type: userProfile.mbtiType,
        enneagram_type: userProfile.enneagramType,
        certainty_score: userProfile.certaintyScore
      })
      .select()
      .single();

    if (error) {
      console.error('Erreur lors de l\'enregistrement du profil utilisateur :', error);
    } else {
      console.log('Profil enregistré dans Supabase', data);

      if (testType === "auto") {
        enregistrerQuestionsPourProches(answers, userProfile.code);
      }
    }
  } catch (err) {
    console.error('Exception lors de l\'enregistrement du profil utilisateur :', err);
  }
}



        /**
         * Enregistre une évaluation externe dans Supabase.
         * Cette fonction récupère l'utilisateur par son code unique, puis insère une évaluation liée.
         * @param {String} code Code unique de l'utilisateur évalué.
         * @param {String} relation Relation entre l'évaluateur et l'utilisateur ("family", "partner", "friend", "colleague").
         * @param {Object} mbtiScores Scores MBTI calculés à partir des réponses de l'évaluation externe.
         * @param {Object} enneagramScores Scores Ennéagramme calculés à partir des réponses.
         */
        async function saveExternalEvaluationToSupabase(code, relation, mbtiScores, enneagramScores) {
            try {
                // Récupérer l'utilisateur par code
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('id, mbti_scores, enneagram_scores')
                    .eq('code', code)
                    .single();
                if (userError || !user) {
                    console.error('Utilisateur introuvable pour ce code :', code, userError);
                    return;
                }
                const userId = user.id;
                // Insérer l'évaluation
                const { error: insertError } = await supabase
                    .from('external_evaluations')
                    .insert({
                        user_id: userId,
                        relation: relation,
                        mbti_scores: mbtiScores,
                        enneagram_scores: enneagramScores
                    });
                if (insertError) {
                    console.error('Erreur lors de l’enregistrement de l’évaluation externe :', insertError);
                } else {
                    console.log('Évaluation externe enregistrée dans Supabase');
                    // Vérifier si suffisamment d’évaluations sont présentes pour calculer un résultat final
                    await checkAndFinalizeResults(userId);
                }
            } catch (err) {
                console.error('Exception lors de l’enregistrement de l’évaluation externe :', err);
            }
        }

        /**
         * Calcule et enregistre le résultat final si au moins trois évaluations externes sont disponibles.
         * @param {String} userId Identifiant de l'utilisateur.
         */
        async function checkAndFinalizeResults(userId) {
            try {
                // Récupérer l'utilisateur
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('id, code, mbti_scores, enneagram_scores, mbti_type, enneagram_type')
                    .eq('id', userId)
                    .single();
                if (userError || !user) {
                    console.error('Utilisateur introuvable lors du calcul final', userError);
                    return;
                }

                // Récupérer les évaluations externes
                const { data: evaluations, error: evalError } = await supabase
                    .from('external_evaluations')
                    .select('relation, mbti_scores, enneagram_scores, created_at')
                    .eq('user_id', userId);
                if (evalError) {
                    console.error('Erreur de récupération des évaluations externes :', evalError);
                    return;
                }
                // Ne calculer que s’il y a au moins 3 évaluations
                if (!evaluations || evaluations.length < 3) {
                    return;
                }
                // Calculer le résultat pondéré
                const { mbtiType, enneagramType, mbtiCertainty, enneagramCertainty, overallCertainty } = computeWeightedResults(user.mbti_scores, user.enneagram_scores, evaluations);

                const finalMBTI = String(mbtiType);
                const finalEnneagram = String(enneagramType);
                const finalCertaintyScore = overallCertainty;

                console.log('MBTI :', finalMBTI);
                console.log('Ennéagramme :', finalEnneagram);
                console.log('Certitude :', finalCertaintyScore);

                const { data, error } = await supabase
                  .from('users')
                  .update({
                    mbti_type: finalMBTI,
                    enneagram_type: finalEnneagram,
                    certainty_score: finalCertaintyScore,
                  })
                  .eq('code', user.code);

                if (error) {
                  console.error('❌ Erreur lors de l’update :', error);
                } else {
                  console.log('✅ Données bien enregistrées :', data);
                }
            } catch (err) {
                console.error('Exception lors du calcul final des résultats :', err);
            }
        }

        /**
         * Calcule un résultat pondéré à partir des scores de l’auto‑évaluation et des évaluations externes.
         * La pondération suit : 5 % auto‑évaluation, 30 % famille, 30 % partenaire,
         * 25 % ami et 10 % collègue. Si certaines catégories sont absentes,
         * les poids sont rééquilibrés proportionnellement.
         * @param {Object} selfMbtiScores Scores MBTI de l’auto‑évaluation.
         * @param {Object} selfEnneagramScores Scores Ennéagramme de l’auto‑évaluation.
         * @param {Array} evaluations Liste des évaluations externes (chaque objet contient relation, mbti_scores et enneagram_scores).
         * @returns {Object} Contient le type MBTI final, le type Ennéagramme final
         * et les indices de certitude pour chaque profil.
         */
        function computeWeightedResults(selfMbtiScores, selfEnneagramScores, evaluations) {
            // Définition des poids initiaux pour chaque type de relation
            const baseWeights = {
                family: 0.30,
                partner: 0.30,
                friend: 0.25,
                colleague: 0.10
            };
            const selfWeight = 0.05;
            // Déterminer les catégories présentes
            const presentRelations = {};
            evaluations.forEach(ev => {
                presentRelations[ev.relation] = (presentRelations[ev.relation] || 0) + 1;
            });
            // Calculer le total des poids des relations présentes
            let totalPresentWeight = 0;
            Object.keys(presentRelations).forEach(rel => {
                totalPresentWeight += baseWeights[rel] || 0;
            });
            // Rééquilibrer les poids sur la base 0.95 (car 5 % pour soi)
            const relationWeights = {};
            Object.keys(presentRelations).forEach(rel => {
                relationWeights[rel] = ((baseWeights[rel] || 0) / totalPresentWeight) * (1 - selfWeight);
            });
            // Préparer les accumulations
            const combinedMbti = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const combinedEnneagram = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
            // Ajouter la contribution de l’auto‑évaluation
            Object.keys(selfMbtiScores).forEach(trait => {
                combinedMbti[trait] += selfMbtiScores[trait] * selfWeight;
            });
            Object.keys(selfEnneagramScores).forEach(type => {
                combinedEnneagram[type] += selfEnneagramScores[type] * selfWeight;
            });
            // Ajouter les contributions des évaluations externes
            const agreement = { mbti: 0, enneagram: 0 };

            evaluations.forEach(ev => {
                const weightPerEval = (relationWeights[ev.relation] || 0) / presentRelations[ev.relation];
                Object.keys(ev.mbti_scores).forEach(trait => {
                    combinedMbti[trait] += ev.mbti_scores[trait] * weightPerEval;
                });
                Object.keys(ev.enneagram_scores).forEach(type => {
                    combinedEnneagram[type] += ev.enneagram_scores[type] * weightPerEval;
                });
            });
            // Déterminer le type MBTI final
            const mbtiType =
                (combinedMbti.E > combinedMbti.I ? 'E' : 'I') +
                (combinedMbti.S > combinedMbti.N ? 'S' : 'N') +
                (combinedMbti.T > combinedMbti.F ? 'T' : 'F') +
                (combinedMbti.J > combinedMbti.P ? 'J' : 'P');
            // Déterminer le type Ennéagramme final
            let topEnnea = '1';
            Object.keys(combinedEnneagram).forEach(type => {
                if (combinedEnneagram[type] > combinedEnneagram[topEnnea]) {
                    topEnnea = type;
                }
            });

            // Calcul de l'accord (certitude) après connaissance des types finaux
            // Contribution de l'auto‑évaluation
            const selfMbtiType =
                (selfMbtiScores.E > selfMbtiScores.I ? 'E' : 'I') +
                (selfMbtiScores.S > selfMbtiScores.N ? 'S' : 'N') +
                (selfMbtiScores.T > selfMbtiScores.F ? 'T' : 'F') +
                (selfMbtiScores.J > selfMbtiScores.P ? 'J' : 'P');
            const selfEnneaType = Object.keys(selfEnneagramScores).reduce((a, b) =>
                selfEnneagramScores[a] > selfEnneagramScores[b] ? a : b
            );
            agreement.mbti = selfMbtiType === mbtiType ? selfWeight : 0;
            agreement.enneagram = selfEnneaType === topEnnea ? selfWeight : 0;

            // Accord des évaluations externes (recalculé maintenant)
            evaluations.forEach(ev => {
                const weightPerEval = (relationWeights[ev.relation] || 0) / presentRelations[ev.relation];
                const evMbtiType =
                    (ev.mbti_scores.E > ev.mbti_scores.I ? 'E' : 'I') +
                    (ev.mbti_scores.S > ev.mbti_scores.N ? 'S' : 'N') +
                    (ev.mbti_scores.T > ev.mbti_scores.F ? 'T' : 'F') +
                    (ev.mbti_scores.J > ev.mbti_scores.P ? 'J' : 'P');
                const evEnneaType = Object.keys(ev.enneagram_scores).reduce((a, b) =>
                    ev.enneagram_scores[a] > ev.enneagram_scores[b] ? a : b
                );
                if (evMbtiType === mbtiType) {
                    agreement.mbti += weightPerEval;
                }
                if (evEnneaType === topEnnea) {
                    agreement.enneagram += weightPerEval;
                }
            });

            const mbtiCertainty = Math.min(95, Math.round(agreement.mbti * 100));
            const enneagramCertainty = Math.min(95, Math.round(agreement.enneagram * 100));
            const overallCertainty = Math.min(95, Math.round((mbtiCertainty + enneagramCertainty) / 2));

            return { mbtiType, enneagramType: topEnnea, mbtiCertainty, enneagramCertainty, overallCertainty };
        }

        /**
         * Récupère un profil utilisateur et ses évaluations externes depuis Supabase.
         * @param {String} code Code unique de l'utilisateur.
         * @returns {Object|null} Contient l’utilisateur et ses évaluations, ou null si introuvable.
         */
        async function fetchUserProfileFromSupabase(code) {
            try {
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('id, code, mbti_scores, enneagram_scores, mbti_type, enneagram_type, certainty_score')
                    .eq('code', code)
                    .single();
                if (userError || !user) {
                    return null;
                }
                const { data: evaluations, error: evalError } = await supabase
                    .from('external_evaluations')
                    .select('relation, mbti_scores, enneagram_scores, created_at')
                    .eq('user_id', user.id);
                if (evalError) {
                    console.error('Erreur lors de la récupération des évaluations externes :', evalError);
                }
                return { user, evaluations: evaluations || [] };
            } catch (err) {
                console.error('Exception lors de la récupération du profil :', err);
                return null;
            }
        }

        // Calcul des résultats
        async function calculateResults() {
            const mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
            
            // Calculer les scores basés sur les réponses
            Object.keys(answers).forEach(questionId => {
                const questionIndex = parseInt(questionId) - 1;
                const answerIndex = answers[questionId];
                const question = QUESTIONS_AUTO_EVALUATION[questionIndex];
                const selectedOption = question.options[answerIndex];
                
                // Scores MBTI
                Object.keys(selectedOption.mbti).forEach(trait => {
                    mbtiScores[trait] += selectedOption.mbti[trait];
                });
                
                // Scores Ennéagramme
                Object.keys(selectedOption.enneagram).forEach(type => {
                    enneagramScores[type] += selectedOption.enneagram[type];
                });
            });
            
            // Déterminer le type MBTI
            const mbtiType = 
                (mbtiScores.E > mbtiScores.I ? 'E' : 'I') +
                (mbtiScores.S > mbtiScores.N ? 'S' : 'N') +
                (mbtiScores.T > mbtiScores.F ? 'T' : 'F') +
                (mbtiScores.J > mbtiScores.P ? 'J' : 'P');
            
            // Déterminer le type Ennéagramme dominant
            const enneagramType = Object.keys(enneagramScores).reduce((a, b) => 
                enneagramScores[a] > enneagramScores[b] ? a : b
            );
            
            // Calculer la certitude pour le MBTI (moyenne des écarts entre chaque paire)
            const mbtiPairs = [
                ['E', 'I'],
                ['S', 'N'],
                ['T', 'F'],
                ['J', 'P']
            ];
            let mbtiCertaintySum = 0;
            mbtiPairs.forEach(([a, b]) => {
                const pairTotal = mbtiScores[a] + mbtiScores[b];
                if (pairTotal > 0) {
                    mbtiCertaintySum += Math.abs(mbtiScores[a] - mbtiScores[b]) / pairTotal;
                }
            });
            const mbtiCertainty = Math.min(95, Math.round((mbtiCertaintySum / mbtiPairs.length) * 100));

            // Calculer la certitude pour l'Ennéagramme (poids du type dominant)
            const totalEnneagramScore = Object.values(enneagramScores).reduce((a, b) => a + b, 0);
            const enneagramCertainty = totalEnneagramScore
                ? Math.min(95, Math.round((enneagramScores[enneagramType] / totalEnneagramScore) * 100))
                : 0;

            // Certitude globale (moyenne des deux indices)
            const certaintyScore = Math.round((mbtiCertainty + enneagramCertainty) / 2);
            
            // Générer un code unique pour l'utilisateur
            const uniqueCode = generateUniqueCode();
            
            // Sauvegarder le profil avec le code
            const userProfile = {
                code: uniqueCode,
                mbtiType,
                enneagramType,
                mbtiCertainty,
                enneagramCertainty,
                certaintyScore,
                mbtiScores,
                enneagramScores,
                timestamp: Date.now()
            };
            // Enregistrement du profil dans Supabase
            await saveUserProfileToSupabase(userProfile);
            // Sauvegarde locale pour un accès hors ligne
            localStorage.setItem('userProfile_' + uniqueCode, JSON.stringify(userProfile));
            
            displayResults({
                code: uniqueCode,
                mbtiType,
                enneagramType,
                mbtiCertainty,
                enneagramCertainty,
                certaintyScore,
                mbtiScores,
                enneagramScores
            });
        }

        // Affichage des résultats
        function displayResults(results) {
            const resultsHTML = generateResultsHTML(results);
            
            // Créer une nouvelle section pour les résultats
            const resultsSection = document.createElement('div');
            resultsSection.className = 'bg-blue-50 py-16 px-4 sm:px-6 lg:px-8';
            resultsSection.innerHTML = resultsHTML;
            
            // Insérer après la section d'auto-évaluation
            const autoEvalSection = document.getElementById('auto-evaluation');
            if (autoEvalSection) {
                autoEvalSection.parentNode.insertBefore(resultsSection, autoEvalSection.nextSibling);
                
                // Faire défiler vers les résultats
                setTimeout(() => {
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
            
            // Sauvegarder les résultats
            localStorage.setItem('personalityTestResults', JSON.stringify(results));
            
            // Nettoyer la progression
            localStorage.removeItem('personalityTestProgress');
        }

        // Génération du HTML des résultats
        function generateResultsHTML(results) {
            const mbtiDescriptions = {
                'INTJ': 'L\'Architecte - Visionnaires stratégiques avec un plan pour tout.',
                'INTP': 'Le Penseur - Penseurs logiques et créatifs, toujours à la recherche de nouvelles idées.',
                'ENTJ': 'Le Commandant - Leaders naturels, charismatiques et déterminés.',
                'ENTP': 'L\'Innovateur - Inventifs et curieux, excellents pour trouver des solutions originales.',
                'INFJ': 'L\'Avocat - Idéalistes créatifs et perspicaces, motivés par leurs valeurs profondes.',
                'INFP': 'Le Médiateur - Poétiques, gentils et altruistes, toujours désireux d\'aider.',
                'ENFJ': 'Le Donateur - Charismatiques et empathiques, motivés par le désir d\'aider les autres.',
                'ENFP': 'L\'Inspirateur - Enthousiastes, créatifs et sociables, toujours à la recherche de nouvelles expériences.',
                'ISTJ': 'Le Logisticien - Pratiques et factuels, fiables et responsables.',
                'ISFJ': 'Le Protecteur - Chaleureux et consciencieux, toujours prêts à protéger leurs proches.',
                'ESTJ': 'L\'Exécutif - Excellents administrateurs, incomparables pour gérer avec efficacité.',
                'ESFJ': 'Le Consul - Extraordinairement attentionnés, sociables et populaires.',
                'ISTP': 'Le Virtuose - Mécaniciens audacieux et pratiques, maîtres de tous les types d\'outils.',
                'ISFP': 'L\'Aventurier - Artistes flexibles et charmants, toujours prêts à explorer.',
                'ESTP': 'L\'Entrepreneur - Intelligents, énergiques et très perceptifs.',
                'ESFP': 'L\'Amuseur - Spontanés, énergiques et enthousiastes.'
            };
            
            const enneagramDescriptions = {
                '1': 'Le Perfectionniste - Motivé par le besoin de vivre correctement et d\'améliorer le monde.',
                '2': 'L\'Altruiste - Motivé par le besoin d\'être aimé et d\'aider les autres.',
                '3': 'Le Bâtisseur - Motivé par le besoin de réussir et d\'être reconnu.',
                '4': 'L\'Artiste - Motivé par le besoin d\'exprimer son authenticité unique.',
                '5': 'L\'Investigateur - Motivé par le besoin de comprendre le monde.',
                '6': 'Le Loyaliste - Motivé par le besoin de sécurité et de soutien.',
                '7': 'L\'Enthousiaste - Motivé par le besoin de maintenir le bonheur et l\'enthousiasme.',
                '8': 'Le Challenger - Motivé par le besoin d\'être autonome et de contrôler sa vie.',
                '9': 'Le Médiateur - Motivé par le besoin de maintenir la paix intérieure et extérieure.'
            };
            
            return `
                <div class="max-w-4xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                            Vos résultats
                        </h2>
                        <p class="mt-4 text-xl text-gray-600">
                            Voici votre profil de personnalité basé sur vos réponses
                        </p>
                    </div>
                    
                    <div class="mt-12 bg-white shadow-xl rounded-lg overflow-hidden">
                        <div class="px-6 py-8">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900">Votre profil</h3>
                                    <p class="mt-1 text-gray-500">Analyse complétée le ${new Date().toLocaleDateString('fr-FR')}</p>
                                </div>
                                <div class="mt-4 md:mt-0">
                                    <span class="personality-badge bg-green-100 text-green-800">${results.mbtiType}</span>
                                    <span class="personality-badge bg-blue-100 text-blue-800 ml-2">Type ${results.enneagramType}</span>
                                </div>
                            </div>
                            
                            <!-- Code unique pour partage -->
                            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-lg font-medium text-blue-900">Votre code unique</h4>
                                        <p class="text-sm text-blue-700 mt-1">Partagez ce code avec vos proches pour qu'ils puissent vous évaluer</p>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <div class="bg-white border-2 border-blue-300 rounded-lg px-4 py-2">
                                            <span class="text-2xl font-bold text-blue-900 tracking-wider" id="unique-code">${results.code}</span>
                                        </div>
                                        <button onclick="copyCode('${results.code}')" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            <i class="fas fa-copy mr-1"></i> Copier
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8 grid grid-cols-1 gap-8 md:grid-cols-2">
                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">Profil MBTI</h4>
                                    <div class="mt-4 bg-green-50 rounded-lg p-4">
                                        <p class="text-gray-700 font-medium">${results.mbtiType}</p>
                                        <p class="text-gray-600 text-sm mt-1">${mbtiDescriptions[results.mbtiType]}</p>
                                        <div class="mt-4">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-700">Certitude</span>
                                                <span class="text-sm text-gray-500">${results.mbtiCertainty}%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                                <div class="progress-bar bg-green-600 h-2.5 rounded-full" style="width: ${results.mbtiCertainty}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">Profil Ennéagramme</h4>
                                    <div class="mt-4 bg-blue-50 rounded-lg p-4">
                                        <p class="text-gray-700 font-medium">Type ${results.enneagramType}</p>
                                        <p class="text-gray-600 text-sm mt-1">${enneagramDescriptions[results.enneagramType]}</p>
                                        <div class="mt-4">
                                            <div class="flex justify-between">
                                                <span class="text-sm font-medium text-gray-700">Certitude</span>
                                                <span class="text-sm text-gray-500">${results.enneagramCertainty}%</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                                <div class="progress-bar bg-blue-600 h-2.5 rounded-full" style="width: ${results.enneagramCertainty}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8 flex flex-wrap justify-center gap-4">
                                <button onclick="shareResults()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <i class="fas fa-share mr-2"></i> Partager
                                </button>
                                <button onclick="downloadResults()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    <i class="fas fa-download mr-2"></i> Télécharger
                                </button>
                                <button onclick="restartTest()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <i class="fas fa-redo mr-2"></i> Refaire le test
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonctions utilitaires
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'Mon profil de personnalité',
                    text: 'Découvrez votre profil de personnalité avec Personnalité Comparée',
                    url: window.location.href
                });
            } else {
                // Fallback pour les navigateurs qui ne supportent pas l'API Web Share
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    alert('Lien copié dans le presse-papiers !');
                });
            }
        }

        function downloadResults() {
            const results = localStorage.getItem('personalityTestResults');
            if (results) {
                const blob = new Blob([results], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'profil-personnalite.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                // Changer temporairement le texte du bouton
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-1"></i> Copié !';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            }).catch(() => {
                alert('Code copié : ' + code);
            });
        }

        function restartTest() {
            if (confirm('Êtes-vous sûr de vouloir recommencer le test ? Vos réponses actuelles seront perdues.')) {
                localStorage.removeItem('personalityTestProgress');
                localStorage.removeItem('personalityTestResults');
                currentQuestionIndex = 0;
                answers = {};
                
                // Supprimer la section des résultats si elle existe
                const resultsSection = document.querySelector('.bg-blue-50');
                if (resultsSection && resultsSection.innerHTML.includes('Vos résultats')) {
                    resultsSection.remove();
                }
                
                displayQuestion(0);
            }
        }

        function startEvaluationTest(relation) {
            alert(`Évaluation pour un ${relation} - Fonctionnalité en cours de développement`);
        }

        // Gestion des modales
        function showModal(title, content) {
            const modalContainer = document.getElementById('modal-container');
            const modalHTML = `
                <div class="modal show" id="current-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="text-xl font-bold text-gray-900">${title}</h2>
                            <span class="close" onclick="closeModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            modalContainer.innerHTML = modalHTML;
            
            // Fermer avec ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeModal();
            });
            
            // Fermer en cliquant à l'extérieur
            document.getElementById('current-modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        }

        function closeModal() {
            const modal = document.getElementById('current-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    document.getElementById('modal-container').innerHTML = '';
                }, 300);
            }
        }

        // Descriptions détaillées MBTI
        const mbtiDetailedDescriptions = {
            'INTJ': {
                title: 'INTJ - L\'Architecte',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INTJ sont des visionnaires stratégiques avec un plan pour tout. Ils sont indépendants, déterminés et ont une forte capacité à voir les possibilités futures.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Penseurs stratégiques et visionnaires</li>
                            <li>Indépendants et autonomes</li>
                            <li>Orientés vers les objectifs à long terme</li>
                            <li>Excellents planificateurs</li>
                            <li>Préfèrent travailler seuls ou en petits groupes</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Auxiliaire :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Inférieure :</strong> Sensation Extravertie (Se)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Architecte, ingénieur, scientifique, consultant en stratégie, développeur de logiciels, chercheur.</p>
                    </div>
                `
            },
            'INTP': {
                title: 'INTP - Le Penseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INTP sont des penseurs logiques et créatifs, toujours à la recherche de nouvelles idées et possibilités théoriques.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Analystes logiques et objectifs</li>
                            <li>Curieux et ouverts aux nouvelles idées</li>
                            <li>Indépendants et flexibles</li>
                            <li>Excellents résolveurs de problèmes</li>
                            <li>Préfèrent la théorie à la pratique</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Tertiaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Inférieure :</strong> Sentiment Extraverti (Fe)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Chercheur, philosophe, mathématicien, programmeur, analyste, professeur d'université.</p>
                    </div>
                `
            }
            ,
            'ISTJ': {
                title: 'ISTJ - Le Logisticien',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISTJ sont sérieux et fiables. Ils respectent les règles et traditions, travaillent méthodiquement et prennent leurs responsabilités au sérieux. Leur approche est pragmatique et organisée.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Responsables, pratiques et factuels</li>
                            <li>Respectent les traditions et les structures établies</li>
                            <li>Mettent l'accent sur la précision et la loyauté</li>
                            <li>Préférent la stabilité et la planification</li>
                            <li>Peuvent être réservés et rigides face au changement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Auxiliaire :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Inférieure :</strong> Intuition Extravertie (Ne)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Comptable, auditeur, administrateur, officier militaire, juge, gestionnaire de projet.</p>
                    </div>
                `
            },
            'ISTP': {
                title: 'ISTP - Le Virtuose',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISTP sont pragmatiques et analytiques. Ils aiment comprendre comment fonctionnent les choses et s'attaquer à des problèmes concrets. Flexibles et observateurs, ils préfèrent apprendre par l'expérience.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Calmes et réalistes</li>
                            <li>Analytiques et logiques</li>
                            <li>Aiment démonter et réparer des objets</li>
                            <li>S'adaptent rapidement aux situations de crise</li>
                            <li>Peuvent paraître distants émotionnellement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Tertiaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Inférieure :</strong> Sentiment Extraverti (Fe)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Mécanicien, ingénieur, pilote, technicien, enquêteur.</p>
                    </div>
                `
            },
            'ISFJ': {
                title: 'ISFJ - Le Protecteur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISFJ sont chaleureux et consciencieux. Ils veillent à préserver l'harmonie et la sécurité de leur entourage. Ils respectent les traditions et sont attentifs aux besoins des autres.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Bienveillants, loyaux et responsables</li>
                            <li>Organisés et méthodiques</li>
                            <li>Souvent modestes et discrets</li>
                            <li>Se soucient des besoins des autres avant les leurs</li>
                            <li>Peuvent être réticents face au changement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Tertiaire :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Inférieure :</strong> Intuition Extravertie (Ne)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Infirmier, enseignant, bibliothécaire, assistant social, gestionnaire administratif.</p>
                    </div>
                `
            },
            'ISFP': {
                title: 'ISFP - L\'Aventurier',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISFP sont sensibles, discrets et artistiques. Ils apprécient l'harmonie, la beauté et la liberté de s'exprimer. Ils vivent l’instant présent et recherchent l'équilibre.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Créatifs et artistiques</li>
                            <li>Empathiques et chaleureux</li>
                            <li>Discrets et réservés</li>
                            <li>Apprécient la liberté et l’indépendance</li>
                            <li>Peuvent éviter les conflits et les planifications rigides</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Tertiaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Inférieure :</strong> Pensée Extravertie (Te)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Artiste, designer, photographe, chef cuisinier, travailleur social.</p>
                    </div>
                `
            },
            'INFJ': {
                title: 'INFJ - L\'Avocat',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INFJ sont perspicaces et idéalistes. Ils sont guidés par leurs valeurs et cherchent à comprendre les motivations profondes des autres. Ils sont créatifs et se consacrent à aider autrui.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Visionnaires et orientés vers un sens profond</li>
                            <li>Empathiques et compatissants</li>
                            <li>Créatifs et originaux</li>
                            <li>Organisés et déterminés</li>
                            <li>Peuvent se sentir incompris ou retirés</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Tertiaire :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Inférieure :</strong> Sensation Extravertie (Se)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Conseiller, psychologue, écrivain, enseignant, humanitaire.</p>
                    </div>
                `
            },
            'INFP': {
                title: 'INFP - Le Médiateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INFP sont idéalistes et empathiques. Guidés par leurs valeurs, ils cherchent un sens profond à la vie et s’efforcent de rendre le monde meilleur. Ils sont créatifs et sensibles.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Idéalistes et guidés par leurs valeurs</li>
                            <li>Empathiques et compatissants</li>
                            <li>Créatifs et expressifs</li>
                            <li>Aiment l'authenticité et l'individualité</li>
                            <li>Peuvent être réservés et éviter les conflits</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Tertiaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Inférieure :</strong> Pensée Extravertie (Te)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Écrivain, psychologue, conseiller, artiste, musicien.</p>
                    </div>
                `
            },
            'ENTJ': {
                title: 'ENTJ - Le Commandant',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENTJ sont des leaders nés, charismatiques et logiques. Ils aiment structurer des organisations, planifier l'avenir et relever des défis. Ils sont déterminés et axés sur l’efficacité.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Leaders stratégiques et assertifs</li>
                            <li>Décisifs et organisés</li>
                            <li>Adeptes de la planification et de l'exécution</li>
                            <li>Orientés vers les objectifs et la réussite</li>
                            <li>Peuvent paraître autoritaires ou impatients</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Tertiaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Inférieure :</strong> Sentiment Introverti (Fi)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Directeur général, avocat, chef de projet, politicien, entrepreneur.</p>
                    </div>
                `
            },
            'ENTP': {
                title: 'ENTP - L\'Innovateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENTP sont créatifs et curieux. Ils aiment explorer de nouvelles idées, débattre et remettre en question le statu quo. Flexibles, ils préfèrent les possibilités ouvertes aux routines strictes.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Inventifs et plein d'esprit</li>
                            <li>Aiment débattre et argumenter</li>
                            <li>S'adaptent rapidement à de nouveaux concepts</li>
                            <li>Aiment les défis intellectuels</li>
                            <li>Peuvent s'ennuyer avec la routine et la gestion des détails</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Auxiliaire :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Inférieure :</strong> Sensation Introvertie (Si)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Avocat, consultant, entrepreneur, inventeur, journaliste.</p>
                    </div>
                `
            },
            'ENFJ': {
                title: 'ENFJ - Le Donateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENFJ sont charismatiques et attentifs aux autres. Ils comprennent intuitivement les besoins des gens et aiment motiver et inspirer. Ils recherchent l’harmonie et le développement personnel et collectif.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Chaleureux, empathiques et organisés</li>
                            <li>Communicateurs naturels</li>
                            <li>Aident les autres à réaliser leur potentiel</li>
                            <li>Orientés vers les valeurs et l'harmonie</li>
                            <li>Peuvent s'oublier au profit des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Tertiaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Inférieure :</strong> Pensée Introvertie (Ti)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Professeur, coach, psychologue, coordinateur d’événements, diplomate.</p>
                    </div>
                `
            },
            'ENFP': {
                title: 'ENFP - L\'Inspirateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENFP sont enthousiastes et créatifs. Ils s’épanouissent dans l'exploration de nouvelles idées et inspirent les autres grâce à leur vision optimiste. Ils cherchent l’authenticité et la liberté.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Énergétiques et imaginatifs</li>
                            <li>Empathiques et communicatifs</li>
                            <li>S'épanouissent dans les relations</li>
                            <li>Aiment l'innovation et la diversité</li>
                            <li>Peuvent se disperser et négliger les détails</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Tertiaire :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Inférieure :</strong> Sensation Introvertie (Si)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Journaliste, conseiller, animateur, auteur, professionnel des relations publiques.</p>
                    </div>
                `
            },
            'ESTP': {
                title: 'ESTP - L\'Entrepreneur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESTP sont énergiques et orientés vers l'action. Ils aiment vivre l'instant présent et résoudre des situations concrètes. Adaptables et sociables, ils prennent des décisions rapides.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Dynamiques et aventuriers</li>
                            <li>Pragmatiques et réalistes</li>
                            <li>Orientés vers les résultats immédiats</li>
                            <li>Bons communicateurs et négociateurs</li>
                            <li>Peuvent se montrer impatients et risquer l'impulsivité</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Auxiliaire :</strong> Pensée Introvertie (Ti)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Inférieure :</strong> Intuition Introvertie (Ni)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Entrepreneur, détective, pilote, vendeur, pompier.</p>
                    </div>
                `
            },
            'ESTJ': {
                title: 'ESTJ - L\'Exécutif',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESTJ sont organisés et directs. Ils se fient aux faits et aiment structurer les activités pour obtenir des résultats efficaces. Ils valorisent la tradition et l’ordre.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Pragmatiques et responsables</li>
                            <li>Directs et orientés vers l'action</li>
                            <li>Logiques et objectifs</li>
                            <li>Aiment organiser et diriger</li>
                            <li>Peuvent être inflexibles ou autoritaires</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Tertiaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Inférieure :</strong> Sentiment Introverti (Fi)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Gestionnaire, officier militaire, policier, juge, chef de projet.</p>
                    </div>
                `
            },
            'ESFP': {
                title: 'ESFP - L\'Amuseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESFP sont spontanés et sociables. Ils aiment profiter de la vie et attirer l'attention. Pratiques et chaleureux, ils encouragent les autres à vivre pleinement chaque moment.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Sociables et enthousiastes</li>
                            <li>Spontanés et énergiques</li>
                            <li>Aiment le divertissement et la variété</li>
                            <li>Observateurs et pratiques</li>
                            <li>Peuvent être sensibles aux critiques et éviter la planification</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Tertiaire :</strong> Pensée Extravertie (Te)</p>
                            <p><strong>Inférieure :</strong> Intuition Introvertie (Ni)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Acteur, animateur, hôte, vendeur, infirmier pédiatrique.</p>
                    </div>
                `
            },
            'ESFJ': {
                title: 'ESFJ - Le Consul',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESFJ sont aimables et sociables. Ils prennent soin des autres et veillent à maintenir l'harmonie. Organisés et consciencieux, ils travaillent pour soutenir leur communauté.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Chaleureux et serviables</li>
                            <li>Organisés et responsables</li>
                            <li>Centrés sur la communauté et la tradition</li>
                            <li>Communicateurs empathiques</li>
                            <li>Peuvent être sensibles à la critique et rechercher l'approbation</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Tertiaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Inférieure :</strong> Pensée Introvertie (Ti)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carrières typiques :</h3>
                        <p class="text-gray-700">Infirmier, enseignant, gestionnaire d'événements, conseiller, travailleur social.</p>
                    </div>
                `
            }
        };

        // Descriptions détaillées Ennéagramme
        const enneagramDetailedDescriptions = {
            '1': {
                title: 'Type 1 - Le Perfectionniste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 1 sont motivés par le besoin de vivre correctement, d'améliorer le monde et d'éviter la colère.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Être corrompu, défectueux ou mauvais</p>
                            <p><strong>Désir fondamental :</strong> Être bon, vertueux et parfait</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Idéalistes et responsables</li>
                            <li>Fort sens moral et éthique</li>
                            <li>Perfectionnistes et critiques</li>
                            <li>Organisés et méthodiques</li>
                            <li>Peuvent être rigides et colériques</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Sages, discernants, réalistes et nobles. Peuvent être moralement héroïques.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Deviennent critiques, perfectionnistes et peuvent exploser de colère.</p>
                    </div>
                `
            },
            '2': {
                title: 'Type 2 - L\'Altruiste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 2 sont motivés par le besoin d'être aimés et nécessaires. Ils sont empathiques, chaleureux et généreux, mais peuvent devenir possessifs et trop axés sur la reconnaissance.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas être aimés ou être inutiles</p>
                            <p><strong>Désir fondamental :</strong> Se sentir appréciés, aimés et nécessaires</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Empathiques et chaleureux</li>
                            <li>Serviables et généreux</li>
                            <li>Adaptés aux besoins des autres</li>
                            <li>Peuvent être dépendants de la reconnaissance</li>
                            <li>Parfois possessifs ou envahissants</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils sont altruistes, aimants et désintéressés. Ils soutiennent les autres de manière authentique sans attendre de retour.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir envahissants, ressentir de la jalousie et s'épuiser en donnant trop.</p>
                    </div>
                `
            },
            '3': {
                title: 'Type 3 - Le Bâtisseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 3 sont motivés par le besoin de réussir et d'être admirés. Ambitieux et énergiques, ils sont adaptables et conscients de leur image, mais peuvent devenir préoccupés par leur statut.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas avoir de valeur personnelle</p>
                            <p><strong>Désir fondamental :</strong> Se sentir précieux et admiré pour leurs réalisations</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Ambitieux et charismatiques</li>
                            <li>Efficaces et compétitifs</li>
                            <li>Flexibles et orientés vers les objectifs</li>
                            <li>Très conscients de leur image</li>
                            <li>Peuvent négliger leurs émotions ou celles des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils sont authentiques, inspirants et encouragent les autres à réussir. Ils assument leurs valeurs personnelles plutôt que de rechercher uniquement la reconnaissance.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir obsédés par leur image, ignorer leurs besoins émotionnels et craindre l'échec.</p>
                    </div>
                `
            },
            '4': {
                title: 'Type 4 - L\'Artiste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 4 recherchent l'authenticité et un sens personnel. Sensibles et créatifs, ils veulent être compris et exprimer leur individualité. Ils peuvent être introspectifs et parfois mélancoliques.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas avoir d'identité ou de valeur personnelle</p>
                            <p><strong>Désir fondamental :</strong> Trouver leur véritable identité et s'exprimer de manière authentique</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Sensibles et introspectifs</li>
                            <li>Créatifs et expressifs</li>
                            <li>Apprécient la profondeur et l'authenticité</li>
                            <li>Peuvent être mélancoliques et se sentir différents</li>
                            <li>Recherchent souvent un sens et une connexion profonde</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils sont hautement créatifs, inspirés et capables de transformer leur expérience personnelle en quelque chose d'universel.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent se sentir incompris, se retirer et devenir auto‑indulgents ou envieux des autres.</p>
                    </div>
                `
            },
            '5': {
                title: 'Type 5 - L\'Investigateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 5 veulent comprendre le monde. Ils sont observateurs, innovants et autonomes. Ils peuvent se retirer pour préserver leur énergie et développer leurs connaissances.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Être impuissant, inutile ou incapable</p>
                            <p><strong>Désir fondamental :</strong> Être compétent et comprendre l'environnement</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Observateurs et analytiques</li>
                            <li>Innovants et créatifs</li>
                            <li>Indépendants et réservés</li>
                            <li>Recherchent la maîtrise de leurs domaines d'intérêt</li>
                            <li>Peuvent se couper de leurs émotions ou des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils sont visionnaires, pionniers et apportent des idées novatrices qui améliorent la société.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir détachés, trop rationnels et éviter la participation sociale.</p>
                    </div>
                `
            },
            '6': {
                title: 'Type 6 - Le Loyaliste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 6 recherchent la sécurité et la confiance. Loyaux et fiables, ils anticipent les problèmes et recherchent le soutien. Ils peuvent osciller entre la prudence et l'audace.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Être sans soutien ou sans direction</p>
                            <p><strong>Désir fondamental :</strong> Être en sécurité et soutenu</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Fiables et dévoués</li>
                            <li>Consciencieux et travailleurs</li>
                            <li>Tendance à anticiper les problèmes</li>
                            <li>Peuvent osciller entre doute et confiance</li>
                            <li>Parfois anxieux ou sceptiques</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils sont courageux, engagés et se mettent au service d'une cause plus grande qu'eux.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir méfiants, autoritaires ou excessivement anxieux.</p>
                    </div>
                `
            },
            '7': {
                title: 'Type 7 - L\'Enthousiaste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 7 sont optimistes et aventuriers. Ils recherchent des expériences stimulantes et veulent éviter la douleur et l'ennui. Souvent joyeux, ils peuvent se disperser.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Être privés ou coincés dans la souffrance</p>
                            <p><strong>Désir fondamental :</strong> Être heureux, satisfaits et libres</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Extravertis et optimistes</li>
                            <li>Polyvalents et spontanés</li>
                            <li>Curieux et enthousiastes</li>
                            <li>Aiment planifier des projets et des voyages</li>
                            <li>Peuvent être dispersés ou éviter la douleur à tout prix</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils canaliseront leur énergie dans des objectifs significatifs et apprécieront la simplicité et la gratitude.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent fuir les responsabilités, se disperser ou chercher des distractions excessives.</p>
                    </div>
                `
            },
            '8': {
                title: 'Type 8 - Le Challenger',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 8 valorisent l'indépendance et la protection. Ils sont confiants, forts et veulent se protéger et protéger les autres. Ils peuvent devenir dominants s'ils se sentent menacés.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Être blessés ou contrôlés par autrui</p>
                            <p><strong>Désir fondamental :</strong> Être maîtres de leur vie et protéger les faibles</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Assertifs et décisifs</li>
                            <li>Confiants et protecteurs</li>
                            <li>Dirigeants naturels</li>
                            <li>Défendent leurs convictions</li>
                            <li>Peuvent être contrôlants ou impulsifs</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils utilisent leur force pour améliorer le monde et protéger les vulnérables. Ils sont magnanimes et courageux.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir dominateurs, se méfier des autres et réagir avec colère.</p>
                    </div>
                `
            },
            '9': {
                title: 'Type 9 - Le Médiateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 9 recherchent la paix intérieure et extérieure. Ils sont réceptifs, conciliants et stables. Ils fuient les conflits et peuvent devenir complaisants pour préserver l'harmonie.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Perdre la connexion ou être séparé des autres</p>
                            <p><strong>Désir fondamental :</strong> Maintenir la paix et l'harmonie</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caractéristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Réceptifs et rassurants</li>
                            <li>Stables et accommodants</li>
                            <li>Médiateurs naturels</li>
                            <li>Évitent les conflits et la prise de décision</li>
                            <li>Peuvent devenir complaisants ou inertes</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En santé :</h3>
                        <p class="text-gray-700">Ils apportent la paix et la cohésion, aident les autres à coopérer et deviennent des sources d'unité.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent ignorer leurs propres besoins, éviter les conflits et se dissocier émotionnellement.</p>
                    </div>
                `
            }
        };

        // Fonctions pour afficher les détails
        function showMBTIDetails(type) {
            const details = mbtiDetailedDescriptions[type];
            if (details) {
                showModal(details.title, details.content);
            } else {
                showModal(`${type} - Description`, `<p>Description détaillée du type ${type} en cours de développement.</p>`);
            }
        }

        function showEnneagramDetails(type) {
            const details = enneagramDetailedDescriptions[type];
            if (details) {
                showModal(details.title, details.content);
            } else {
                showModal(`Type ${type} - Description`, `<p>Description détaillée du type ${type} en cours de développement.</p>`);
            }
        }

        function showAboutProject() {
            const content = `
                <div class="space-y-4">
                    <p class="text-gray-700">"Personnalité Comparée" est né de la volonté de créer un outil plus objectif pour comprendre sa personnalité.</p>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Notre approche unique :</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <i class="fas fa-eye text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Vision objective</h4>
                            <p class="text-sm text-gray-600">Combiner plusieurs perspectives pour une analyse plus complète</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <i class="fas fa-shield-alt text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Confidentialité</h4>
                            <p class="text-sm text-gray-600">Vos données sont protégées et ne sont jamais partagées</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <i class="fas fa-graduation-cap text-green-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Base scientifique</h4>
                            <p class="text-sm text-gray-600">Fondé sur les recherches en psychologie de la personnalité</p>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Pourquoi cette approche ?</h3>
                    <p class="text-gray-700">Contrairement aux tests traditionnels qui reposent uniquement sur l'auto-évaluation, notre approche combine votre perception avec celle de votre entourage pour un résultat plus nuancé et fidèle.</p>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Comment ça marche ?</h3>
                    <ol class="list-decimal list-inside text-gray-700 space-y-1">
                        <li>Vous répondez à 16 questions d'auto-évaluation</li>
                        <li>Vous partagez votre code unique avec vos proches</li>
                        <li>Ils répondent à 20 questions sur votre personnalité</li>
                        <li>Notre algorithme combine toutes les réponses avec une pondération scientifique</li>
                        <li>Vous obtenez votre profil MBTI et Ennéagramme avec un score de certitude</li>
                    </ol>
                </div>
            `;
            showModal('À propos du projet', content);
        }

        // Fonctions pour les pages légales et contact
        function showPrivacyPolicy() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Politique de Confidentialité</h3>
                    <p class="text-gray-700">Dernière mise à jour : ${new Date().toLocaleDateString('fr-FR')}</p>
                    
                    <h4 class="font-semibold text-gray-900">Collecte des données</h4>
                    <p class="text-gray-700">Nous collectons uniquement les données nécessaires au fonctionnement du test de personnalité : vos réponses aux questions et les évaluations de vos proches.</p>
                    
                    <h4 class="font-semibold text-gray-900">Utilisation des données</h4>
                    <p class="text-gray-700">Vos données sont utilisées exclusivement pour calculer votre profil de personnalité. Elles ne sont jamais partagées avec des tiers.</p>
                    
                    <h4 class="font-semibold text-gray-900">Stockage et sécurité</h4>
                    <p class="text-gray-700">Toutes les données sont stockées localement dans votre navigateur. Aucune information n'est transmise à nos serveurs.</p>
                    
                    <h4 class="font-semibold text-gray-900">Vos droits</h4>
                    <p class="text-gray-700">Vous pouvez supprimer vos données à tout moment en vidant le cache de votre navigateur.</p>
                </div>
            `;
            showModal('Politique de Confidentialité', content);
        }

        function showTermsOfService() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Conditions d'Utilisation</h3>
                    <p class="text-gray-700">Dernière mise à jour : ${new Date().toLocaleDateString('fr-FR')}</p>
                    
                    <h4 class="font-semibold text-gray-900">Utilisation du service</h4>
                    <p class="text-gray-700">Ce service est fourni gratuitement à des fins éducatives et de développement personnel. Il ne remplace pas un conseil professionnel en psychologie.</p>
                    
                    <h4 class="font-semibold text-gray-900">Précision des résultats</h4>
                    <p class="text-gray-700">Les résultats sont basés sur des modèles psychologiques reconnus mais ne constituent pas un diagnostic médical ou psychologique.</p>
                    
                    <h4 class="font-semibold text-gray-900">Responsabilité</h4>
                    <p class="text-gray-700">L'utilisation de ce service se fait sous votre propre responsabilité. Nous ne sommes pas responsables des décisions prises sur la base des résultats.</p>
                </div>
            `;
            showModal('Conditions d\'Utilisation', content);
        }

        function showLegalNotices() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Mentions Légales</h3>
                    
                    <h4 class="font-semibold text-gray-900">Éditeur du site</h4>
                    <p class="text-gray-700">Personnalité Comparée<br>
                    Site web éducatif<br>
                    Contact : contact@personnalite-comparee.fr</p>
                    
                    <h4 class="font-semibold text-gray-900">Hébergement</h4>
                    <p class="text-gray-700">Ce site est hébergé par Manus Cloud Platform</p>
                    
                    <h4 class="font-semibold text-gray-900">Propriété intellectuelle</h4>
                    <p class="text-gray-700">Le contenu de ce site est protégé par le droit d'auteur. Les modèles MBTI et Ennéagramme sont utilisés à des fins éducatives.</p>
                    
                    <h4 class="font-semibold text-gray-900">Cookies</h4>
                    <p class="text-gray-700">Ce site utilise uniquement le stockage local du navigateur pour sauvegarder votre progression. Aucun cookie de suivi n'est utilisé.</p>
                </div>
            `;
            showModal('Mentions Légales', content);
        }

        function showContact() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Nous Contacter</h3>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-900">Email</h4>
                        <p class="text-blue-700">contact@personnalite-comparee.fr</p>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-900">Support technique</h4>
                        <p class="text-blue-700">Pour toute question technique ou problème avec le test, n'hésitez pas à nous écrire en détaillant votre problème.</p>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-900">Suggestions</h4>
                        <p class="text-green-700">Vos suggestions d'amélioration sont les bienvenues ! Aidez-nous à améliorer l'expérience utilisateur.</p>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-900">Temps de réponse</h4>
                        <p class="text-yellow-700">Nous nous efforçons de répondre à tous les messages dans les 48 heures.</p>
                    </div>
                </div>
            `;
            showModal('Contact', content);
        }

        // Fonction pour démarrer l'évaluation externe
        function startExternalEvaluation() {
            const codeInput = document.querySelector('input[placeholder="Ex: ABC123"]');
            const relationInputs = document.querySelectorAll('input[name="relation"]');
            
            if (!codeInput || !codeInput.value.trim()) {
                alert('Veuillez entrer le code unique de la personne à évaluer.');
                return;
            }
            
            let selectedRelation = null;
            relationInputs.forEach(input => {
                if (input.checked) {
                    selectedRelation = input.value;
                }
            });
            
            if (!selectedRelation) {
                alert('Veuillez sélectionner votre relation avec cette personne.');
                return;
            }
            
            // Sauvegarder les informations de l'évaluation externe
            localStorage.setItem('externalEvaluationCode', codeInput.value.trim().toUpperCase());
            localStorage.setItem('externalEvaluationRelation', selectedRelation);
            
            // Rediriger vers la section d'évaluation externe
            showExternalEvaluationQuestions();
            
            // Scroll automatique vers la section d'auto-évaluation
            const autoEvalSection = document.getElementById('auto-evaluation');
            if (autoEvalSection) {
                autoEvalSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        }
        
        // Fonction pour afficher les questions d'évaluation externe
        function showExternalEvaluationQuestions() {
            const code = localStorage.getItem('externalEvaluationCode');
            const relation = localStorage.getItem('externalEvaluationRelation');
            
            const relationLabels = {
                'family': 'Membre de la famille',
                'partner': 'Partenaire amoureux',
                'friend': 'Ami(e)',
                'colleague': 'Collègue de travail'
            };
            
            const questionsContainer = document.getElementById('questions-container');
            if (!questionsContainer) return;
            
            questionsContainer.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                        <div class="bg-blue-600 px-6 py-4">
                            <h2 class="text-2xl font-bold text-white">Évaluation externe</h2>
                            <p class="text-blue-100 mt-1">Code: ${code} | Relation: ${relationLabels[relation]}</p>
                        </div>
                        <div class="p-6">
                            <div id="external-questions-content">
                                <!-- Les questions seront ajoutées ici -->
                            </div>
                            <div class="mt-6 flex justify-between">
                                <button id="prev-external-question" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" style="display: none;">
                                    <i class="fas fa-arrow-left mr-2"></i> Question précédente
                                </button>
                                <button id="next-external-question" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                                    Question suivante <i class="fas fa-arrow-right ml-2"></i>
                                </button>
                                <button id="finish-external-test" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700" style="display: none;">
                                    <i class="fas fa-check mr-2"></i> Terminer l'évaluation
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialiser les questions externes
            currentExternalQuestionIndex = 0;
            externalAnswers = {};
            displayExternalQuestion(0);
            setupExternalQuestionNavigation();
        }
        
        // Variables pour l'évaluation externe
        let currentExternalQuestionIndex = 0;
        let externalAnswers = {};
        
        // Questions pour l'évaluation externe (20 questions)
        const EXTERNAL_EVALUATION_QUESTIONS = [
            {
                id: 1,
                question: "Cette personne préfère généralement :",
                options: [
                    { text: "Être entourée de beaucoup de monde", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Passer du temps seule ou avec quelques proches", mbti: { I: 3 }, enneagram: { 4: 2, 5: 2 } },
                    { text: "Alterner entre moments sociaux et moments seuls", mbti: { E: 1, I: 1 }, enneagram: { 9: 2 } },
                    { text: "Cela dépend de son humeur", mbti: { P: 1 }, enneagram: { 4: 1, 7: 1 } }
                ]
            },
            {
                id: 2,
                question: "Quand cette personne prend des décisions, elle :",
                options: [
                    { text: "Analyse tous les faits et données", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "Suit son instinct et ses émotions", mbti: { F: 3, P: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Demande l'avis de plusieurs personnes", mbti: { F: 2, E: 1 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Prend du temps pour réfléchir", mbti: { I: 2, J: 1 }, enneagram: { 5: 2, 9: 1 } }
                ]
            },
            {
                id: 3,
                question: "Cette personne est motivée principalement par :",
                options: [
                    { text: "Le désir d'aider les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "L'atteinte de ses objectifs personnels", mbti: { T: 2, J: 1 }, enneagram: { 3: 3 } },
                    { text: "La recherche de nouvelles expériences", mbti: { N: 2, P: 2 }, enneagram: { 7: 3 } },
                    { text: "Le maintien de l'harmonie", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 4,
                question: "Face au stress, cette personne :",
                options: [
                    { text: "Devient plus organisée et contrôlante", mbti: { J: 3, T: 1 }, enneagram: { 1: 2, 8: 2 } },
                    { text: "Cherche du soutien auprès des autres", mbti: { F: 2, E: 2 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Se retire et réfléchit seule", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } },
                    { text: "Évite le problème ou le minimise", mbti: { P: 2, F: 1 }, enneagram: { 7: 2, 9: 2 } }
                ]
            },
            {
                id: 5,
                question: "Cette personne communique de manière :",
                options: [
                    { text: "Directe et factuelle", mbti: { T: 3, S: 1 }, enneagram: { 1: 1, 8: 2 } },
                    { text: "Chaleureuse et empathique", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Créative et métaphorique", mbti: { N: 3, F: 1 }, enneagram: { 4: 3 } },
                    { text: "Diplomatique et nuancée", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            }
            // ... (15 autres questions similaires)
        ];
        
        // Ajouter les 15 questions manquantes
        EXTERNAL_EVALUATION_QUESTIONS.push(
            {
                id: 6,
                question: "Cette personne gère le changement en :",
                options: [
                    { text: "S'adaptant rapidement et avec enthousiasme", mbti: { P: 3, E: 1 }, enneagram: { 7: 3 } },
                    { text: "Prenant le temps d'analyser les implications", mbti: { J: 2, T: 2 }, enneagram: { 5: 2, 6: 1 } },
                    { text: "Cherchant du soutien auprès des autres", mbti: { F: 2, E: 1 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Résistant au début puis s'adaptant", mbti: { J: 2, I: 1 }, enneagram: { 1: 1, 9: 2 } }
                ]
            },
            {
                id: 7,
                question: "Dans son travail, cette personne privilégie :",
                options: [
                    { text: "La qualité et la perfection", mbti: { J: 3, T: 1 }, enneagram: { 1: 3 } },
                    { text: "L'efficacité et les résultats", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "La collaboration et l'harmonie", mbti: { F: 3 }, enneagram: { 2: 2, 9: 2 } },
                    { text: "L'innovation et la créativité", mbti: { N: 3, P: 1 }, enneagram: { 4: 2, 7: 2 } }
                ]
            },
            {
                id: 8,
                question: "Cette personne exprime ses émotions :",
                options: [
                    { text: "Ouvertement et spontanément", mbti: { E: 3, F: 2 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "De manière contrôlée et réfléchie", mbti: { I: 2, T: 2 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "Principalement avec ses proches", mbti: { I: 2, F: 2 }, enneagram: { 4: 2, 6: 1 } },
                    { text: "Rarement, préfère les garder pour elle", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } }
                ]
            },
            {
                id: 9,
                question: "Face à une critique, cette personne :",
                options: [
                    { text: "L'accepte et cherche à s'améliorer", mbti: { J: 2, T: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Se défend et explique son point de vue", mbti: { E: 2, T: 1 }, enneagram: { 3: 2, 8: 2 } },
                    { text: "Se sent blessée mais n'en parle pas", mbti: { I: 2, F: 2 }, enneagram: { 4: 3 } },
                    { text: "Minimise et évite le conflit", mbti: { P: 2, F: 1 }, enneagram: { 7: 1, 9: 3 } }
                ]
            },
            {
                id: 10,
                question: "Cette personne prend des risques :",
                options: [
                    { text: "Rarement, préfère la sécurité", mbti: { J: 2, S: 2 }, enneagram: { 6: 3 } },
                    { text: "Après une analyse approfondie", mbti: { T: 3, J: 1 }, enneagram: { 5: 2, 1: 1 } },
                    { text: "Quand cela peut aider les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Souvent, aime l'aventure", mbti: { P: 3, N: 1 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 11,
                question: "Cette personne organise son espace de vie :",
                options: [
                    { text: "De manière très ordonnée et systématique", mbti: { J: 3, S: 1 }, enneagram: { 1: 3 } },
                    { text: "Fonctionnellement, selon ses besoins", mbti: { T: 2, J: 1 }, enneagram: { 3: 2, 5: 1 } },
                    { text: "De façon créative et personnelle", mbti: { N: 2, F: 2 }, enneagram: { 4: 3 } },
                    { text: "De manière décontractée, parfois désordonnée", mbti: { P: 3 }, enneagram: { 7: 2, 9: 2 } }
                ]
            },
            {
                id: 12,
                question: "Cette personne apprend mieux :",
                options: [
                    { text: "En suivant une méthode structurée", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "En expérimentant par elle-même", mbti: { P: 3, N: 1 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "En échangeant avec d'autres", mbti: { E: 3, F: 1 }, enneagram: { 2: 2, 3: 1 } },
                    { text: "En réfléchissant seule", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } }
                ]
            },
            {
                id: 13,
                question: "Cette personne gère son temps :",
                options: [
                    { text: "Avec des plannings détaillés", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 3: 1 } },
                    { text: "En se concentrant sur les priorités", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "De manière flexible selon l'humeur", mbti: { P: 3, F: 1 }, enneagram: { 4: 2, 7: 2 } },
                    { text: "En procrastinant souvent", mbti: { P: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 14,
                question: "Cette personne résout les problèmes en :",
                options: [
                    { text: "Analysant logiquement les faits", mbti: { T: 3, J: 1 }, enneagram: { 5: 3 } },
                    { text: "Cherchant des solutions créatives", mbti: { N: 3, P: 1 }, enneagram: { 4: 2, 7: 2 } },
                    { text: "Demandant conseil à son entourage", mbti: { F: 2, E: 2 }, enneagram: { 2: 1, 6: 3 } },
                    { text: "Agissant rapidement et directement", mbti: { E: 2, S: 2 }, enneagram: { 8: 3 } }
                ]
            },
            {
                id: 15,
                question: "Cette personne exprime son affection :",
                options: [
                    { text: "Par des gestes concrets et des services", mbti: { S: 3, F: 1 }, enneagram: { 2: 2, 6: 1 } },
                    { text: "Par des mots et des compliments", mbti: { E: 2, F: 2 }, enneagram: { 2: 3 } },
                    { text: "Par sa présence et son écoute", mbti: { I: 2, F: 3 }, enneagram: { 9: 3 } },
                    { text: "De manière subtile et discrète", mbti: { I: 3, T: 1 }, enneagram: { 5: 2, 4: 1 } }
                ]
            },
            {
                id: 16,
                question: "Cette personne fait face aux échecs :",
                options: [
                    { text: "En analysant ce qui n'a pas marché", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "En rebondissant rapidement", mbti: { E: 2, P: 2 }, enneagram: { 3: 2, 7: 2 } },
                    { text: "En cherchant du soutien émotionnel", mbti: { F: 3, E: 1 }, enneagram: { 2: 1, 6: 2 } },
                    { text: "En se remettant en question profondément", mbti: { I: 2, F: 2 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 17,
                question: "Cette personne prend des décisions importantes :",
                options: [
                    { text: "Après avoir pesé tous les pour et contre", mbti: { T: 3, J: 2 }, enneagram: { 5: 2, 6: 2 } },
                    { text: "En suivant son intuition", mbti: { N: 3, F: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "En consultant ses proches", mbti: { F: 2, E: 2 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Rapidement, en faisant confiance à son expérience", mbti: { S: 2, E: 2 }, enneagram: { 8: 3 } }
                ]
            },
            {
                id: 18,
                question: "Cette personne se ressource :",
                options: [
                    { text: "En passant du temps seule", mbti: { I: 3 }, enneagram: { 5: 3 } },
                    { text: "En étant entourée d'amis", mbti: { E: 3 }, enneagram: { 7: 2, 2: 1 } },
                    { text: "En aidant les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "En pratiquant ses hobbies", mbti: { P: 2, N: 1 }, enneagram: { 4: 2, 9: 2 } }
                ]
            },
            {
                id: 19,
                question: "Cette personne exprime son désaccord :",
                options: [
                    { text: "Directement et clairement", mbti: { T: 3, E: 2 }, enneagram: { 8: 3 } },
                    { text: "De manière diplomatique", mbti: { F: 3, I: 1 }, enneagram: { 9: 3 } },
                    { text: "En argumentant avec des faits", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "En évitant le conflit si possible", mbti: { F: 2, I: 2 }, enneagram: { 9: 2, 6: 1 } }
                ]
            },
            {
                id: 20,
                question: "Cette personne se sent le plus épanouie quand :",
                options: [
                    { text: "Elle atteint ses objectifs personnels", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "Elle aide quelqu'un à réussir", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Elle découvre quelque chose de nouveau", mbti: { N: 3, P: 1 }, enneagram: { 5: 2, 7: 2 } },
                    { text: "Elle maintient l'harmonie autour d'elle", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            }
        );
        
        // Fonction pour afficher une question externe
        function displayExternalQuestion(index) {
            const question = EXTERNAL_EVALUATION_QUESTIONS[index];
            if (!question) return;
            
            const progress = ((index + 1) / EXTERNAL_EVALUATION_QUESTIONS.length) * 100;
            const questionsContent = document.getElementById('external-questions-content');
            
            questionsContent.innerHTML = `
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-medium text-blue-600">Question ${index + 1}/${EXTERNAL_EVALUATION_QUESTIONS.length}</span>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 ml-4">
                            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <h3 class="text-xl font-medium text-gray-900 mb-6">${question.question}</h3>
                    
                    <div class="space-y-4">
                        ${question.options.map((option, optionIndex) => `
                            <div class="flex items-start">
                                <input id="eq${question.id}-${optionIndex}" name="external_question${question.id}" type="radio" value="${optionIndex}" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 mt-1" ${externalAnswers[question.id] === optionIndex ? 'checked' : ''}>
                                <label for="eq${question.id}-${optionIndex}" class="ml-3 block text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900 transition-colors">
                                    ${option.text}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Écouter les changements de réponse
            const radioButtons = questionsContent.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    externalAnswers[question.id] = parseInt(this.value);
                    updateExternalNavigationButtons();
                });
            });
            
            updateExternalNavigationButtons();
        }
        
        // Configuration de la navigation pour les questions externes
        function setupExternalQuestionNavigation() {
            const prevButton = document.getElementById('prev-external-question');
            const nextButton = document.getElementById('next-external-question');
            const finishButton = document.getElementById('finish-external-test');
            
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    if (currentExternalQuestionIndex > 0) {
                        currentExternalQuestionIndex--;
                        displayExternalQuestion(currentExternalQuestionIndex);
                    }
                });
            }
            
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    if (externalAnswers[EXTERNAL_EVALUATION_QUESTIONS[currentExternalQuestionIndex].id] !== undefined) {
                        if (currentExternalQuestionIndex < EXTERNAL_EVALUATION_QUESTIONS.length - 1) {
                            currentExternalQuestionIndex++;
                            displayExternalQuestion(currentExternalQuestionIndex);
                        }
                    } else {
                        alert('Veuillez sélectionner une réponse avant de continuer.');
                    }
                });
            }
            
            if (finishButton) {
                finishButton.addEventListener('click', function() {
                    if (Object.keys(externalAnswers).length === EXTERNAL_EVALUATION_QUESTIONS.length) {
                        submitExternalEvaluation();
                    } else {
                        alert('Veuillez répondre à toutes les questions avant de terminer.');
                    }
                });
            }
        }
        
        // Mise à jour des boutons de navigation externes
        function updateExternalNavigationButtons() {
            const prevButton = document.getElementById('prev-external-question');
            const nextButton = document.getElementById('next-external-question');
            const finishButton = document.getElementById('finish-external-test');
            
            if (prevButton) {
                prevButton.style.display = currentExternalQuestionIndex > 0 ? 'inline-flex' : 'none';
            }
            
            const isLastQuestion = currentExternalQuestionIndex === EXTERNAL_EVALUATION_QUESTIONS.length - 1;
            const hasAnswer = externalAnswers[EXTERNAL_EVALUATION_QUESTIONS[currentExternalQuestionIndex].id] !== undefined;
            
            if (nextButton && finishButton) {
                if (isLastQuestion) {
                    nextButton.style.display = 'none';
                    finishButton.style.display = hasAnswer ? 'inline-flex' : 'none';
                } else {
                    nextButton.style.display = 'inline-flex';
                    finishButton.style.display = 'none';
                }
            }
        }
        
        // Fonction pour soumettre l'évaluation externe
        async function submitExternalEvaluation() {
            const code = localStorage.getItem('externalEvaluationCode');
            const relation = localStorage.getItem('externalEvaluationRelation');
            
            // Calculer les scores MBTI et Ennéagramme pour cette évaluation
            const mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
            Object.keys(externalAnswers).forEach(questionId => {
                const question = EXTERNAL_EVALUATION_QUESTIONS.find(q => q.id === parseInt(questionId));
                const optionIndex = externalAnswers[questionId];
                const selectedOption = question.options[optionIndex];
                // Ajouter les scores MBTI
                Object.keys(selectedOption.mbti).forEach(trait => {
                    mbtiScores[trait] += selectedOption.mbti[trait];
                });
                // Ajouter les scores Ennéagramme
                Object.keys(selectedOption.enneagram).forEach(type => {
                    enneagramScores[type] += selectedOption.enneagram[type];
                });
            });
            // Enregistrer dans Supabase
            await saveExternalEvaluationToSupabase(code, relation, mbtiScores, enneagramScores);
            // Nettoyer le stockage local temporaire
            localStorage.removeItem('externalEvaluationCode');
            localStorage.removeItem('externalEvaluationRelation');
            // Afficher un message de confirmation
            const questionsContainer = document.getElementById('questions-container');
            questionsContainer.innerHTML = `
                <div class="max-w-2xl mx-auto text-center">
                    <div class="bg-white shadow-lg rounded-lg p-8">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <i class="fas fa-check text-green-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Évaluation terminée !</h2>
                        <p class="text-gray-600 mb-6">
                            Merci d'avoir pris le temps d'évaluer cette personne. Votre évaluation a été enregistrée avec le code <strong>${code}</strong>.
                        </p>
                        <p class="text-sm text-gray-500 mb-6">
                            La personne recevra ses résultats complets une fois que toutes les évaluations seront terminées.
                        </p>
                        <button onclick="location.reload()" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            <i class="fas fa-home mr-2"></i> Retour à l'accueil
                        </button>
                    </div>
                </div>
            `;
        }

        // Chargement de la progression au démarrage
        if (loadProgress()) {
            displayQuestion(currentQuestionIndex);
        }
        
        // Gestion du menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    const isOpen = mobileMenu.style.display === 'block';
                    
                    if (isOpen) {
                        mobileMenu.style.display = 'none';
                        menuIcon.className = 'fas fa-bars';
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    } else {
                        mobileMenu.style.display = 'block';
                        menuIcon.className = 'fas fa-times';
                        mobileMenuButton.setAttribute('aria-expanded', 'true');
                    }
                });
                
                // Fermer le menu quand on clique sur un lien
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.style.display = 'none';
                        menuIcon.className = 'fas fa-bars';
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    });
                });
            }
        });
        
        // ===== ESPACE PERSONNEL =====
        
        // Base de données simulée des profils (non utilisée, conservée pour référence)
        /* const profilesDatabase = {
            'ABC123': {
                name: 'Jean Dupont',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Ami(e)', completed: true, completedAt: '2024-01-15' },
                    { relation: 'Membre de la famille', completed: true, completedAt: '2024-01-16' },
                    { relation: 'Collègue de travail', completed: false, completedAt: null }
                ],
                results: {
                    mbti: 'ENFJ',
                    enneagram: 'Type 2',
                    certainty: 91
                }
            },
            'XYZ789': {
                name: 'Marie Martin',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Partenaire amoureux', completed: true, completedAt: '2024-01-10' },
                    { relation: 'Ami(e)', completed: false, completedAt: null },
                    { relation: 'Membre de la famille', completed: false, completedAt: null }
                ],
                results: null
            },
            'DEF456': {
                name: 'Pierre Durand',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Ami(e)', completed: true, completedAt: '2024-01-12' },
                    { relation: 'Collègue de travail', completed: true, completedAt: '2024-01-13' },
                    { relation: 'Membre de la famille', completed: true, completedAt: '2024-01-14' }
                ],
                results: {
                    mbti: 'INTJ',
                    enneagram: 'Type 5',
                    certainty: 87
                }
            }
        }; */

        // Fonctions de gestion de la modale
        function openProfileModal() {
            document.getElementById('profile-modal').classList.add('show');
            resetProfileModal();
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('show');
        }

        function resetProfileModal() {
            // Cacher toutes les étapes
            document.querySelectorAll('.profile-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Afficher l'étape de saisie du code
            document.getElementById('code-input-step').style.display = 'block';
            
            // Réinitialiser le champ de saisie
            document.getElementById('profile-code').value = '';
        }

        async function checkProfileCode() {
            const code = document.getElementById('profile-code').value.trim().toUpperCase();

            if (!code) {
                alert('Veuillez entrer un code');
                return;
            }

            // Récupération du profil via Supabase
            let result = await fetchUserProfileFromSupabase(code);
         console.log("🧠 Résultat brut depuis Supabase :", result);
console.log("📘 MBTI :", result.user?.mbti_type);
console.log("📗 Ennéagramme :", result.user?.enneagram_type);
console.log("📊 Certitude (certainty_score) :", result.user?.certainty_score);

            if (!result || !result.user) {
                // Afficher le message d'erreur
                document.querySelectorAll('.profile-step').forEach(step => {
                    step.style.display = 'none';
                });
                document.getElementById('error-message').style.display = 'block';
                return;
            }

            // Si le résultat final n'est pas encore calculé mais que
            // trois évaluations externes sont présentes, tenter de le générer.
            if ((!result.user.mbti_type || !result.user.enneagram_type) &&
                result.evaluations.length >= 3) {
                await checkAndFinalizeResults(result.user.id);
                result = await fetchUserProfileFromSupabase(code);
                if (!result) {
                    alert('Profil introuvable après mise à jour.');
                    return;
                }
            }

            const { user, evaluations } = result;
            // Construire un objet de profil simplifié compatible avec displayProfile
            const simplifiedProfile = {
                name: user.mbti_type || 'Profil',
                selfEvaluationCompleted: true,
                externalEvaluations: evaluations.map(ev => ({
                    relation: ev.relation,
                    completed: true,
                    completedAt: ev.created_at
                })),
                results: user.mbti_type && user.enneagram_type
                    ? {
                        mbti: user.mbti_type,
                        enneagram: user.enneagram_type,
                        certainty: user.certainty_score
                    }
                    : null
            };
            displayProfile(code, simplifiedProfile);
        }

        function displayProfile(code, profile) {
            // Cacher toutes les étapes
            document.querySelectorAll('.profile-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Afficher l'étape du statut
            document.getElementById('profile-status-step').style.display = 'block';
            
            // Remplir les informations du profil
            document.getElementById('profile-name').textContent = profile.name;
            document.getElementById('display-code').textContent = code;
            
            // Calculer le statut des évaluations
            const completedEvaluations = profile.externalEvaluations.filter(ev => ev.completed).length;
            // Dans notre système, un minimum de trois évaluations externes est requis
            const totalEvaluationsRequired = 3;
            const totalProgress = profile.selfEvaluationCompleted ? completedEvaluations + 1 : completedEvaluations;
            const maxProgress = totalEvaluationsRequired + 1; // +1 pour l'auto-évaluation
            
            // Mettre à jour le statut des évaluations
            const evaluationsStatus = document.getElementById('evaluations-status');
            // Si toutes les évaluations requises sont terminées, afficher le statut vert, sinon statut orange.
            if (completedEvaluations >= totalEvaluationsRequired) {
                evaluationsStatus.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                evaluationsStatus.innerHTML = '<i class="fas fa-check mr-1"></i> Toutes terminées';
            } else {
                evaluationsStatus.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800';
                evaluationsStatus.innerHTML = `<i class="fas fa-clock mr-1"></i> ${completedEvaluations}/${totalEvaluationsRequired} terminées`;
            }
            
            // Mettre à jour la barre de progression
            const progressPercent = (totalProgress / maxProgress) * 100;
            document.getElementById('progress-bar').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = `${totalProgress}/${maxProgress} terminé`;
            
            // Afficher le message selon le statut (3 évaluations requises)
            displayStatusMessage(profile, completedEvaluations, 3);
            
            // Afficher/cacher le bouton "Voir mes résultats"
            const viewResultsBtn = document.getElementById('view-results-btn');
            if (completedEvaluations >= totalEvaluationsRequired) {
                viewResultsBtn.style.display = 'block';
            } else {
                viewResultsBtn.style.display = 'none';
            }
        }

        function displayStatusMessage(profile, completedEvaluations, totalEvaluations) {
            const statusMessage = document.getElementById('status-message');
            const totalRequired = 3;
            const remaining = totalRequired - completedEvaluations;
            
            if (completedEvaluations >= totalRequired) {
                // Toutes les évaluations sont terminées
                statusMessage.className = 'rounded-lg p-4 mb-4 bg-green-50 border border-green-200';
                statusMessage.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-green-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Analyse complète !</h3>
                            <div class="mt-2 text-sm text-green-700">
                                <p>Félicitations ! Toutes les évaluations ont été complétées. Vous pouvez maintenant consulter votre profil de personnalité complet.</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Des évaluations sont encore en attente
                statusMessage.className = 'rounded-lg p-4 mb-4 bg-yellow-50 border border-yellow-200';
                const personText = remaining === 1 ? 'personne' : 'personnes';
                const verbText = remaining === 1 ? 'complète' : 'complètent';
                
                statusMessage.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-clock text-yellow-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800">Évaluations en cours</h3>
                            <div class="mt-2 text-sm text-yellow-700">
                                <p>Il reste <strong>${remaining} ${personText}</strong> qui ${remaining === 1 ? 'doit' : 'doivent'} ${verbText} l'évaluation pour que vous puissiez accéder à votre profil complet.</p>
                                <p class="mt-1">Partagez votre code unique avec vos proches pour qu'ils puissent vous évaluer.</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function shareProfileCode() {
            const code = document.getElementById('display-code').textContent;
            const shareText = `Salut ! Peux-tu m'aider à mieux comprendre ma personnalité ? Utilise ce code ${code} sur https://personnalite-comparee.fr pour m'évaluer. Merci ! 😊`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Évaluation de personnalité',
                    text: shareText
                });
            } else {
                // Fallback: copier dans le presse-papiers
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Message copié dans le presse-papiers ! Vous pouvez le partager avec vos proches.');
                }).catch(() => {
                    // Fallback ultime: afficher le texte
                    prompt('Copiez ce message pour le partager:', shareText);
                });
            }
        }

        async function viewResults() {
            const code = document.getElementById('display-code').textContent;
            let result = await fetchUserProfileFromSupabase(code);
            if (!result) {
                alert('Profil introuvable.');
                return;
            }
            // Calculer le résultat final si nécessaire
            if (!result.user.mbti_type || !result.user.enneagram_type) {
                if (result.evaluations.length >= 3) {
                    await checkAndFinalizeResults(result.user.id);
                    // petite pause pour laisser le temps à la mise à jour
                    await new Promise(r => setTimeout(r, 300));
                    result = await fetchUserProfileFromSupabase(code);
                }
            }
            if (!result.user.mbti_type || !result.user.enneagram_type) {
                alert('Le résultat final n’est pas encore prêt. Veuillez patienter encore quelques instants.');
                return;
            }
            // Recalculer uniquement les indices de certitude individuels
            const { mbtiCertainty, enneagramCertainty } = computeWeightedResults(
                result.user.mbti_scores,
                result.user.enneagram_scores,
                result.evaluations
            );

            const finalProfile = {
                name: result.user.mbti_type,
                results: {
                    mbti: result.user.mbti_type,
                    mbtiCertainty,
                    enneagram: result.user.enneagram_type,
                    enneagramCertainty,
                    overallCertainty: result.user.certainty_score
                },
                externalEvaluations: result.evaluations.map(ev => ({
                    relation: ev.relation,
                    completed: true,
                    completedAt: ev.created_at
                }))
            };
            // Fermer la modale
            closeProfileModal();
            // Afficher les résultats détaillés
            displayDetailedResults(finalProfile, code);
        }

        function displayDetailedResults(profile, code) {
            // Créer une nouvelle modale pour les résultats
            const resultsModal = document.createElement('div');
            resultsModal.id = 'results-modal';
            resultsModal.className = 'modal show';
            resultsModal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2 class="text-xl font-bold text-gray-900">Résultats Détaillés - ${profile.name}</h2>
                        <span class="close" onclick="closeResultsModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-6">
                            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                                <i class="fas fa-chart-pie text-green-600 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Analyse Complète</h3>
                            <p class="text-sm text-gray-500">Code: <span class="font-mono font-bold">${code}</span></p>
                        </div>

                        <!-- Résultats MBTI et Ennéagramme -->
        <div class="grid md:grid-cols-2 gap-6 mb-6">
          <div class="bg-blue-50 rounded-lg p-4">
            <h4 class="font-semibold text-blue-900 mb-2">Type MBTI</h4>
            <div class="text-2xl font-bold text-blue-600 mb-2">${profile.results.mbti}</div>
            <div class="mt-2">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-blue-900">Certitude</span>
                <span class="text-sm text-blue-700">${profile.results.mbtiCertainty}%</span>
              </div>
              <div class="w-full bg-blue-100 rounded-full h-2 mt-1">
                <div class="bg-blue-600 h-2 rounded-full" style="width: ${profile.results.mbtiCertainty}%"></div>
              </div>
            </div>
          </div>
          <div class="bg-purple-50 rounded-lg p-4">
            <h4 class="font-semibold text-purple-900 mb-2">Ennéagramme</h4>
            <div class="text-2xl font-bold text-purple-600 mb-2">${profile.results.enneagram}</div>
            <div class="mt-2">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-purple-900">Certitude</span>
                <span class="text-sm text-purple-700">${profile.results.enneagramCertainty}%</span>
              </div>
              <div class="w-full bg-purple-100 rounded-full h-2 mt-1">
                <div class="bg-purple-600 h-2 rounded-full" style="width: ${profile.results.enneagramCertainty}%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Certitude globale -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <div class="flex items-center justify-between mb-2">
            <span class="font-medium text-gray-900">Certitude globale</span>
            <span class="text-lg font-bold text-green-600">${profile.results.overallCertainty}%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-green-500 h-3 rounded-full" style="width: ${profile.results.overallCertainty}%"></div>
          </div>
          <p class="text-sm text-gray-600 mt-2">Basé sur la cohérence entre votre auto-évaluation et les évaluations de vos proches</p>
        </div>

                        <!-- Détail des évaluations -->
                        <div class="mb-6">
                            <h4 class="font-semibold text-gray-900 mb-3">Détail des évaluations</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                    <span class="text-sm font-medium text-gray-700">Votre auto-évaluation</span>
                                    <span class="text-sm text-green-600 font-medium">✓ Complétée</span>
                                </div>
                                ${profile.externalEvaluations.map(eval => `
                                    <div class="flex items-center justify-between p-3 ${eval.completed ? 'bg-green-50' : 'bg-gray-50'} rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">${eval.relation}</span>
                                        <span class="text-sm ${eval.completed ? 'text-green-600' : 'text-gray-500'} font-medium">
                                            ${eval.completed ? '✓ Complétée le ' + new Date(eval.completedAt).toLocaleDateString('fr-FR') : '⏳ En attente'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex space-x-3">
                            <button onclick="downloadResults('${code}')" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                <i class="fas fa-download mr-2"></i>
                                Télécharger PDF
                            </button>
                            <button onclick="shareProfileResults('${code}')" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                                <i class="fas fa-share mr-2"></i>
                                Partager
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Ajouter la modale au DOM
            document.body.appendChild(resultsModal);
        }

        function closeResultsModal() {
            const modal = document.getElementById('results-modal');
            if (modal) {
                modal.remove();
            }
        }

        function downloadResults(code) {
            alert('Fonctionnalité de téléchargement PDF en développement. Votre rapport détaillé sera bientôt disponible !');
        }

        async function shareProfileResults(code) {
            // Récupérer le profil final à partager
            const result = await fetchUserProfileFromSupabase(code);
            if (!result || !result.user.mbti_type || !result.user.enneagram_type) {
                alert('Impossible de partager : le profil complet n’est pas encore disponible.');
                return;
            }
const shareText = `Je viens de découvrir mon profil de personnalité complet ! Je suis ${result.user.mbti_type} (type ${result.user.enneagram_type}) avec ${result.user.certainty_score}% de certitude. Découvrez le vôtre sur https://personnalite-comparee.fr`;
            if (navigator.share) {
                navigator.share({
                    title: 'Mon profil de personnalité',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Résultats copiés dans le presse-papiers !');
                }).catch(() => {
                    prompt('Copiez ce message pour le partager:', shareText);
                });
            }
        }

        async function afficherProfilUtilisateur() {
            const codeInput = document.getElementById("code-saisi").value;
            const profilDiv = document.getElementById("profil-resultat");

            if (typeof codeInput !== "string") {
                console.error("Type de code invalide:", typeof codeInput);
                profilDiv.innerHTML = "<p class='text-red-600'>⚠️ Code invalide.</p>";
                return;
            }

            const code = codeInput.trim().toUpperCase();
            console.log("Code saisi:", code);

            if (!code) {
                profilDiv.innerHTML = "<p class='text-red-600'>⚠️ Merci d’entrer un code valide.</p>";
                return;
            }

            // Animation de chargement
            profilDiv.innerHTML = '<div class="flex justify-center mt-4"><div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div></div>';

            const { data, error } = await supabase
                .from("users")
                .select("mbti_type, enneagram_type, certainty_score")
                .eq("code", code);

            console.log("Résultat Supabase:", data, "Erreur:", error);

            if (error) {
                profilDiv.innerHTML = "<p class='text-red-600'>❌ Erreur lors de la récupération du profil.</p>";
                return;
            }

            if (data && data.length > 0) {
                const user = data[0];
                profilDiv.innerHTML = `
                <div class="bg-gray-100 p-4 rounded shadow mt-4">
                  <p class="mb-2">🧠 Type MBTI : <strong>${user.mbti_type}</strong></p>
                  <p class="mb-2">🎭 Ennéatype : <strong>${user.enneagram_type}</strong></p>
                  <p class="mb-2">📊 Indice de certitude : <strong>${user.certainty_score}%</strong></p>
                </div>
                `;
            } else {
                profilDiv.innerHTML = "<p class='text-red-600'>❌ Code invalide ou introuvable.</p>";
            }
        }

        // Fermer la modale en cliquant à l'extérieur
        window.onclick = function(event) {
            const profileModal = document.getElementById('profile-modal');
            const resultsModal = document.getElementById('results-modal');
            
            if (event.target === profileModal) {
                closeProfileModal();
            }
            if (event.target === resultsModal) {
                closeResultsModal();
            }
        }

        // Permettre la saisie du code avec Entrée
        document.addEventListener('DOMContentLoaded', function() {
            const profileCodeInput = document.getElementById('profile-code');
            if (profileCodeInput) {
                profileCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkProfileCode();
                    }
                });
                
                // Forcer la saisie en majuscules
                profileCodeInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase();
                });
            }
        });
    </script>

    <!-- Modales pour les descriptions détaillées -->
    <div id="modal-container"></div>

    <!-- Modale Espace Personnel -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-bold text-gray-900">Mon Espace Personnel</h2>
                <span class="close" onclick="closeProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Étape 1: Saisie du code -->
                <div id="code-input-step" class="profile-step">
                    <div class="text-center mb-6">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                            <i class="fas fa-key text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Accédez à votre profil</h3>
                        <p class="text-sm text-gray-500">Entrez votre code unique pour consulter vos résultats</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="profile-code" class="block text-sm font-medium text-gray-700 mb-2">Code unique</label>
                            <input type="text" id="profile-code" placeholder="Entrez votre code (ex: ABC123)" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-center text-lg font-mono tracking-wider uppercase">
                        </div>
                        <button onclick="checkProfileCode()" class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            Accéder à mon profil
                        </button>
                    </div>
                </div>

                <!-- Étape 2: Statut des évaluations -->
                <div id="profile-status-step" class="profile-step" style="display: none;">
                    <div class="text-center mb-6">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                            <i class="fas fa-user-circle text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Profil de <span id="profile-name"></span></h3>
                        <p class="text-sm text-gray-500">Code: <span id="display-code" class="font-mono font-bold"></span></p>
                    </div>

                    <!-- Statut des évaluations -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="font-medium text-gray-900 mb-3">Statut des évaluations</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Votre auto-évaluation</span>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <i class="fas fa-check mr-1"></i> Terminée
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Évaluations des proches</span>
                                <span id="evaluations-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium">
                                    <!-- Sera rempli dynamiquement -->
                                </span>
                            </div>
                        </div>
                        
                        <!-- Barre de progression -->
                        <div class="mt-4">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Progression globale</span>
                                <span id="progress-text">0/4 terminé</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Message selon le statut -->
                    <div id="status-message" class="rounded-lg p-4 mb-4">
                        <!-- Sera rempli dynamiquement -->
                    </div>

                    <!-- Actions -->
                    <div class="flex space-x-3">
                        <button onclick="shareProfileCode()" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            <i class="fas fa-share mr-2"></i>
                            Partager mon code
                        </button>
                        <button id="view-results-btn" onclick="viewResults()" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" style="display: none;">
                            <i class="fas fa-chart-pie mr-2"></i>
                            Voir mes résultats
                        </button>
                    </div>
                </div>

                <!-- Message d'erreur -->
                <div id="error-message" class="profile-step" style="display: none;">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Code introuvable</h3>
                        <p class="text-sm text-gray-500 mb-4">Le code que vous avez entré n'existe pas ou est incorrect.</p>
                        <button onclick="resetProfileModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            Réessayer
                        </button>
                    </div>
                </div>
    </div>
        </div>
    </div>

<script>
  async function sendChatMessage(message) {
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'gpt-3.5-turbo',
          messages: [
            { role: 'system', content: 'Tu es un assistant spécialisé en MBTI et Ennéagramme.' },
            { role: 'user', content: message }
          ]
        })
      });

      if (!response.ok) {
        console.error("Erreur de l’API OpenAI:", await response.text());
        return "Impossible de contacter l'IA pour le moment.";
      }

      const data = await response.json();
return data.message || "Réponse vide de l'IA.";

    } catch (err) {
      console.error("Erreur réseau:", err);
      return "Une erreur est survenue lors de la communication avec l'IA.";
    }
  }

  function appendMessage(role, text) {
    const chatBox = document.getElementById('chat-box');
    if (!chatBox) return;
    const wrapper = document.createElement('div');
    wrapper.className = role === 'user' ? 'text-right mb-2' : 'text-left mb-2';
    wrapper.innerHTML = `<span class="inline-block px-3 py-2 rounded-lg ${role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}">${text}</span>`;
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const sendBtn = document.getElementById('chat-send');
    const input = document.getElementById('chat-input');
    if (sendBtn && input) {
      const sendMessage = async () => {
        const question = input.value.trim();
        if (!question) return;
        appendMessage('user', question);
        input.value = '';
        const answer = await sendChatMessage(question);
        appendMessage('assistant', answer);
      };
      sendBtn.addEventListener('click', sendMessage);
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage();
        }
      });
    }
  });
</script>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = "https://swjnpvfkloubshksobau.supabase.co";
  const supabaseKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3am5wdmZrbG91YnNoa3NvYmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwOTUxMzEsImV4cCI6MjA2OTY3MTEzMX0.A6rnIJyfIIxDT0c2XW_zGeUXpdYCgBFd6MTzBGFZ-Cg";

  const supabase = createClient(supabaseUrl, supabaseKey);
  window.supabase = supabase;

  const externalForm = document.getElementById("external-form");

  const params = new URLSearchParams(window.location.search);
  const code = params.get("code")?.toUpperCase();
  const encodedCode = code ? encodeURIComponent(code) : null;

  if (encodedCode) {
    (async () => {
      if (externalForm) {
        externalForm.style.display = "none";
      }

      try {
        const { data: user, error } = await supabase
          .from("users")
          .select("id")
          .eq("code", encodedCode)
          .single();

        if (error || !user) {
          alert("Code invalide ou introuvable.");
          return;
        } else if (externalForm) {
          externalForm.style.display = "";
        }
      } catch (err) {
        console.error("Erreur lors de la vérification du code :", err);
        alert("Code invalide ou introuvable.");
        return;
      }
    })();
  }

  if (externalForm) {
    externalForm.addEventListener("submit", (e) => {
      e.preventDefault();
      alert("Merci pour votre participation. Les résultats sont disponibles dans la section 'Mon profil'.");
      externalForm.reset();
      externalForm.style.display = "none";
    });
  }
</script>

</body>
</html>



      
