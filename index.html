<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personnalit√© Compar√©e | Test MBTI & Enn√©agramme Gratuit</title>

  <!-- Supabase JS -->

  <!-- SEO Meta Tags -->
  <meta name="description" content="D√©couvrez votre vraie personnalit√© avec notre test MBTI et Enn√©agramme gratuit. Analyse objective combinant votre auto-√©valuation et l'avis de vos proches.">
  <meta name="keywords" content="test personnalit√©, MBTI, enn√©agramme, psychologie, 16 types, auto-√©valuation, gratuit">
  <meta name="author" content="Personnalit√© Compar√©e">
  <meta name="robots" content="index, follow">


  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:title" content="Personnalit√© Compar√©e | Test MBTI & Enn√©agramme Gratuit">
  <meta property="og:description" content="D√©couvrez votre vraie personnalit√© avec notre test MBTI et Enn√©agramme gratuit. Analyse objective combinant votre auto-√©valuation et l'avis de vos proches.">
    <meta property="og:image" content="logo.jpg">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="Personnalit√© Compar√©e | Test MBTI & Enn√©agramme Gratuit">
    <meta property="twitter:description" content="D√©couvrez votre vraie personnalit√© avec notre test MBTI et Enn√©agramme gratuit. Analyse objective combinant votre auto-√©valuation et l'avis de vos proches.">
      <meta property="twitter:image" content="logo.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="loogo test.PNG">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.0.7/countUp.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Supabase JS library -->
   
    <style>
        html, body {
            overflow-x: hidden;
        }
        body {
            transition: background-color 0.3s, color 0.3s;
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        button,
        [class*="card"] {
            transition: all 0.3s ease;
        }

        button:hover {
            transform: rotateX(3deg) rotateY(3deg) scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        [class*="card"]:hover {
            transform: perspective(600px) rotateX(3deg) rotateY(-3deg) scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .question-card {
            min-height: 300px;
        }
        .floating-btn {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .personality-badge {
            border-radius: 50px;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* Styles pour les modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .close {
            color: #9ca3af;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .close:hover,
        .close:focus {
            color: #374151;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .mobile-menu {
            display: block;
        }
        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .question-container {
            display: none;
        }
        .question-container.active {
            display: block;
        }

        .section-clair {
            background-color: #ffffff;
        }

        .section-fonce {
            background-color: #fbfbfb;
        }

        /* Menu mobile cach√© par d√©faut */
        .mobile-menu {
            display: none;
        }

        .scroll-highlight {
            animation: scrollHighlight 1s ease;
        }
        @keyframes scrollHighlight {
            from { background-color: #fef3c7; }
            to { background-color: #ffffff; }
        }

        /* Chat styles */
        .chat-row {
            display: flex;
            margin-bottom: 8px;
        }
        .chat-row.user {
            justify-content: flex-end;
        }
        .chat-row.assistant {
            justify-content: flex-start;
        }
        .chat-bubble {
            display: inline-block;
            padding: 10px 14px;
            font-size: 15px;
        }
        .assistant-bubble {
            background: #e0f0ff;
            color: #003b5c;
            border-radius: 16px 16px 16px 4px;
        }
        .user-bubble {
            background: #d1ffe0;
            color: #084d28;
            border-radius: 16px 16px 4px 16px;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .assistant-bubble.limit-error {
            background: #ffe5e5;
            border: 1px solid #ff0000;
            color: #b30000;
            font-weight: bold;
            animation: shake 0.4s;
        }
        .question-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            font-size: 14px;
            margin-top: auto;
            padding: 12px;
        }
        .question-buttons button {
            padding: 6px 12px;
            border-radius: 8px;
            background-color: #e7f1fb;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .question-buttons button:hover {
            background-color: #d0e7f7;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .pc-typing {
            position: sticky;
            bottom: 0;
            padding: 8px 12px;
            background: rgba(0,0,0,0.04);
            backdrop-filter: blur(2px);
            border-top: 1px solid rgba(0,0,0,0.06);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .pc-typing[hidden] { display: none; }
        .pc-dots span {
            animation: pc-blink 1.2s infinite;
            display: inline-block;
            padding-left: 2px;
        }
        .pc-dots span:nth-child(2) { animation-delay: .2s; }
        .pc-dots span:nth-child(3) { animation-delay: .4s; }
        @keyframes pc-blink {
            0% { opacity: 0.2; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-1px); }
            100% { opacity: 0.2; transform: translateY(0); }
        }
        .spinner {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: -2px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg);} to { transform: rotate(360deg);} }
        :root{
          --pc-line: rgba(59,130,246,.30);  /* bleu doux (#3B82F6) */
          --pc-dot:  rgba(10,15,26,.62);
        }
        /* le conteneur de la banni√®re doit d√©j√† √™tre positionn√© ; sinon: */
        .pc-hero { position: relative; isolation: isolate; }

        #pc-constellation{
          position: absolute; inset: 0; width: 100%; height: 100%;
          pointer-events: none; z-index: 0; /* contenu texte reste au-dessus */
        }

        @media (prefers-reduced-motion: reduce){
          #pc-constellation{ display:none !important; }
        }

        .pc-info-banner{
          background:#eef2ff;
          color:#0f172a;
          border:1px solid rgba(59,130,246,.25);
          border-radius:12px;
          padding:14px 16px;
          margin:16px 0 12px;
          line-height:1.5;
          font-size:.95rem;
        }
        @media (max-width:768px){
          .pc-info-banner{ margin:12px 0; font-size:.93rem; }
        }

       /* Styles sp√©cifiques au chatbot Psycho'Bot */
#chat-window {
  border-radius: 32px !important;
  overflow: hidden !important;
}

#chat-input {
  border-top-left-radius: 9999px !important;
  border-bottom-left-radius: 9999px !important;
  border: none !important;
}

#chat-send {
  border-top-right-radius: 9999px !important;
  border-bottom-right-radius: 9999px !important;
  border: none !important;
}

    </style>

</head>
<body class="font-sans bg-white text-gray-900">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <img src="logo111.png" alt="Personnalit√© Compar√©e logo" class="w-10 h-10 rounded-full object-cover">
<span id="brand-home" class="ml-3 text-xl font-bold text-black">Personnalit√© Compar√©e</span>
                    </div>
                </div>
                <div class="desktop-nav hidden md:ml-6 md:flex md:items-center md:space-x-8">
                    <a href="#" class="scroll-top-link text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-blue-500 text-sm font-medium">Accueil</a>
                    <a href="#mbti" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">MBTI</a>
                    <a href="#enneagram" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">Enn√©agramme</a>
                    <a href="#profil-chatbot" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">IA sp√©cialis√©e</a>
                    <a href="#faq" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">FAQ</a>
                    <button id="profile-btn-desktop" onclick="openProfileModal()" class="ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Mon profil
                    </button>
                </div>
                <div class="-mr-2 flex items-center md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Ouvrir le menu principal</span>
                        <i class="fas fa-bars" id="menu-icon"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Menu mobile -->
        <div class="mobile-menu md:hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white border-t border-gray-200">
                <a href="#" class="scroll-top-link text-gray-900 block px-3 py-2 rounded-md text-base font-medium bg-blue-50">Accueil</a>
                <a href="#mbti" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">MBTI</a>
                <a href="#enneagram" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">Enn√©agramme</a>
                <a href="#profil-chatbot" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">IA sp√©cialis√©e</a>
                <a href="#faq" class="text-gray-500 hover:text-gray-700 block px-3 py-2 rounded-md text-base font-medium">FAQ</a>
                <button id="profile-btn-mobile" onclick="openProfileModal()" class="w-full mt-2 inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                    Mon profil
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section Premium -->
    <div data-aos="fade-up" class="section-clair relative flex items-center justify-center overflow-hidden pc-hero" data-hero style="min-height: 80vh;">
        <canvas id="pc-constellation" aria-hidden="true"></canvas>
        <!-- Grille subtile en arri√®re-plan -->
        <div class="absolute inset-0 opacity-[0.02]">
            <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, rgb(15 23 42) 1px, transparent 0); background-size: 40px 40px;"></div>
        </div>
        
        <!-- √âl√©ments g√©om√©triques minimalistes -->
        <div class="absolute top-1/4 right-1/4 w-2 h-2 bg-blue-400/20 rounded-full"></div>
        <div class="absolute bottom-1/3 left-1/5 w-1 h-1 bg-slate-400/30 rounded-full"></div>
        <div class="absolute top-2/3 right-1/3 w-1.5 h-1.5 bg-blue-300/25 rounded-full"></div>
        
        <div class="relative max-w-5xl mx-auto px-6 py-16 text-center">
<img src="nouveau logo.JPEG" alt="Nouveau logo" class="mx-auto mb-8 w-28 sm:w-32 h-auto">
            
            <!-- Titre principal avec hi√©rarchie claire -->
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-semibold tracking-tight text-slate-900 mb-6 leading-tight">
                Et si vous vous connaissiez
                <br>
                <span class="text-blue-600 font-medium"><strong>vraiment</strong></span> ?
            </h1>
            
            <!-- Sous-titre √©pur√© -->
   <p class="max-w-2xl mx-auto text-lg md:text-xl text-slate-600 leading-relaxed mb-12 font-light">
    La premi√®re plateforme qui combine 
    <span class="font-medium text-slate-800">test MBTI</span> & <span class="font-medium text-slate-800">Enn√©agramme</span>, 
    validation par l‚Äôentourage et <span class="font-medium text-slate-800">IA sp√©cialis√©e</span> pour r√©pondre √† toutes vos questions.
</p>
            
            <!-- Boutons premium -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-12">
                <a href="#auto-evaluation" class="group relative inline-flex items-center gap-3 px-8 py-4 text-base font-medium text-white bg-slate-900 hover:bg-slate-800 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl">
                    <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Commencer l'analyse
                    <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
                
                <a href="#evaluation-proche" class="group inline-flex items-center gap-3 px-8 py-4 text-base font-medium text-slate-700 bg-white hover:bg-slate-50 border border-slate-200 hover:border-slate-300 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md">
                    <svg class="w-5 h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    √âvaluer quelqu'un
                </a>
            </div>
            
            <!-- Indicateurs de confiance int√©gr√©s discr√®tement -->
            <div class="flex items-center justify-center gap-8 text-sm text-slate-500">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                    <span>16 profils MBTI</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                    <span>9 types Enn√©agramme</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                    <span>Validation par les proches</span>
                </div>
            </div>
        </div>
        
        
    </div>

    <!-- How it works -->
    <div data-aos="fade-right" class="section-fonce py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Comment √ßa marche ?
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    Une approche innovante pour une analyse plus objective de votre personnalit√©
                </p>
            </div>
            <div class="mt-20">
                <div class="grid grid-cols-1 gap-12 md:grid-cols-3">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-user text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>1. Auto-√©valuation</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                R√©pondez √† 16 questions simples pour √©tablir votre propre perception de votre personnalit√©.
                            </p>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>2. √âvaluation par 3 proches</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                Partagez votre code unique avec 3 personnes de votre entourage qui r√©pondront √† 20 questions.
                            </p>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                            <i class="fas fa-chart-pie text-xl"></i>
                        </div>
                        <div class="mt-5">
                            <h3 class="text-lg font-medium text-gray-900"><strong>3. Profil complet</strong></h3>
                            <p class="mt-2 text-base text-gray-500">
                                Recevez une analyse pond√©r√©e combinant votre auto-√©valuation et les √©valuations de vos proches.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-evaluation Section -->
    <div id="auto-evaluation" data-aos="zoom-in" class="section-clair py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Auto-√©valuation
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    R√©pondez √† ces 16 questions pour commencer votre analyse
                </p>
            </div>
            
            <!-- Question Cards Container -->
            <div id="questions-container" class="mt-12">
                <!-- Questions will be dynamically inserted here -->
            </div>
            
            <!-- Navigation buttons -->
            <div class="mt-8 flex justify-between">
                <button id="prev-question" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" style="display: none;">
                    <i class="fas fa-arrow-left mr-2"></i> Question pr√©c√©dente
                </button>
                <button id="next-question" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Question suivante <i class="fas fa-arrow-right ml-2"></i>
                </button>
                <button id="finish-test" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                    Terminer le test <i class="fas fa-check ml-2"></i>
                </button>
            </div>
        </div>
    </div>


    <!-- Evaluate a friend Section -->
<div id="evaluation-proche" data-aos="fade-left" class="section-fonce py-16 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Titres (en dehors de l'encadr√©) -->
    <div class="text-center">
      <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
        √âvaluer un proche
      </h2>
      <p class="mt-4 text-xl text-gray-500">
        Aidez un ami, un membre de votre famille ou un coll√®gue √† mieux comprendre sa personnalit√©
      </p>
    </div>

    <!-- Encadr√© arrondi fa√ßon chatbot -->
    <div class="mt-10">
      <div
        class="rounded-2xl border border-gray-200 bg-white shadow-sm ring-1 ring-black/5">
        <div class="px-6 sm:px-8 py-8">
          <form id="evaluation-form" class="space-y-8">
            <!-- Code unique -->
            <div>
              <label for="code" class="block text-sm font-medium text-gray-700">
                Code unique de la personne
              </label>
              <div class="mt-2 relative">
                <input
                  type="text"
                  name="code"
                  id="code"
                  required
                  placeholder="Ex: ABC123"
                  class="block w-full rounded-lg border border-gray-300 py-3 pl-4 pr-12 text-sm focus:border-blue-500 focus:ring-blue-500"
                />
                <button
                  type="button"
                  id="search-code"
                  class="absolute inset-y-0 right-0 my-1 mr-1 inline-flex items-center justify-center rounded-md bg-gray-100 px-3 text-blue-600 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  aria-label="Rechercher le code"
                  title="Rechercher le code">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <p class="mt-2 text-sm text-gray-500">
                Entrez le code que votre proche vous a communiqu√©
              </p>
            </div>

            <!-- Relation -->
            <div>
              <span class="block text-sm font-medium text-gray-700 mb-3">
                Votre relation avec cette personne
              </span>

              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <!-- Famille -->
                <label for="family"
                  class="flex cursor-pointer gap-3 rounded-xl border border-gray-200 p-4 hover:bg-gray-50">
                  <input
                    id="family"
                    name="relation"
                    type="radio"
                    value="family"
                    required
                    class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                  />
                  <div class="text-sm">
                    <div class="font-medium text-gray-700">Membre de la famille</div>
                    <p class="text-gray-500">Parent, fr√®re, s≈ìur, enfant...</p>
                  </div>
                </label>

                <!-- Partenaire -->
                <label for="partner"
                  class="flex cursor-pointer gap-3 rounded-xl border border-gray-200 p-4 hover:bg-gray-50">
                  <input
                    id="partner"
                    name="relation"
                    type="radio"
                    value="partner"
                    required
                    class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                  />
                  <div class="text-sm">
                    <div class="font-medium text-gray-700">Partenaire amoureux</div>
                    <p class="text-gray-500">Conjoint, petit(e) ami(e)...</p>
                  </div>
                </label>

                <!-- Ami -->
                <label for="friend"
                  class="flex cursor-pointer gap-3 rounded-xl border border-gray-200 p-4 hover:bg-gray-50">
                  <input
                    id="friend"
                    name="relation"
                    type="radio"
                    value="friend"
                    required
                    class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                  />
                  <div class="text-sm">
                    <div class="font-medium text-gray-700">Ami(e)</div>
                    <p class="text-gray-500">Ami proche, meilleur ami...</p>
                  </div>
                </label>

                <!-- Coll√®gue -->
                <label for="colleague"
                  class="flex cursor-pointer gap-3 rounded-xl border border-gray-200 p-4 hover:bg-gray-50">
                  <input
                    id="colleague"
                    name="relation"
                    type="radio"
                    value="colleague"
                    required
                    class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"
                  />
                  <div class="text-sm">
                    <div class="font-medium text-gray-700">Coll√®gue de travail</div>
                    <p class="text-gray-500">Coll√®gue, manager, collaborateur...</p>
                  </div>
                </label>
              </div>
            </div>

            <!-- CTA -->
            <div class="flex justify-center">
              <button
                type="button"
                onclick="startExternalEvaluation()"
                class="inline-flex items-center rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Commencer l'√©valuation
                <i class="fas fa-play ml-2"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- /Encadr√© -->
  </div>
</div>


<!-- Section Chatbot -->
<section id="profil-chatbot" data-aos="fade-up" class="section-clair py-16 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <div class="text-center">
      <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Parler avec Psycho'Bot</h2>
      <p class="mt-4 text-xl text-gray-500">
        Discutez avec notre assistant IA pour en savoir plus sur les profils MBTI et Enn√©agramme.
      </p>
    </div>

    <div class="mt-8">
      <!-- Fen√™tre de chat -->
      <div id="chat-window" class="h-[280px] sm:h-[320px] border border-gray-200 mb-4 bg-gray-50 flex flex-col">
        <div id="chat-box" class="flex-1 overflow-y-auto p-4" style="scroll-behavior: smooth;"></div>
        <div id="chat-suggestions" class="question-buttons fade-in p-3">
          <button class="suggestion-bubble" data-question="Quel type est compatible avec un ENFP ?">‚ù§Ô∏è Quel type est compatible avec un ENFP ?</button>
          <button class="suggestion-bubble" data-question="Comment est calcul√©e la certitude globale ?">üìä Comment est calcul√©e la certitude globale ?</button>
          <button class="suggestion-bubble" data-question="Pourquoi demander l‚Äôavis de mes proches ?">ü§ù Pourquoi demander l‚Äôavis de mes proches ?</button>
        </div>
        <div id="pc-typing-indicator" class="pc-typing" aria-live="polite" role="status" hidden>
          <span class="pc-typing-text">Psycho'Bot est en train d'√©crire<span class="pc-dots"><span>.</span><span>.</span><span>.</span></span></span>
        </div>
      </div>

    <!-- Zone de saisie -->
<div class="flex">
  <input id="chat-input" type="text" placeholder="Posez votre question..."
         class="flex-grow px-4 py-2 border border-gray-300 rounded-2xl focus:ring-blue-500 focus:border-blue-500">
  <button id="chat-send" class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700">Envoyer</button>
</div>
</div>
</div>
</section>


<script>
  function scrollChatToBottom() {
    const box = document.getElementById('chat-box');
    if (box) box.scrollTop = box.scrollHeight;
  }
</script>


    <section id="retourver-profil" data-aos="zoom-in" class="section-fonce py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
          <div class="text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl flex justify-center items-center gap-2">
              <i class="fas fa-search text-blue-500 animate-pulse"></i>
              Retrouver un profil
            </h2>
            <p class="mt-4 text-xl text-gray-500">
              Saisis le code unique que tu as re√ßu pour afficher un profil complet.
            </p>
          </div>
          <form onsubmit="event.preventDefault(); viewResults(document.getElementById('code-saisi').value);" autocomplete="off" class="mt-12 max-w-lg mx-auto">
            <div class="flex flex-col sm:flex-row items-center gap-4">
              <label for="code-saisi" class="sr-only">Code re√ßu</label>
              <input type="text" id="code-saisi" class="flex-1 px-6 py-3 border border-gray-200 rounded-lg focus:ring-blue-500 focus:border-blue-500 placeholder:text-gray-300 text-base text-center shadow-sm transition" placeholder="ABC123" maxlength="12" required>
              <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">
                <i class="fas fa-eye"></i> Voir le profil
              </button>
            </div>
          </form>
        </div>
      </section>

    <!-- MBTI Types Section -->
    <div id="mbti" data-aos="fade-right" class="section-clair py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Les 16 types de personnalit√© MBTI
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    D√©couvrez les diff√©rents profils de la typologie Myers-Briggs
                </p>
            </div>
            
            <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Analystes (NT) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Architecte</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Visionnaires strat√©giques avec un plan pour tout. Ind√©pendants et d√©termin√©s √† atteindre leurs objectifs.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Commandant</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Leaders naturels, charismatiques et d√©termin√©s. Excellents pour organiser et mettre en ≈ìuvre des plans.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                                <i class="fas fa-microscope text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INTP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Penseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Penseurs logiques et cr√©atifs, toujours √† la recherche de nouvelles id√©es et possibilit√©s th√©oriques.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Diplomates (NF) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                                <i class="fas fa-lightbulb text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Donateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Charismatiques et empathiques, motiv√©s par le d√©sir d'aider les autres √† r√©aliser leur potentiel.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-500 rounded-md p-3">
                                <i class="fas fa-heart text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ENFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Inspirateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Enthousiastes, cr√©atifs et sociables, toujours √† la recherche de nouvelles id√©es et exp√©riences.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ENFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-teal-500 rounded-md p-3">
                                <i class="fas fa-dove text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Avocat</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Id√©alistes cr√©atifs et perspicaces, motiv√©s par leurs valeurs profondes et leur vision du futur.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-pink-500 rounded-md p-3">
                                <i class="fas fa-palette text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">INFP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le M√©diateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Po√©tiques, gentils et altruistes, toujours d√©sireux d'aider une bonne cause ou une personne importante.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('INFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sentinelles (SJ) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-gray-600 rounded-md p-3">
                                <i class="fas fa-balance-scale text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Logisticien</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Pratiques et factuels, fiables et responsables. Ils aiment l'ordre et respectent les traditions.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-orange-500 rounded-md p-3">
                                <i class="fas fa-shield-alt text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Protecteur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Chaleureux et consciencieux, toujours pr√™ts √† prot√©ger leurs proches et √† maintenir l'harmonie.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-600 rounded-md p-3">
                                <i class="fas fa-bullhorn text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESTJ</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Ex√©cutif</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Excellents administrateurs, incomparables pour g√©rer les choses et les personnes avec efficacit√©.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESTJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-600 rounded-md p-3">
                                <i class="fas fa-hands-helping text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESFJ</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Consul</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Extraordinairement attentionn√©s, sociables et populaires, toujours d√©sireux d'aider les autres.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESFJ')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Explorateurs (SP) -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-yellow-600 rounded-md p-3">
                                <i class="fas fa-tools text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISTP</h3>
                                <p class="mt-1 text-sm text-gray-500">Le Virtuose</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                M√©caniciens audacieux et pratiques, ma√Ætres de tous les types d'outils et de techniques.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-600 rounded-md p-3">
                                <i class="fas fa-music text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ISFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Aventurier</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Artistes flexibles et charmants, toujours pr√™ts √† explorer de nouvelles possibilit√©s cr√©atives.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ISFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-600 rounded-md p-3">
                                <i class="fas fa-rocket text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESTP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Entrepreneur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Intelligents, √©nergiques et tr√®s perceptifs, vraiment appr√©ci√©s pour leur spontan√©it√© et leur humour.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESTP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-pink-600 rounded-md p-3">
                                <i class="fas fa-theater-masks text-white text-xl"></i>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <h3 class="text-lg font-medium text-gray-900">ESFP</h3>
                                <p class="mt-1 text-sm text-gray-500">L'Amuseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Spontan√©s, √©nergiques et enthousiastes, la vie n'est jamais ennuyeuse autour d'eux.
                            </p>
                        </div>
                        <div class="mt-5">
                            <button onclick="showMBTIDetails('ESFP')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Enneagram Types Section -->
    <div id="enneagram" data-aos="fade-left" class="section-fonce py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Les 9 types de l'Enn√©agramme
                </h2>
                <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">
                    D√©couvrez les motivations profondes qui influencent votre personnalit√©
                </p>
            </div>
            
            <div class="mt-12 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                <!-- Type 1 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">1</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Perfectionniste</h3>
                                <p class="text-sm text-gray-500">Le R√©formateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de vivre correctement, d'am√©liorer le monde et d'√©viter la col√®re. Ils sont id√©alistes, responsables et ont un fort sens moral.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre corrompu, d√©fectueux ou mauvais<br>
                                <strong>D√©sir fondamental :</strong> √ätre bon, vertueux et parfait
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('1')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 2 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-green-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">2</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Altruiste</h3>
                                <p class="text-sm text-gray-500">L'Aidant</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin d'√™tre aim√©s et appr√©ci√©s, et d'exprimer leurs sentiments positifs envers les autres. Ils sont empathiques, sinc√®res et chaleureux.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre indigne d'amour<br>
                                <strong>D√©sir fondamental :</strong> Se sentir aim√© et appr√©ci√©
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('2')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 3 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-yellow-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">3</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le B√¢tisseur</h3>
                                <p class="text-sm text-gray-500">Le Performeur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin d'√™tre productifs, d'atteindre le succ√®s et d'√©viter l'√©chec. Ils sont adaptables, ambitieux et orient√©s vers les objectifs.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre sans valeur en dehors de leurs r√©alisations<br>
                                <strong>D√©sir fondamental :</strong> Se sentir valoris√© et digne d'amour
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('3')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 4 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">4</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Artiste</h3>
                                <p class="text-sm text-gray-500">L'Individualiste</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de s'exprimer et d'√™tre compris pour qui ils sont vraiment. Ils sont cr√©atifs, √©motionnellement honn√™tes et personnels.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> N'avoir ni identit√© ni importance personnelle<br>
                                <strong>D√©sir fondamental :</strong> Trouver leur vrai moi et leur importance
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('4')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 5 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">5</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Investigateur</h3>
                                <p class="text-sm text-gray-500">Le Penseur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de comprendre le monde qui les entoure. Ils sont intenses, c√©r√©braux, perceptifs et ind√©pendants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre inutile, incapable ou envahi<br>
                                <strong>D√©sir fondamental :</strong> √ätre comp√©tent et comprendre l'environnement
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('5')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 6 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">6</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Loyaliste</h3>
                                <p class="text-sm text-gray-500">Le Sceptique</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de s√©curit√© et de soutien. Ils sont engag√©s, responsables, anxieux et soup√ßonneux.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre sans soutien ou sans guidance<br>
                                <strong>D√©sir fondamental :</strong> Avoir s√©curit√© et soutien
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('6')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 7 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-orange-500 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">7</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">L'Enthousiaste</h3>
                                <p class="text-sm text-gray-500">L'√âpicurien</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de maintenir leur bonheur et leur enthousiasme. Ils sont spontan√©s, polyvalents, distractibles et dispers√©s.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre pi√©g√© dans la douleur ou la privation<br>
                                <strong>D√©sir fondamental :</strong> Maintenir leur bonheur et leur satisfaction
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('7')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 8 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-red-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">8</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le Challenger</h3>
                                <p class="text-sm text-gray-500">Le Protecteur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin d'√™tre autonomes et de contr√¥ler leur propre vie. Ils sont puissants, dominants, confiants et confrontants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> √ätre contr√¥l√© ou vuln√©rable aux autres<br>
                                <strong>D√©sir fondamental :</strong> √ätre autonome et contr√¥ler leur propre vie
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('8')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Type 9 -->
                <div class="type-card bg-white overflow-hidden shadow rounded-lg transition-all duration-300">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-teal-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <span class="text-white font-bold text-lg">9</span>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-medium text-gray-900">Le M√©diateur</h3>
                                <p class="text-sm text-gray-500">Le Pacificateur</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-600">
                                Motiv√©s par le besoin de maintenir leur paix int√©rieure et ext√©rieure. Ils sont r√©ceptifs, rassurants, agr√©ables et complaisants.
                            </p>
                        </div>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">
                                <strong>Peur fondamentale :</strong> Perte de connexion et fragmentation<br>
                                <strong>D√©sir fondamental :</strong> Maintenir leur paix int√©rieure et ext√©rieure
                            </div>
                        </div>
                        <div class="mt-5">
                            <button onclick="showEnneagramDetails('9')" class="text-sm font-medium text-blue-600 hover:text-blue-500">
                                En savoir plus <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- FAQ Section -->
    <div id="faq" data-aos="fade-up" class="section-clair py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Questions fr√©quentes
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Trouvez des r√©ponses aux questions les plus courantes
                </p>
            </div>
            
             <div class="mt-12 space-y-6">
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Comment fonctionne le syst√®me de pond√©ration ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Avec l‚Äôexp√©rience et l‚Äôanalyse des donn√©es recueillies, nous avons constat√© que l‚Äôauto-√©valuation introduisait souvent un biais dans le r√©sultat final, alors que les avis des proches √©taient, dans la majorit√© des cas, coh√©rents entre eux. Pour garantir une vision plus objective, le calcul repose d√©sormais uniquement sur leurs √©valuations : Famille 30 %, Partenaire 25 %, Ami 25 %, Coll√®gue 15 %.                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Quelle intelligence artificielle se cache derri√®re Psycho'Bot ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Psycho'Bot fonctionne gr√¢ce au mod√®le gpt-4o-mini d‚ÄôOpenAI, une intelligence artificielle rapide et √©conomique, capable de fournir des r√©ponses pr√©cises et naturelles en temps r√©el.                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Mes r√©ponses et celles de mes proches sont-elles anonymes ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Oui. Aucune identit√© n‚Äôest enregistr√©e avec les r√©ponses, et seules les donn√©es n√©cessaires au calcul du profil sont conserv√©es.                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Mon code d‚Äôacc√®s est-il valable √† vie ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Oui. Votre code d‚Äôacc√®s reste valable ind√©finiment, ce qui vous permet de consulter vos r√©sultats √† tout moment, sans limite de dur√©e.                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Puis-je voir les r√©ponses d√©taill√©es de chaque proche ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Non. Par souci de confidentialit√©, vous ne pouvez pas consulter le d√©tail des r√©ponses individuelles de vos proches. En revanche, dans votre page de r√©sultats, vous pouvez voir le profil MBTI et Enn√©agramme attribu√© √† chaque proche sur la base de ses r√©ponses.                            </p>
                        </div>
                    </button>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <button class="faq-button w-full px-6 py-4 text-left focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">Puis-je obtenir une interpr√©tation personnalis√©e de mes r√©sultats ?</h3>
                            <i class="fas fa-chevron-down text-blue-500 transform transition-transform duration-300"></i>
                        </div>
                        <div class="faq-content mt-2 hidden">
                            <p class="text-gray-600">
Oui. Vous pouvez interroger Psycho‚ÄôBot dans la section "Parler avec Psycho‚ÄôBot" pour obtenir une interpr√©tation personnalis√©e de votre profil MBTI et Enn√©agramme. N‚Äôh√©sitez pas √† lui communiquer votre profil et √† lui poser toutes les questions que vous souhaitez.                            </p>
                        </div>
                    </button>
                </div>
            </div>
            
            <div class="mt-8 text-center">
                <p class="text-gray-600">
                    Vous avez d'autres questions ? <a href="#" class="text-blue-600 hover:text-blue-500 font-medium">Contactez-nous</a>
                </p>
            </div>
        </div>
    </div>

    <!-- About Section -->
    <div class="section-fonce py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto text-center">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                √Ä propos du projet
            </h2>
            <p class="mt-6 text-lg text-gray-600">
                "Personnalit√© Compar√©e" est n√© de la volont√© de cr√©er un outil plus objectif pour comprendre sa personnalit√©. Contrairement aux tests traditionnels qui reposent uniquement sur l'auto-√©valuation, notre approche combine votre perception avec celle de votre entourage pour un r√©sultat plus nuanc√© et fid√®le.
            </p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-eye text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Vision objective</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Combiner plusieurs perspectives pour une analyse plus compl√®te
                    </p>
                </div>
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-shield-alt text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Confidentialit√©</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Vos donn√©es sont prot√©g√©es et ne sont jamais partag√©es
                    </p>
                </div>
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-md bg-blue-100 text-blue-600">
                        <i class="fas fa-graduation-cap text-xl"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-gray-900">Base scientifique</h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Fond√© sur les recherches en psychologie de la personnalit√©
                    </p>
                </div>
            </div>
            <div class="mt-8">
                <button onclick="showAboutProject()" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    En savoir plus sur le concept <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Personnalit√© Compar√©e</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Accueil</a></li>
                        <li><a href="#mbti" class="text-base text-gray-300 hover:text-white transition-colors">MBTI</a></li>
                        <li><a href="#enneagram" class="text-base text-gray-300 hover:text-white transition-colors">Enn√©agramme</a></li>
                        <li><a href="#faq" class="text-base text-gray-300 hover:text-white transition-colors">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Tests</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#auto-evaluation" class="text-base text-gray-300 hover:text-white transition-colors">Auto-√©valuation</a></li>
                        <li><a href="#evaluation-proche" class="text-base text-gray-300 hover:text-white transition-colors">√âvaluer un proche</a></li>
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Mon profil</a></li>
                        <li><a href="#" class="text-base text-gray-300 hover:text-white transition-colors">Mes r√©sultats</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">L√©gal</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" onclick="showPrivacyPolicy(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Confidentialit√©</a></li>
                        <li><a href="#" onclick="showTermsOfService(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Conditions d'utilisation</a></li>
                        <li><a href="#" onclick="showLegalNotices(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Mentions l√©gales</a></li>
                        <li><a href="#" onclick="showLegalNotices(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Cookies</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">Contact</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#" onclick="showContact(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Nous contacter</a></li>
                        <li><a href="#" onclick="showContact(); return false;" class="text-base text-gray-300 hover:text-white transition-colors">Support</a></li>
                        <li class="flex space-x-6 pt-2">
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">Facebook</span>
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">Instagram</span>
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="text-gray-400 hover:text-white transition-colors">
                                <span class="sr-only">TikTok</span>
                                <i class="fab fa-tiktok"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-8 md:flex md:items-center md:justify-between">
                <div class="flex space-x-6 md:order-2">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">Facebook</span>
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">Instagram</span>
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <span class="sr-only">TikTok</span>
                        <i class="fab fa-tiktok"></i>
                    </a>
                </div>
                <p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">
                    &copy; 2025 Personnalit√© Compar√©e. Tous droits r√©serv√©s.
                </p>
            </div>
        </div>
    </footer>

   
      
    <script>
        // Configuration et donn√©es
        const QUESTIONS_AUTO_EVALUATION = [
            
            {
                id: 1,
                question: "Dans une soir√©e, vous √™tes plut√¥t :",
                options: [
                    { text: "Au centre de l'attention, √† animer la conversation", mbti: { E: 3 }, enneagram: { 3: 2, 7: 1, 8: 1 } },
                    { text: "√Ä discuter en petit groupe avec des personnes que vous connaissez", mbti: { E: 1 }, enneagram: { 2: 2, 9: 1 } },
                    { text: "√Ä observer les autres et √† ne parler qu'avec une ou deux personnes", mbti: { I: 2 }, enneagram: { 4: 1, 5: 2, 6: 1 } },
                    { text: "√Ä chercher un moyen de partir discr√®tement", mbti: { I: 3 }, enneagram: { 5: 2, 9: 1 } }
                ]
            },
            {
                id: 2,
                question: "Quand vous devez prendre une d√©cision importante, vous :",
                options: [
                    { text: "Analysez tous les faits et donn√©es disponibles", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "√âcoutez votre intuition et vos sentiments", mbti: { F: 3, P: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Demandez conseil √† plusieurs personnes de confiance", mbti: { F: 2 }, enneagram: { 2: 1, 6: 2, 9: 1 } },
                    { text: "Pesez rapidement le pour et le contre puis agissez", mbti: { T: 2, J: 2 }, enneagram: { 3: 2, 8: 2 } }
                ]
            },
            {
                id: 3,
                question: "Votre espace de travail id√©al est :",
                options: [
                    { text: "Parfaitement organis√© avec chaque chose √† sa place", mbti: { J: 3, S: 1 }, enneagram: { 1: 3 } },
                    { text: "Cr√©atif et inspirant, m√™me si un peu d√©sordonn√©", mbti: { P: 2, N: 2 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Fonctionnel et pratique avant tout", mbti: { S: 2, T: 1 }, enneagram: { 3: 1, 5: 1, 8: 1 } },
                    { text: "Chaleureux et accueillant pour recevoir des coll√®gues", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } }
                ]
            },
            {
                id: 4,
                question: "Face √† un conflit, votre premi√®re r√©action est de :",
                options: [
                    { text: "Confronter directement le probl√®me", mbti: { T: 2, E: 1 }, enneagram: { 8: 3, 1: 1 } },
                    { text: "Chercher un compromis qui satisfait tout le monde", mbti: { F: 2 }, enneagram: { 2: 1, 9: 3 } },
                    { text: "Prendre du recul pour analyser la situation", mbti: { I: 2, T: 1 }, enneagram: { 5: 3, 6: 1 } },
                    { text: "√âviter le conflit si possible", mbti: { F: 1, I: 1 }, enneagram: { 4: 1, 9: 2 } }
                ]
            },
            {
                id: 5,
                question: "Vous vous sentez le plus √©nergis√© quand vous :",
                options: [
                    { text: "Interagissez avec beaucoup de personnes diff√©rentes", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Travaillez seul sur un projet qui vous passionne", mbti: { I: 3 }, enneagram: { 4: 2, 5: 2 } },
                    { text: "Aidez quelqu'un √† r√©soudre ses probl√®mes", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } },
                    { text: "Relevez un d√©fi stimulant", mbti: { N: 1, T: 1 }, enneagram: { 3: 2, 8: 2 } }
                ]
            },
            {
                id: 6,
                question: "Votre approche de la planification est :",
                options: [
                    { text: "Planifier chaque d√©tail √† l'avance", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Avoir une id√©e g√©n√©rale et improviser", mbti: { P: 3, N: 1 }, enneagram: { 7: 2, 9: 1 } },
                    { text: "Planifier les grandes √©tapes seulement", mbti: { N: 2, J: 1 }, enneagram: { 3: 2, 5: 1 } },
                    { text: "Pr√©f√©rer la spontan√©it√© totale", mbti: { P: 3 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 7,
                question: "Quand vous apprenez quelque chose de nouveau, vous pr√©f√©rez :",
                options: [
                    { text: "Comprendre d'abord la th√©orie puis pratiquer", mbti: { N: 2, T: 1 }, enneagram: { 5: 3 } },
                    { text: "Apprendre en faisant, par l'exp√©rience", mbti: { S: 3, P: 1 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "Avoir quelqu'un qui vous guide √©tape par √©tape", mbti: { S: 2, F: 1 }, enneagram: { 2: 1, 6: 2 } },
                    { text: "Explorer librement et d√©couvrir par vous-m√™me", mbti: { N: 2, P: 2 }, enneagram: { 4: 2, 7: 1 } }
                ]
            },
            {
                id: 8,
                question: "Votre plus grande motivation au travail est :",
                options: [
                    { text: "Atteindre l'excellence et la perfection", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "Aider les autres et faire une diff√©rence", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "R√©ussir et √™tre reconnu pour vos accomplissements", mbti: { E: 1, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Exprimer votre cr√©ativit√© et votre authenticit√©", mbti: { N: 2, F: 1 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 9,
                question: "Face √† l'incertitude, vous :",
                options: [
                    { text: "Cherchez √† obtenir plus d'informations", mbti: { T: 2, J: 1 }, enneagram: { 5: 2, 6: 2 } },
                    { text: "Faites confiance √† votre instinct", mbti: { N: 2, F: 1 }, enneagram: { 4: 1, 7: 1, 8: 1 } },
                    { text: "Vous sentez anxieux et cherchez du soutien", mbti: { F: 2 }, enneagram: { 6: 3 } },
                    { text: "Voyez cela comme une aventure excitante", mbti: { P: 2, N: 1 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 10,
                question: "Votre style de communication est :",
                options: [
                    { text: "Direct et factuel", mbti: { T: 3, S: 1 }, enneagram: { 1: 1, 8: 2 } },
                    { text: "Chaleureux et personnel", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Imaginatif et m√©taphorique", mbti: { N: 3 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Diplomate et nuanc√©", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 11,
                question: "Votre plus grande peur est :",
                options: [
                    { text: "De faire des erreurs ou d'√™tre imparfait", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "De ne pas √™tre aim√© ou appr√©ci√©", mbti: { F: 2, E: 1 }, enneagram: { 2: 3 } },
                    { text: "D'√©chouer ou d'√™tre sans valeur", mbti: { T: 1, E: 1 }, enneagram: { 3: 3 } },
                    { text: "De perdre votre identit√© unique", mbti: { N: 2, F: 1 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 12,
                question: "Dans un groupe, vous √™tes naturellement :",
                options: [
                    { text: "Le leader qui organise et dirige", mbti: { E: 2, J: 2 }, enneagram: { 3: 2, 8: 2 } },
                    { text: "Celui qui veille au bien-√™tre de chacun", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "L'observateur qui analyse la dynamique", mbti: { I: 2, T: 1 }, enneagram: { 5: 3 } },
                    { text: "Le m√©diateur qui maintient l'harmonie", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 13,
                question: "Votre rapport au temps est :",
                options: [
                    { text: "Tr√®s structur√©, vous respectez toujours les horaires", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Flexible, vous vous adaptez aux circonstances", mbti: { P: 3 }, enneagram: { 7: 2, 9: 1 } },
                    { text: "Orient√© vers les objectifs et les √©ch√©ances", mbti: { J: 2, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Vous perdez facilement la notion du temps", mbti: { P: 2, N: 1 }, enneagram: { 4: 1, 7: 1 } }
                ]
            },
            {
                id: 14,
                question: "Votre environnement id√©al pour r√©fl√©chir est :",
                options: [
                    { text: "Un endroit calme et silencieux", mbti: { I: 3 }, enneagram: { 5: 2, 9: 1 } },
                    { text: "Entour√© de personnes stimulantes", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Dans la nature ou un cadre inspirant", mbti: { N: 2, F: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Un espace organis√© avec vos outils", mbti: { S: 2, J: 1 }, enneagram: { 1: 2, 5: 1 } }
                ]
            },
            {
                id: 15,
                question: "Face au changement, vous :",
                options: [
                    { text: "R√©sistez et pr√©f√©rez la stabilit√©", mbti: { S: 2, J: 2 }, enneagram: { 1: 1, 6: 2 } },
                    { text: "L'embrassez avec enthousiasme", mbti: { N: 2, P: 2 }, enneagram: { 7: 3 } },
                    { text: "L'analysez soigneusement avant d'accepter", mbti: { T: 2, I: 1 }, enneagram: { 5: 2, 6: 1 } },
                    { text: "Vous adaptez naturellement", mbti: { P: 2, F: 1 }, enneagram: { 3: 1, 9: 2 } }
                ]
            },
            {
                id: 16,
                question: "Votre d√©finition du succ√®s est :",
                options: [
                    { text: "Faire les choses correctement et sans erreur", mbti: { J: 2, T: 1 }, enneagram: { 1: 3 } },
                    { text: "√ätre utile et appr√©ci√© par les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Atteindre vos objectifs et √™tre reconnu", mbti: { E: 1, T: 1 }, enneagram: { 3: 3 } },
                    { text: "Rester fid√®le √† vous-m√™me et vos valeurs", mbti: { F: 2, I: 1 }, enneagram: { 4: 2, 9: 1 } }
                ]
            }
        ];
        // R√©cup√®re les questions externes depuis Supabase si l'utilisateur est un proche
let questions = QUESTIONS_AUTO_EVALUATION;
// üîê G√©n√©re un code al√©atoire
function genererUniqueCode() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code = "";
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

// üîÑ Envoie vers Supabase
async function enregistrerQuestionsPourProches(questionsAutoEvaluation, userCode) {
  // Mettre √† jour l'enregistrement existant avec les questions pour les proches
  const { data, error } = await supabase
    .from("users")
    .update({
      external_questions: questionsAutoEvaluation
    })
    .eq('code', userCode);

  if (error) {
    console.error("‚ùå Erreur lors de l'enregistrement Supabase :", error);
  } else {
    console.log("‚úÖ Questions pour proches enregistr√©es avec succ√®s :", data);
    alert("Voici ton code √† donner √† 3 proches : " + userCode);
  }
}


if (window.location.href.includes("external")) {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get("code");
  console.log("Code re√ßu dans l'URL :", code);

  if (code) {
    // Appelle Supabase pour r√©cup√©rer les questions li√©es √† ce code
    supabase
      .from("users")
      .select("external_questions")
      .eq("code", code)
      .then(({ data, error }) => {
        if (!error && data && data.length > 0 && data[0].external_questions) {
          questions = data[0].external_questions;
          console.log("Questions externes charg√©es :", questions);
          afficherQuestions(); // appel explicite
        } else {
          console.error("Aucune question externe trouv√©e ou erreur :", error);
        }
      });
  }
}


        // √âtat de l'application
        let currentQuestionIndex = 0;
        let answers = {};
        let testType = 'auto'; // 'auto' ou 'proche'
        let userCode = generateUniqueCode();



        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupMobileMenu();
            setupFAQ();
            setupSmoothScrolling();
            setupProgressBars();
            setupEvaluationForm();
            loadFirstQuestion();
            initCountUp();
        }

        // Menu mobile
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');

            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    const isOpen = mobileMenu.classList.contains('active');
                    
                    if (isOpen) {
                        mobileMenu.classList.remove('active');
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    } else {
                        mobileMenu.classList.add('active');
                        menuIcon.classList.remove('fa-bars');
                        menuIcon.classList.add('fa-times');
                        mobileMenuButton.setAttribute('aria-expanded', 'true');
                    }
                });

                // Fermer le menu quand on clique sur un lien
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.remove('active');
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    });
                });
            }
        }

        // FAQ Accordion
        function setupFAQ() {
            const faqButtons = document.querySelectorAll('.faq-button');
            faqButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const content = this.querySelector('.faq-content');
                    const icon = this.querySelector('i');
                    const isOpen = !content.classList.contains('hidden');
                    
                    // Fermer toutes les autres FAQ
                    faqButtons.forEach(otherButton => {
                        if (otherButton !== this) {
                            const otherContent = otherButton.querySelector('.faq-content');
                            const otherIcon = otherButton.querySelector('i');
                            otherContent.classList.add('hidden');
                            otherIcon.classList.remove('rotate-180');
                        }
                    });
                    
                    // Toggle la FAQ actuelle
                    if (isOpen) {
                        content.classList.add('hidden');
                        icon.classList.remove('rotate-180');
                    } else {
                        content.classList.remove('hidden');
                        icon.classList.add('rotate-180');
                    }
                });
            });
        }

        // Smooth scrolling
        function setupSmoothScrolling() {
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80; // Account for fixed nav
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Animation des barres de progression
        function setupProgressBars() {
            const progressBars = document.querySelectorAll('.progress-bar');
            
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const bar = entry.target;
                        const targetWidth = bar.style.width;
                        bar.style.width = '0';
                        setTimeout(() => {
                            bar.style.width = targetWidth;
                        }, 100);
                    }
                });
            }, observerOptions);
            
            progressBars.forEach(bar => {
                observer.observe(bar);
            });
        }

        // Configuration du formulaire d'√©valuation
        function setupEvaluationForm() {
            const evaluationForm = document.getElementById('evaluation-form');
            if (evaluationForm) {
                evaluationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const code = formData.get('code');
                    const relation = formData.get('relation');
                    
                    if (code && relation) {
                        userCode = code;
                        testType = 'proche';
                        startEvaluationTest(relation);
                    } else {
                        alert('Veuillez remplir tous les champs requis.');
                    }
                });
            }
        }

        // Chargement de la premi√®re question
        function loadFirstQuestion() {
            const questionsContainer = document.getElementById('questions-container');
            if (questionsContainer) {
                displayQuestion(0);
                setupQuestionNavigation();
            }
        }

        // Affichage d'une question
        function displayQuestion(index) {
            const questionsContainer = document.getElementById('questions-container');
            const question = QUESTIONS_AUTO_EVALUATION[index];
            
            if (!question || !questionsContainer) return;
            
            const progress = ((index + 1) / QUESTIONS_AUTO_EVALUATION.length) * 100;
            
            const questionHTML = `
                <div class="question-container active fade-in bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="px-6 py-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-sm font-medium text-blue-600">Question ${index + 1}/${QUESTIONS_AUTO_EVALUATION.length}</span>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 ml-4">
                                <div class="progress-bar bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <h3 class="text-xl font-medium text-gray-900 mb-6">${question.question}</h3>
                        
                        <div class="space-y-4">
                            ${question.options.map((option, optionIndex) => `
                                <div class="flex items-start">
                                    <input id="q${question.id}-${optionIndex}" name="question${question.id}" type="radio" value="${optionIndex}" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 mt-1" ${answers[question.id] === optionIndex ? 'checked' : ''}>
                                    <label for="q${question.id}-${optionIndex}" class="ml-3 block text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900 transition-colors">
                                        ${option.text}
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            questionsContainer.innerHTML = questionHTML;
            
            // √âcouter les changements de r√©ponse
            const radioButtons = questionsContainer.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    answers[question.id] = parseInt(this.value);
                    saveProgress();
                    updateNavigationButtons();
                });
            });
            
            updateNavigationButtons();
        }

        // Configuration de la navigation entre questions
        function setupQuestionNavigation() {
            const prevButton = document.getElementById('prev-question');
            const nextButton = document.getElementById('next-question');
            const finishButton = document.getElementById('finish-test');
            
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    if (currentQuestionIndex > 0) {
                        currentQuestionIndex--;
                        displayQuestion(currentQuestionIndex);
                    }
                });
            }
            
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    if (answers[QUESTIONS_AUTO_EVALUATION[currentQuestionIndex].id] !== undefined) {
                        if (currentQuestionIndex < QUESTIONS_AUTO_EVALUATION.length - 1) {
                            currentQuestionIndex++;
                            displayQuestion(currentQuestionIndex);
                        }
                    } else {
                        alert('Veuillez s√©lectionner une r√©ponse avant de continuer.');
                    }
                });
            }
            
            if (finishButton) {
                finishButton.addEventListener('click', function() {
                    if (Object.keys(answers).length === QUESTIONS_AUTO_EVALUATION.length) {
                        calculateResults();
                    } else {
                        alert('Veuillez r√©pondre √† toutes les questions avant de terminer.');
                    }
                });
            }
        }

        // Mise √† jour des boutons de navigation
        function updateNavigationButtons() {
            const prevButton = document.getElementById('prev-question');
            const nextButton = document.getElementById('next-question');
            const finishButton = document.getElementById('finish-test');
            
            if (prevButton) {
                prevButton.style.display = currentQuestionIndex > 0 ? 'inline-flex' : 'none';
            }
            
            const isLastQuestion = currentQuestionIndex === QUESTIONS_AUTO_EVALUATION.length - 1;
            const hasAnswer = answers[QUESTIONS_AUTO_EVALUATION[currentQuestionIndex].id] !== undefined;
            
            if (nextButton && finishButton) {
                if (isLastQuestion) {
                    nextButton.style.display = 'none';
                    finishButton.style.display = hasAnswer ? 'inline-flex' : 'none';
                } else {
                    nextButton.style.display = 'inline-flex';
                    finishButton.style.display = 'none';
                }
            }
        }

        // Sauvegarde de la progression
        function saveProgress() {
            const progressData = {
                currentQuestionIndex,
                answers,
                testType,
                userCode,
                timestamp: Date.now()
            };
            localStorage.setItem('personalityTestProgress', JSON.stringify(progressData));

        }

        // Chargement de la progression sauvegard√©e
        function loadProgress() {
            const saved = localStorage.getItem('personalityTestProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    // V√©rifier si la sauvegarde n'est pas trop ancienne (24h)
                    if (Date.now() - data.timestamp < 24 * 60 * 60 * 1000) {
                        currentQuestionIndex = data.currentQuestionIndex || 0;
                        answers = data.answers || {};
                        testType = data.testType || 'auto';
                        userCode = data.userCode || '';
                        return true;
                    }
                } catch (e) {
                    console.error('Erreur lors du chargement de la progression:', e);
                }
            }
            return false;
        }

        // === Configuration Supabase ===
      
        // üîê G√©n√©re un code al√©atoire

function generateUniqueCode(length = 6) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code = '';
  for (let i = 0; i < length; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}


        const SUPABASE_URL = 'https://swjnpvfkloubshksobau.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3am5wdmZrbG91YnNoa3NvYmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwOTUxMzEsImV4cCI6MjA2OTY3MTEzMX0.A6rnIJyfIIxDT0c2XW_zGeUXpdYCgBFd6MTzBGFZ-Cg';

// Le client Supabase sera initialis√© apr√®s le chargement du script


        /**
         * Enregistre le profil utilisateur (auto‚Äë√©valuation) dans Supabase.
         * Cette fonction ins√®re un enregistrement dans la table "users".
         * @param {Object} userProfile Contient le code unique, les types MBTI/Enn√©agramme,
         * les scores d√©taill√©s et le niveau de certitude.
         */
         async function saveUserProfileToSupabase(userProfile) {
  try {
    const { data, error } = await supabase
      .from('users')
      .insert({
        code: userProfile.code,
        mbti_scores: userProfile.mbtiScores,
        enneagram_scores: userProfile.enneagramScores,
        mbti_type: userProfile.mbtiType,
        enneagram_type: userProfile.enneagramType,
        certainty_score: 0
      })
      .select()
      .single();

    if (error) {
      console.error('Erreur lors de l\'enregistrement du profil utilisateur :', error);
    } else {
      console.log('Profil enregistr√© dans Supabase', data);

      if (testType === "auto") {
        enregistrerQuestionsPourProches(answers, userProfile.code);
      }
    }
  } catch (err) {
    console.error('Exception lors de l\'enregistrement du profil utilisateur :', err);
  }
}



        /**
         * Enregistre une √©valuation externe dans Supabase.
         * Cette fonction r√©cup√®re l'utilisateur par son code unique, puis ins√®re une √©valuation li√©e.
         * @param {String} code Code unique de l'utilisateur √©valu√©.
         * @param {String} relation Relation entre l'√©valuateur et l'utilisateur ("family", "partner", "friend", "colleague").
         * @param {Object} mbtiScores Scores MBTI calcul√©s √† partir des r√©ponses de l'√©valuation externe.
         * @param {Object} enneagramScores Scores Enn√©agramme calcul√©s √† partir des r√©ponses.
         */
        async function saveExternalEvaluationToSupabase(code, relation, mbtiScores, enneagramScores) {
            try {
                // R√©cup√©rer l'utilisateur par code
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('id')
                    .eq('code', code)
                    .single();
                if (userError || !user) {
                    console.error('Utilisateur introuvable pour ce code :', code, userError);
                    return;
                }
                const userId = user.id;
                // Ins√©rer l'√©valuation
                const { error: insertError } = await supabase
                    .from('external_evaluations')
                    .insert({
                        user_id: userId,
                        relation: relation,
                        mbti_scores: mbtiScores,
                        enneagram_scores: enneagramScores
                    });
                if (insertError) {
                    console.error('Erreur lors de l‚Äôenregistrement de l‚Äô√©valuation externe :', insertError);
                } else {
                    console.log('√âvaluation externe enregistr√©e dans Supabase');
                    await calculateFinalProfile(code);
                }
            } catch (err) {
                console.error('Exception lors de l‚Äôenregistrement de l‚Äô√©valuation externe :', err);
            }
        }

        /**
         * Calcule et enregistre le r√©sultat final si au moins trois √©valuations externes sont disponibles.
         * @param {String} userId Identifiant de l'utilisateur.
         */
        function getProfileFromScores(mbtiScores, enneagramScores) {
            const mbtiType =
                (mbtiScores.E > mbtiScores.I ? 'E' : 'I') +
                (mbtiScores.S > mbtiScores.N ? 'S' : 'N') +
                (mbtiScores.T > mbtiScores.F ? 'T' : 'F') +
                (mbtiScores.J > mbtiScores.P ? 'J' : 'P');
            let topEnnea = '1';
            Object.keys(enneagramScores).forEach(type => {
                if (enneagramScores[type] > enneagramScores[topEnnea]) {
                    topEnnea = type;
                }
            });
            return { mbtiType, enneagramType: topEnnea };
        }

        function getCoh√©renceMBTI(scores) {
            if (!scores) return "Inconnue";

            const pairs = [
                ["I", "E"],
                ["S", "N"],
                ["T", "F"],
                ["J", "P"]
            ];

            const √©carts = pairs.map(([a, b]) => {
                if (scores[a] == null || scores[b] == null) return 0;
                return Math.abs(scores[a] - scores[b]);
            });

            const moyenne = √©carts.reduce((sum, val) => sum + val, 0) / √©carts.length;

            if (moyenne >= 30) return "Forte";
            if (moyenne >= 15) return "Moyenne";
            return "Faible";
        }

        function getCoh√©renceEnn√©agramme(scores) {
            if (!scores) return "Inconnue";

            const types = Object.keys(scores);
            if (types.length === 0) return "Inconnue";

            let dominantType = types[0];
            types.forEach(type => {
                if ((scores[type] || 0) > (scores[dominantType] || 0)) {
                    dominantType = type;
                }
            });

            const dominantScore = scores[dominantType] || 0;
            const autres = types.filter(t => t !== dominantType).map(t => scores[t] || 0);
            const moyenneAutres = autres.reduce((sum, v) => sum + v, 0) / (autres.length || 1);

            const √©cart = dominantScore - moyenneAutres;

            if (√©cart > 20) return "Forte";
            if (√©cart >= 10) return "Moyenne";
            return "Faible";
        }

       function computeWeightedResults(evaluations) {
    const baseWeights = {
        family: 30,
        partner: 25,
        friend: 25,
        colleague: 15
    };

    const combinedMbti = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
    const combinedEnneagram = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

    const availableRelations = {};
    let totalBaseWeight = 0;

    evaluations.forEach(ev => {
        if (baseWeights[ev.relation]) {
            if (!availableRelations[ev.relation]) {
                availableRelations[ev.relation] = [];
                totalBaseWeight += baseWeights[ev.relation];
            }
            availableRelations[ev.relation].push(ev);
        }
    });

    if (totalBaseWeight === 0) {
        return {
            mbtiType: null,
            enneagramType: null,
            mbtiCertainty: 0,
            enneagramCertainty: 0,
            overallCertainty: 0,
            combinedMbti,
            combinedEnneagram
        };
    }

    const normalizedWeights = {};
    Object.keys(availableRelations).forEach(relation => {
        normalizedWeights[relation] = (baseWeights[relation] / totalBaseWeight) * 100;
    });

    Object.keys(availableRelations).forEach(relation => {
        const weight = normalizedWeights[relation];
        const relEvaluations = availableRelations[relation];
        const avgMbti = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        const avgEnneagram = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };

        relEvaluations.forEach(ev => {
            Object.keys(ev.mbti_scores).forEach(trait => {
                avgMbti[trait] += ev.mbti_scores[trait];
            });
            Object.keys(ev.enneagram_scores).forEach(type => {
                avgEnneagram[type] += ev.enneagram_scores[type];
            });
        });

        Object.keys(avgMbti).forEach(trait => {
            avgMbti[trait] = avgMbti[trait] / relEvaluations.length;
            combinedMbti[trait] += avgMbti[trait] * (weight / 100);
        });
        Object.keys(avgEnneagram).forEach(type => {
            avgEnneagram[type] = avgEnneagram[type] / relEvaluations.length;
            combinedEnneagram[type] += avgEnneagram[type] * (weight / 100);
        });
    });

    const mbtiType =
        (combinedMbti.E > combinedMbti.I ? 'E' : 'I') +
        (combinedMbti.S > combinedMbti.N ? 'S' : 'N') +
        (combinedMbti.T > combinedMbti.F ? 'T' : 'F') +
        (combinedMbti.J > combinedMbti.P ? 'J' : 'P');

    let topEnnea = '1';
    Object.keys(combinedEnneagram).forEach(type => {
        if (combinedEnneagram[type] > combinedEnneagram[topEnnea]) {
            topEnnea = type;
        }
    });

    const mbtiTypes = [];
    const enneagramTypes = [];

    evaluations.forEach(ev => {
        const evMbtiType =
            (ev.mbti_scores.E > ev.mbti_scores.I ? 'E' : 'I') +
            (ev.mbti_scores.S > ev.mbti_scores.N ? 'S' : 'N') +
            (ev.mbti_scores.T > ev.mbti_scores.F ? 'T' : 'F') +
            (ev.mbti_scores.J > ev.mbti_scores.P ? 'J' : 'P');
        const evEnneaType = Object.keys(ev.enneagram_scores).reduce((a, b) =>
            ev.enneagram_scores[a] > ev.enneagram_scores[b] ? a : b
        );
        mbtiTypes.push(evMbtiType);
        enneagramTypes.push(evEnneaType);
    });

    const mbtiFreq = {};
    mbtiTypes.forEach(type => {
        mbtiFreq[type] = (mbtiFreq[type] || 0) + 1;
    });
    const mbtiMaxFreq = Math.max(...Object.values(mbtiFreq));
    const mbtiCertainty = Math.round((mbtiMaxFreq / mbtiTypes.length) * 100);

    const enneaFreq = {};
    enneagramTypes.forEach(type => {
        enneaFreq[type] = (enneaFreq[type] || 0) + 1;
    });
    const enneaMaxFreq = Math.max(...Object.values(enneaFreq));
    const enneagramCertainty = Math.round((enneaMaxFreq / enneagramTypes.length) * 100);

    const overallCertainty = Math.round((mbtiCertainty + enneagramCertainty) / 2);

    return {
        mbtiType,
        enneagramType: topEnnea,
        mbtiCertainty,
        enneagramCertainty,
        overallCertainty,
        combinedMbti,
        combinedEnneagram
    };
}

async function calculateFinalProfile(code) {
    try {
        const { data: user, error: userError } = await supabase
            .from('users')
            .select('id, code, mbti_scores, enneagram_scores, mbti_type, enneagram_type, certainty_score')
            .eq('code', code)
            .single();
        if (userError || !user) {
            console.error('Utilisateur introuvable pour ce code :', code, userError);
            return null;
        }
        const { data: evaluations, error: evalError } = await supabase
            .from('external_evaluations')
            .select('relation, mbti_scores, enneagram_scores, created_at')
            .eq('user_id', user.id);
        if (evalError) {
            console.error('Erreur lors de la r√©cup√©ration des √©valuations externes :', evalError);
            return null;
        }
        if (!evaluations || evaluations.length === 0) {
            return { user, evaluations: [] };
        }

        const weighted = computeWeightedResults(evaluations);
        const overallCertainty = weighted.overallCertainty;

        await supabase
            .from('users')
            .update({
                mbti_type: weighted.mbtiType,
                enneagram_type: weighted.enneagramType,
                certainty_score: overallCertainty,
                mbti_scores: weighted.combinedMbti,
                enneagram_scores: weighted.combinedEnneagram
            })
            .eq('code', code);

        return {
            user: {
                id: user.id,
                code,
                mbti_type: weighted.mbtiType,
                enneagram_type: weighted.enneagramType,
                mbti_scores: weighted.combinedMbti,
                enneagram_scores: weighted.combinedEnneagram,
                certainty_score: overallCertainty
            },
            evaluations,
            mbtiCertainty: weighted.mbtiCertainty,
            enneagramCertainty: weighted.enneagramCertainty,
            overallCertainty
        };
    } catch (err) {
        console.error('Erreur lors du calcul du profil final :', err);
        return null;
    }
}

async function fetchUserProfileFromSupabase(code) {
    try {
        const { data, error } = await supabase
            .from('users')
            .select('id, code, mbti_scores, enneagram_scores, mbti_type, enneagram_type, certainty_score')
            .eq('code', code);

        if (error) {
            console.error('Erreur lors de la r√©cup√©ration de l\'utilisateur :', error);
            return null;
        }

        if (!data || data.length === 0) {
            return null;
        }

        const user = data[0];

        const { data: evaluations, error: evalError } = await supabase
            .from('external_evaluations')
            .select('relation, mbti_scores, enneagram_scores, created_at')
            .eq('user_id', user.id);

        if (evalError) {
            console.error('Erreur lors de la r√©cup√©ration des √©valuations externes :', evalError);
        }

        return { user, evaluations: evaluations || [] };
    } catch (err) {
        console.error('Exception lors de la r√©cup√©ration du profil :', err);
        return null;
    }
}

async function calculateResults() {
    const mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
    const enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
    
    Object.keys(answers).forEach(questionId => {
        const questionIndex = parseInt(questionId) - 1;
        const answerIndex = answers[questionId];
        const question = QUESTIONS_AUTO_EVALUATION[questionIndex];
        const selectedOption = question.options[answerIndex];
        
        Object.keys(selectedOption.mbti).forEach(trait => {
            mbtiScores[trait] += selectedOption.mbti[trait];
        });
        
        Object.keys(selectedOption.enneagram).forEach(type => {
            enneagramScores[type] += selectedOption.enneagram[type];
        });
    });
    
    const mbtiType = 
        (mbtiScores.E > mbtiScores.I ? 'E' : 'I') +
        (mbtiScores.S > mbtiScores.N ? 'S' : 'N') +
        (mbtiScores.T > mbtiScores.F ? 'T' : 'F') +
        (mbtiScores.J > mbtiScores.P ? 'J' : 'P');
    
    const enneagramType = Object.keys(enneagramScores).reduce((a, b) => 
        enneagramScores[a] > enneagramScores[b] ? a : b
    );
    
    const mbtiPairs = [
        ['E', 'I'],
        ['S', 'N'],
        ['T', 'F'],
        ['J', 'P']
    ];
    let mbtiCertaintySum = 0;
    mbtiPairs.forEach(([a, b]) => {
        const pairTotal = mbtiScores[a] + mbtiScores[b];
        if (pairTotal > 0) {
            mbtiCertaintySum += Math.abs(mbtiScores[a] - mbtiScores[b]) / pairTotal;
        }
    });
    const mbtiCertainty = Math.min(95, Math.round((mbtiCertaintySum / mbtiPairs.length) * 100));

    const totalEnneagramScore = Object.values(enneagramScores).reduce((a, b) => a + b, 0);
    const enneagramCertainty = totalEnneagramScore
        ? Math.min(95, Math.round((enneagramScores[enneagramType] / totalEnneagramScore) * 100))
        : 0;

    const certaintyScore = Math.round((mbtiCertainty + enneagramCertainty) / 2);
    
    const uniqueCode = generateUniqueCode();
    
    const userProfile = {
        code: uniqueCode,
        mbtiType,
        enneagramType,
        mbtiCertainty,
        enneagramCertainty,
        certaintyScore,
        mbtiScores,
        enneagramScores,
        timestamp: Date.now()
    };

    await saveUserProfileToSupabase(userProfile);
    localStorage.setItem('userProfile_' + uniqueCode, JSON.stringify(userProfile));
    
    displayResults({
        code: uniqueCode,
        mbtiType,
        enneagramType,
        mbtiCertainty,
        enneagramCertainty,
        certaintyScore,
        mbtiScores,
        enneagramScores
    });
}

function displayResults(results) {
    const resultsHTML = generateResultsHTML(results);
    
    const resultsSection = document.createElement('div');
    resultsSection.className = 'bg-blue-50 py-16 px-4 sm:px-6 lg:px-8';
    resultsSection.innerHTML = resultsHTML;
    
    const autoEvalSection = document.getElementById('auto-evaluation');
    if (autoEvalSection) {
        autoEvalSection.parentNode.insertBefore(resultsSection, autoEvalSection.nextSibling);
        initCountUp(resultsSection);

        setTimeout(() => {
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }
    
    localStorage.setItem('personalityTestResults', JSON.stringify(results));
    localStorage.removeItem('personalityTestProgress');
}

        // G√©n√©ration du HTML des r√©sultats
        function generateResultsHTML(results) {
            const mbtiDescriptions = {
                'INTJ': 'L\'Architecte - Visionnaires strat√©giques avec un plan pour tout.',
                'INTP': 'Le Penseur - Penseurs logiques et cr√©atifs, toujours √† la recherche de nouvelles id√©es.',
                'ENTJ': 'Le Commandant - Leaders naturels, charismatiques et d√©termin√©s.',
                'ENTP': 'L\'Innovateur - Inventifs et curieux, excellents pour trouver des solutions originales.',
                'INFJ': 'L\'Avocat - Id√©alistes cr√©atifs et perspicaces, motiv√©s par leurs valeurs profondes.',
                'INFP': 'Le M√©diateur - Po√©tiques, gentils et altruistes, toujours d√©sireux d\'aider.',
                'ENFJ': 'Le Donateur - Charismatiques et empathiques, motiv√©s par le d√©sir d\'aider les autres.',
                'ENFP': 'L\'Inspirateur - Enthousiastes, cr√©atifs et sociables, toujours √† la recherche de nouvelles exp√©riences.',
                'ISTJ': 'Le Logisticien - Pratiques et factuels, fiables et responsables.',
                'ISFJ': 'Le Protecteur - Chaleureux et consciencieux, toujours pr√™ts √† prot√©ger leurs proches.',
                'ESTJ': 'L\'Ex√©cutif - Excellents administrateurs, incomparables pour g√©rer avec efficacit√©.',
                'ESFJ': 'Le Consul - Extraordinairement attentionn√©s, sociables et populaires.',
                'ISTP': 'Le Virtuose - M√©caniciens audacieux et pratiques, ma√Ætres de tous les types d\'outils.',
                'ISFP': 'L\'Aventurier - Artistes flexibles et charmants, toujours pr√™ts √† explorer.',
                'ESTP': 'L\'Entrepreneur - Intelligents, √©nergiques et tr√®s perceptifs.',
                'ESFP': 'L\'Amuseur - Spontan√©s, √©nergiques et enthousiastes.'
            };
            
            const enneagramDescriptions = {
                '1': 'Le Perfectionniste - Motiv√© par le besoin de vivre correctement et d\'am√©liorer le monde.',
                '2': 'L\'Altruiste - Motiv√© par le besoin d\'√™tre aim√© et d\'aider les autres.',
                '3': 'Le B√¢tisseur - Motiv√© par le besoin de r√©ussir et d\'√™tre reconnu.',
                '4': 'L\'Artiste - Motiv√© par le besoin d\'exprimer son authenticit√© unique.',
                '5': 'L\'Investigateur - Motiv√© par le besoin de comprendre le monde.',
                '6': 'Le Loyaliste - Motiv√© par le besoin de s√©curit√© et de soutien.',
                '7': 'L\'Enthousiaste - Motiv√© par le besoin de maintenir le bonheur et l\'enthousiasme.',
                '8': 'Le Challenger - Motiv√© par le besoin d\'√™tre autonome et de contr√¥ler sa vie.',
                '9': 'Le M√©diateur - Motiv√© par le besoin de maintenir la paix int√©rieure et ext√©rieure.'
            };
            
            return `
                <div class="max-w-4xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                            Vos r√©sultats
                        </h2>
                        <p class="mt-4 text-xl text-gray-600">
                            Voici votre profil de personnalit√© bas√© sur vos r√©ponses
                        </p>
                    </div>
                    
                    <div class="mt-12 bg-white shadow-xl rounded-lg overflow-hidden">
                        <div class="px-6 py-8">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900">Votre profil</h3>
                                    <p class="mt-1 text-gray-500">Analyse compl√©t√©e le ${new Date().toLocaleDateString('fr-FR')}</p>
                                </div>
                                <div class="mt-4 md:mt-0">
                                    <span class="personality-badge bg-green-100 text-green-800">${results.mbtiType}</span>
                                    <span class="personality-badge bg-blue-100 text-blue-800 ml-2">Type ${results.enneagramType}</span>
                                </div>
                            </div>
                            
                            <!-- Code unique pour partage -->
                            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-lg font-medium text-blue-900">Votre code unique</h4>
                                        <p class="text-sm text-blue-700 mt-1">Partagez ce code avec vos proches pour qu'ils puissent vous √©valuer</p>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <div class="bg-white border-2 border-blue-300 rounded-lg px-4 py-2">
                                            <span class="text-2xl font-bold text-blue-900 tracking-wider" id="unique-code">${results.code}</span>
                                        </div>
                                        <button onclick="copyCode('${results.code}')" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            <i class="fas fa-copy mr-1"></i> Copier
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                         <div class="pc-info-banner" role="note" aria-live="polite" style="text-align: center;">
  Voici les profils avec lesquels vous vous identifiez. Partagez votre code unique √† 3 proches, puis consultez vos r√©sultats d√©taill√©s dans la section 
  <strong>¬´ Mon profil ¬ª</strong> ou <strong>¬´ Retrouver un profil ¬ª</strong>.
</div>


                            <div class="mt-8 grid grid-cols-1 gap-8 md:grid-cols-2">
                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">Profil MBTI</h4>
                                    <div class="mt-4 bg-green-50 rounded-lg p-4">
                                        <p class="text-gray-700 font-medium">${results.mbtiType}</p>
                                        <p class="text-gray-600 text-sm mt-1">${mbtiDescriptions[results.mbtiType]}</p>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">Profil Enn√©agramme</h4>
                                    <div class="mt-4 bg-blue-50 rounded-lg p-4">
                                        <p class="text-gray-700 font-medium">Type ${results.enneagramType}</p>
                                        <p class="text-gray-600 text-sm mt-1">${enneagramDescriptions[results.enneagramType]}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8 flex flex-wrap justify-center gap-4">
                                <button onclick="shareResults()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <i class="fas fa-share mr-2"></i> Partager
                                </button>
                                <button onclick="downloadResults()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    <i class="fas fa-download mr-2"></i> T√©l√©charger
                                </button>
                                <button onclick="restartTest()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <i class="fas fa-redo mr-2"></i> Refaire le test
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonctions utilitaires
        function initCountUp(root = document) {
            const elements = root.querySelectorAll('.countup');
            if (!elements.length) return;
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const el = entry.target;
                        const endVal = parseFloat(el.dataset.value) || 0;
                        const suffix = el.dataset.suffix || '';
                        const counter = new CountUp(el, endVal, { duration: 1.5, suffix });
                        if (!counter.error) {
                            counter.start();
                        } else {
                            console.error(counter.error);
                        }
                        obs.unobserve(el);
                    }
                });
            }, { threshold: 0.5 });

            elements.forEach(el => {
                const suffix = el.dataset.suffix || '';
                el.textContent = '0' + suffix;
                observer.observe(el);
            });
        }

        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'Mon profil de personnalit√©',
                    text: 'D√©couvrez votre profil de personnalit√© avec Personnalit√© Compar√©e',
                    url: window.location.href
                });
            } else {
                // Fallback pour les navigateurs qui ne supportent pas l'API Web Share
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    alert('Lien copi√© dans le presse-papiers !');
                });
            }
        }

        function downloadResults() {
            const results = localStorage.getItem('personalityTestResults');
            if (results) {
                const blob = new Blob([results], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'profil-personnalite.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                // Changer temporairement le texte du bouton
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-1"></i> Copi√© !';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            }).catch(() => {
                alert('Code copi√© : ' + code);
            });
        }

        function restartTest() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer le test ? Vos r√©ponses actuelles seront perdues.')) {
                localStorage.removeItem('personalityTestProgress');
                localStorage.removeItem('personalityTestResults');
                currentQuestionIndex = 0;
                answers = {};
                
                // Supprimer la section des r√©sultats si elle existe
                const resultsSection = document.querySelector('.bg-blue-50');
                if (resultsSection && resultsSection.innerHTML.includes('Vos r√©sultats')) {
                    resultsSection.remove();
                }
                
                displayQuestion(0);
            }
        }

        function startEvaluationTest(relation) {
            alert(`√âvaluation pour un ${relation} - Fonctionnalit√© en cours de d√©veloppement`);
        }

        // Gestion des modales
        function showModal(title, content) {
            const modalContainer = document.getElementById('modal-container');
            const modalHTML = `
                <div class="modal show" id="current-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="text-xl font-bold text-gray-900">${title}</h2>
                            <span class="close" onclick="closeModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            modalContainer.innerHTML = modalHTML;
            
            // Fermer avec ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeModal();
            });
            
            // Fermer en cliquant √† l'ext√©rieur
            document.getElementById('current-modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        }

        function closeModal() {
            const modal = document.getElementById('current-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    document.getElementById('modal-container').innerHTML = '';
                }, 300);
            }
        }

        // Descriptions d√©taill√©es MBTI
        const mbtiDetailedDescriptions = {
            'INTJ': {
                title: 'INTJ - L\'Architecte',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INTJ sont des visionnaires strat√©giques avec un plan pour tout. Ils sont ind√©pendants, d√©termin√©s et ont une forte capacit√© √† voir les possibilit√©s futures.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Penseurs strat√©giques et visionnaires</li>
                            <li>Ind√©pendants et autonomes</li>
                            <li>Orient√©s vers les objectifs √† long terme</li>
                            <li>Excellents planificateurs</li>
                            <li>Pr√©f√®rent travailler seuls ou en petits groupes</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Auxiliaire :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Inf√©rieure :</strong> Sensation Extravertie (Se)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Architecte, ing√©nieur, scientifique, consultant en strat√©gie, d√©veloppeur de logiciels, chercheur.</p>
                    </div>
                `
            },
            'INTP': {
                title: 'INTP - Le Penseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INTP sont des penseurs logiques et cr√©atifs, toujours √† la recherche de nouvelles id√©es et possibilit√©s th√©oriques.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Analystes logiques et objectifs</li>
                            <li>Curieux et ouverts aux nouvelles id√©es</li>
                            <li>Ind√©pendants et flexibles</li>
                            <li>Excellents r√©solveurs de probl√®mes</li>
                            <li>Pr√©f√®rent la th√©orie √† la pratique</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Tertiaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Inf√©rieure :</strong> Sentiment Extraverti (Fe)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Chercheur, philosophe, math√©maticien, programmeur, analyste, professeur d'universit√©.</p>
                    </div>
                `
            }
            ,
            'ISTJ': {
                title: 'ISTJ - Le Logisticien',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISTJ sont s√©rieux et fiables. Ils respectent les r√®gles et traditions, travaillent m√©thodiquement et prennent leurs responsabilit√©s au s√©rieux. Leur approche est pragmatique et organis√©e.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Responsables, pratiques et factuels</li>
                            <li>Respectent les traditions et les structures √©tablies</li>
                            <li>Mettent l'accent sur la pr√©cision et la loyaut√©</li>
                            <li>Pr√©f√©rent la stabilit√© et la planification</li>
                            <li>Peuvent √™tre r√©serv√©s et rigides face au changement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Auxiliaire :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Inf√©rieure :</strong> Intuition Extravertie (Ne)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Comptable, auditeur, administrateur, officier militaire, juge, gestionnaire de projet.</p>
                    </div>
                `
            },
            'ISTP': {
                title: 'ISTP - Le Virtuose',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISTP sont pragmatiques et analytiques. Ils aiment comprendre comment fonctionnent les choses et s'attaquer √† des probl√®mes concrets. Flexibles et observateurs, ils pr√©f√®rent apprendre par l'exp√©rience.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Calmes et r√©alistes</li>
                            <li>Analytiques et logiques</li>
                            <li>Aiment d√©monter et r√©parer des objets</li>
                            <li>S'adaptent rapidement aux situations de crise</li>
                            <li>Peuvent para√Ætre distants √©motionnellement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Tertiaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Inf√©rieure :</strong> Sentiment Extraverti (Fe)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">M√©canicien, ing√©nieur, pilote, technicien, enqu√™teur.</p>
                    </div>
                `
            },
            'ISFJ': {
                title: 'ISFJ - Le Protecteur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISFJ sont chaleureux et consciencieux. Ils veillent √† pr√©server l'harmonie et la s√©curit√© de leur entourage. Ils respectent les traditions et sont attentifs aux besoins des autres.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Bienveillants, loyaux et responsables</li>
                            <li>Organis√©s et m√©thodiques</li>
                            <li>Souvent modestes et discrets</li>
                            <li>Se soucient des besoins des autres avant les leurs</li>
                            <li>Peuvent √™tre r√©ticents face au changement</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Tertiaire :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Inf√©rieure :</strong> Intuition Extravertie (Ne)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Infirmier, enseignant, biblioth√©caire, assistant social, gestionnaire administratif.</p>
                    </div>
                `
            },
            'ISFP': {
                title: 'ISFP - L\'Aventurier',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ISFP sont sensibles, discrets et artistiques. Ils appr√©cient l'harmonie, la beaut√© et la libert√© de s'exprimer. Ils vivent l‚Äôinstant pr√©sent et recherchent l'√©quilibre.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Cr√©atifs et artistiques</li>
                            <li>Empathiques et chaleureux</li>
                            <li>Discrets et r√©serv√©s</li>
                            <li>Appr√©cient la libert√© et l‚Äôind√©pendance</li>
                            <li>Peuvent √©viter les conflits et les planifications rigides</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Tertiaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Inf√©rieure :</strong> Pens√©e Extravertie (Te)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Artiste, designer, photographe, chef cuisinier, travailleur social.</p>
                    </div>
                `
            },
            'INFJ': {
                title: 'INFJ - L\'Avocat',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INFJ sont perspicaces et id√©alistes. Ils sont guid√©s par leurs valeurs et cherchent √† comprendre les motivations profondes des autres. Ils sont cr√©atifs et se consacrent √† aider autrui.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Visionnaires et orient√©s vers un sens profond</li>
                            <li>Empathiques et compatissants</li>
                            <li>Cr√©atifs et originaux</li>
                            <li>Organis√©s et d√©termin√©s</li>
                            <li>Peuvent se sentir incompris ou retir√©s</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Tertiaire :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Inf√©rieure :</strong> Sensation Extravertie (Se)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Conseiller, psychologue, √©crivain, enseignant, humanitaire.</p>
                    </div>
                `
            },
            'INFP': {
                title: 'INFP - Le M√©diateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les INFP sont id√©alistes et empathiques. Guid√©s par leurs valeurs, ils cherchent un sens profond √† la vie et s‚Äôefforcent de rendre le monde meilleur. Ils sont cr√©atifs et sensibles.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Id√©alistes et guid√©s par leurs valeurs</li>
                            <li>Empathiques et compatissants</li>
                            <li>Cr√©atifs et expressifs</li>
                            <li>Aiment l'authenticit√© et l'individualit√©</li>
                            <li>Peuvent √™tre r√©serv√©s et √©viter les conflits</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Tertiaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Inf√©rieure :</strong> Pens√©e Extravertie (Te)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">√âcrivain, psychologue, conseiller, artiste, musicien.</p>
                    </div>
                `
            },
            'ENTJ': {
                title: 'ENTJ - Le Commandant',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENTJ sont des leaders n√©s, charismatiques et logiques. Ils aiment structurer des organisations, planifier l'avenir et relever des d√©fis. Ils sont d√©termin√©s et ax√©s sur l‚Äôefficacit√©.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Leaders strat√©giques et assertifs</li>
                            <li>D√©cisifs et organis√©s</li>
                            <li>Adeptes de la planification et de l'ex√©cution</li>
                            <li>Orient√©s vers les objectifs et la r√©ussite</li>
                            <li>Peuvent para√Ætre autoritaires ou impatients</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Tertiaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Inf√©rieure :</strong> Sentiment Introverti (Fi)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Directeur g√©n√©ral, avocat, chef de projet, politicien, entrepreneur.</p>
                    </div>
                `
            },
            'ENTP': {
                title: 'ENTP - L\'Innovateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENTP sont cr√©atifs et curieux. Ils aiment explorer de nouvelles id√©es, d√©battre et remettre en question le statu quo. Flexibles, ils pr√©f√®rent les possibilit√©s ouvertes aux routines strictes.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Inventifs et plein d'esprit</li>
                            <li>Aiment d√©battre et argumenter</li>
                            <li>S'adaptent rapidement √† de nouveaux concepts</li>
                            <li>Aiment les d√©fis intellectuels</li>
                            <li>Peuvent s'ennuyer avec la routine et la gestion des d√©tails</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Auxiliaire :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Inf√©rieure :</strong> Sensation Introvertie (Si)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Avocat, consultant, entrepreneur, inventeur, journaliste.</p>
                    </div>
                `
            },
            'ENFJ': {
                title: 'ENFJ - Le Donateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENFJ sont charismatiques et attentifs aux autres. Ils comprennent intuitivement les besoins des gens et aiment motiver et inspirer. Ils recherchent l‚Äôharmonie et le d√©veloppement personnel et collectif.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Chaleureux, empathiques et organis√©s</li>
                            <li>Communicateurs naturels</li>
                            <li>Aident les autres √† r√©aliser leur potentiel</li>
                            <li>Orient√©s vers les valeurs et l'harmonie</li>
                            <li>Peuvent s'oublier au profit des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Auxiliaire :</strong> Intuition Introvertie (Ni)</p>
                            <p><strong>Tertiaire :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Inf√©rieure :</strong> Pens√©e Introvertie (Ti)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Professeur, coach, psychologue, coordinateur d‚Äô√©v√©nements, diplomate.</p>
                    </div>
                `
            },
            'ENFP': {
                title: 'ENFP - L\'Inspirateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ENFP sont enthousiastes et cr√©atifs. Ils s‚Äô√©panouissent dans l'exploration de nouvelles id√©es et inspirent les autres gr√¢ce √† leur vision optimiste. Ils cherchent l‚Äôauthenticit√© et la libert√©.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>√ânerg√©tiques et imaginatifs</li>
                            <li>Empathiques et communicatifs</li>
                            <li>S'√©panouissent dans les relations</li>
                            <li>Aiment l'innovation et la diversit√©</li>
                            <li>Peuvent se disperser et n√©gliger les d√©tails</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Tertiaire :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Inf√©rieure :</strong> Sensation Introvertie (Si)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Journaliste, conseiller, animateur, auteur, professionnel des relations publiques.</p>
                    </div>
                `
            },
            'ESTP': {
                title: 'ESTP - L\'Entrepreneur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESTP sont √©nergiques et orient√©s vers l'action. Ils aiment vivre l'instant pr√©sent et r√©soudre des situations concr√®tes. Adaptables et sociables, ils prennent des d√©cisions rapides.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Dynamiques et aventuriers</li>
                            <li>Pragmatiques et r√©alistes</li>
                            <li>Orient√©s vers les r√©sultats imm√©diats</li>
                            <li>Bons communicateurs et n√©gociateurs</li>
                            <li>Peuvent se montrer impatients et risquer l'impulsivit√©</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Auxiliaire :</strong> Pens√©e Introvertie (Ti)</p>
                            <p><strong>Tertiaire :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Inf√©rieure :</strong> Intuition Introvertie (Ni)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Entrepreneur, d√©tective, pilote, vendeur, pompier.</p>
                    </div>
                `
            },
            'ESTJ': {
                title: 'ESTJ - L\'Ex√©cutif',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESTJ sont organis√©s et directs. Ils se fient aux faits et aiment structurer les activit√©s pour obtenir des r√©sultats efficaces. Ils valorisent la tradition et l‚Äôordre.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Pragmatiques et responsables</li>
                            <li>Directs et orient√©s vers l'action</li>
                            <li>Logiques et objectifs</li>
                            <li>Aiment organiser et diriger</li>
                            <li>Peuvent √™tre inflexibles ou autoritaires</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Tertiaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Inf√©rieure :</strong> Sentiment Introverti (Fi)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Gestionnaire, officier militaire, policier, juge, chef de projet.</p>
                    </div>
                `
            },
            'ESFP': {
                title: 'ESFP - L\'Amuseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESFP sont spontan√©s et sociables. Ils aiment profiter de la vie et attirer l'attention. Pratiques et chaleureux, ils encouragent les autres √† vivre pleinement chaque moment.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Sociables et enthousiastes</li>
                            <li>Spontan√©s et √©nergiques</li>
                            <li>Aiment le divertissement et la vari√©t√©</li>
                            <li>Observateurs et pratiques</li>
                            <li>Peuvent √™tre sensibles aux critiques et √©viter la planification</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sensation Extravertie (Se)</p>
                            <p><strong>Auxiliaire :</strong> Sentiment Introverti (Fi)</p>
                            <p><strong>Tertiaire :</strong> Pens√©e Extravertie (Te)</p>
                            <p><strong>Inf√©rieure :</strong> Intuition Introvertie (Ni)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Acteur, animateur, h√¥te, vendeur, infirmier p√©diatrique.</p>
                    </div>
                `
            },
            'ESFJ': {
                title: 'ESFJ - Le Consul',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les ESFJ sont aimables et sociables. Ils prennent soin des autres et veillent √† maintenir l'harmonie. Organis√©s et consciencieux, ils travaillent pour soutenir leur communaut√©.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques principales :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Chaleureux et serviables</li>
                            <li>Organis√©s et responsables</li>
                            <li>Centr√©s sur la communaut√© et la tradition</li>
                            <li>Communicateurs empathiques</li>
                            <li>Peuvent √™tre sensibles √† la critique et rechercher l'approbation</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Fonctions cognitives :</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p><strong>Dominante :</strong> Sentiment Extraverti (Fe)</p>
                            <p><strong>Auxiliaire :</strong> Sensation Introvertie (Si)</p>
                            <p><strong>Tertiaire :</strong> Intuition Extravertie (Ne)</p>
                            <p><strong>Inf√©rieure :</strong> Pens√©e Introvertie (Ti)</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Carri√®res typiques :</h3>
                        <p class="text-gray-700">Infirmier, enseignant, gestionnaire d'√©v√©nements, conseiller, travailleur social.</p>
                    </div>
                `
            }
        };

        // Descriptions d√©taill√©es Enn√©agramme
        const enneagramDetailedDescriptions = {
            '1': {
                title: 'Type 1 - Le Perfectionniste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type 1 sont motiv√©s par le besoin de vivre correctement, d'am√©liorer le monde et d'√©viter la col√®re.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> √ätre corrompu, d√©fectueux ou mauvais</p>
                            <p><strong>D√©sir fondamental :</strong> √ätre bon, vertueux et parfait</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Id√©alistes et responsables</li>
                            <li>Fort sens moral et √©thique</li>
                            <li>Perfectionnistes et critiques</li>
                            <li>Organis√©s et m√©thodiques</li>
                            <li>Peuvent √™tre rigides et col√©riques</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Sages, discernants, r√©alistes et nobles. Peuvent √™tre moralement h√©ro√Øques.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Deviennent critiques, perfectionnistes et peuvent exploser de col√®re.</p>
                    </div>
                `
            },
            '2': {
                title: 'Type 2 - L\'Altruiste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†2 sont motiv√©s par le besoin d'√™tre aim√©s et n√©cessaires. Ils sont empathiques, chaleureux et g√©n√©reux, mais peuvent devenir possessifs et trop ax√©s sur la reconnaissance.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas √™tre aim√©s ou √™tre inutiles</p>
                            <p><strong>D√©sir fondamental :</strong> Se sentir appr√©ci√©s, aim√©s et n√©cessaires</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Empathiques et chaleureux</li>
                            <li>Serviables et g√©n√©reux</li>
                            <li>Adapt√©s aux besoins des autres</li>
                            <li>Peuvent √™tre d√©pendants de la reconnaissance</li>
                            <li>Parfois possessifs ou envahissants</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils sont altruistes, aimants et d√©sint√©ress√©s. Ils soutiennent les autres de mani√®re authentique sans attendre de retour.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir envahissants, ressentir de la jalousie et s'√©puiser en donnant trop.</p>
                    </div>
                `
            },
            '3': {
                title: 'Type 3 - Le B√¢tisseur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†3 sont motiv√©s par le besoin de r√©ussir et d'√™tre admir√©s. Ambitieux et √©nergiques, ils sont adaptables et conscients de leur image, mais peuvent devenir pr√©occup√©s par leur statut.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas avoir de valeur personnelle</p>
                            <p><strong>D√©sir fondamental :</strong> Se sentir pr√©cieux et admir√© pour leurs r√©alisations</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Ambitieux et charismatiques</li>
                            <li>Efficaces et comp√©titifs</li>
                            <li>Flexibles et orient√©s vers les objectifs</li>
                            <li>Tr√®s conscients de leur image</li>
                            <li>Peuvent n√©gliger leurs √©motions ou celles des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils sont authentiques, inspirants et encouragent les autres √† r√©ussir. Ils assument leurs valeurs personnelles plut√¥t que de rechercher uniquement la reconnaissance.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir obs√©d√©s par leur image, ignorer leurs besoins √©motionnels et craindre l'√©chec.</p>
                    </div>
                `
            },
            '4': {
                title: 'Type 4 - L\'Artiste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†4 recherchent l'authenticit√© et un sens personnel. Sensibles et cr√©atifs, ils veulent √™tre compris et exprimer leur individualit√©. Ils peuvent √™tre introspectifs et parfois m√©lancoliques.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Ne pas avoir d'identit√© ou de valeur personnelle</p>
                            <p><strong>D√©sir fondamental :</strong> Trouver leur v√©ritable identit√© et s'exprimer de mani√®re authentique</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Sensibles et introspectifs</li>
                            <li>Cr√©atifs et expressifs</li>
                            <li>Appr√©cient la profondeur et l'authenticit√©</li>
                            <li>Peuvent √™tre m√©lancoliques et se sentir diff√©rents</li>
                            <li>Recherchent souvent un sens et une connexion profonde</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils sont hautement cr√©atifs, inspir√©s et capables de transformer leur exp√©rience personnelle en quelque chose d'universel.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent se sentir incompris, se retirer et devenir auto‚Äëindulgents ou envieux des autres.</p>
                    </div>
                `
            },
            '5': {
                title: 'Type 5 - L\'Investigateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†5 veulent comprendre le monde. Ils sont observateurs, innovants et autonomes. Ils peuvent se retirer pour pr√©server leur √©nergie et d√©velopper leurs connaissances.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> √ätre impuissant, inutile ou incapable</p>
                            <p><strong>D√©sir fondamental :</strong> √ätre comp√©tent et comprendre l'environnement</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Observateurs et analytiques</li>
                            <li>Innovants et cr√©atifs</li>
                            <li>Ind√©pendants et r√©serv√©s</li>
                            <li>Recherchent la ma√Ætrise de leurs domaines d'int√©r√™t</li>
                            <li>Peuvent se couper de leurs √©motions ou des autres</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils sont visionnaires, pionniers et apportent des id√©es novatrices qui am√©liorent la soci√©t√©.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir d√©tach√©s, trop rationnels et √©viter la participation sociale.</p>
                    </div>
                `
            },
            '6': {
                title: 'Type 6 - Le Loyaliste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†6 recherchent la s√©curit√© et la confiance. Loyaux et fiables, ils anticipent les probl√®mes et recherchent le soutien. Ils peuvent osciller entre la prudence et l'audace.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> √ätre sans soutien ou sans direction</p>
                            <p><strong>D√©sir fondamental :</strong> √ätre en s√©curit√© et soutenu</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Fiables et d√©vou√©s</li>
                            <li>Consciencieux et travailleurs</li>
                            <li>Tendance √† anticiper les probl√®mes</li>
                            <li>Peuvent osciller entre doute et confiance</li>
                            <li>Parfois anxieux ou sceptiques</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils sont courageux, engag√©s et se mettent au service d'une cause plus grande qu'eux.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir m√©fiants, autoritaires ou excessivement anxieux.</p>
                    </div>
                `
            },
            '7': {
                title: 'Type 7 - L\'Enthousiaste',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†7 sont optimistes et aventuriers. Ils recherchent des exp√©riences stimulantes et veulent √©viter la douleur et l'ennui. Souvent joyeux, ils peuvent se disperser.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> √ätre priv√©s ou coinc√©s dans la souffrance</p>
                            <p><strong>D√©sir fondamental :</strong> √ätre heureux, satisfaits et libres</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Extravertis et optimistes</li>
                            <li>Polyvalents et spontan√©s</li>
                            <li>Curieux et enthousiastes</li>
                            <li>Aiment planifier des projets et des voyages</li>
                            <li>Peuvent √™tre dispers√©s ou √©viter la douleur √† tout prix</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils canaliseront leur √©nergie dans des objectifs significatifs et appr√©cieront la simplicit√© et la gratitude.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent fuir les responsabilit√©s, se disperser ou chercher des distractions excessives.</p>
                    </div>
                `
            },
            '8': {
                title: 'Type 8 - Le Challenger',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†8 valorisent l'ind√©pendance et la protection. Ils sont confiants, forts et veulent se prot√©ger et prot√©ger les autres. Ils peuvent devenir dominants s'ils se sentent menac√©s.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> √ätre bless√©s ou contr√¥l√©s par autrui</p>
                            <p><strong>D√©sir fondamental :</strong> √ätre ma√Ætres de leur vie et prot√©ger les faibles</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>Assertifs et d√©cisifs</li>
                            <li>Confiants et protecteurs</li>
                            <li>Dirigeants naturels</li>
                            <li>D√©fendent leurs convictions</li>
                            <li>Peuvent √™tre contr√¥lants ou impulsifs</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils utilisent leur force pour am√©liorer le monde et prot√©ger les vuln√©rables. Ils sont magnanimes et courageux.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent devenir dominateurs, se m√©fier des autres et r√©agir avec col√®re.</p>
                    </div>
                `
            },
            '9': {
                title: 'Type 9 - Le M√©diateur',
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-700">Les Type¬†9 recherchent la paix int√©rieure et ext√©rieure. Ils sont r√©ceptifs, conciliants et stables. Ils fuient les conflits et peuvent devenir complaisants pour pr√©server l'harmonie.</p>

                        <h3 class="text-lg font-semibold text-gray-900">Motivations profondes :</h3>
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <p><strong>Peur fondamentale :</strong> Perdre la connexion ou √™tre s√©par√© des autres</p>
                            <p><strong>D√©sir fondamental :</strong> Maintenir la paix et l'harmonie</p>
                        </div>
                        
                        <h3 class="text-lg font-semibold text-gray-900">Caract√©ristiques :</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>R√©ceptifs et rassurants</li>
                            <li>Stables et accommodants</li>
                            <li>M√©diateurs naturels</li>
                            <li>√âvitent les conflits et la prise de d√©cision</li>
                            <li>Peuvent devenir complaisants ou inertes</li>
                        </ul>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En sant√© :</h3>
                        <p class="text-gray-700">Ils apportent la paix et la coh√©sion, aident les autres √† coop√©rer et deviennent des sources d'unit√©.</p>
                        
                        <h3 class="text-lg font-semibold text-gray-900">En stress :</h3>
                        <p class="text-gray-700">Ils peuvent ignorer leurs propres besoins, √©viter les conflits et se dissocier √©motionnellement.</p>
                    </div>
                `
            }
        };

        // Fonctions pour afficher les d√©tails
        function showMBTIDetails(type) {
            const details = mbtiDetailedDescriptions[type];
            if (details) {
                showModal(details.title, details.content);
            } else {
                showModal(`${type} - Description`, `<p>Description d√©taill√©e du type ${type} en cours de d√©veloppement.</p>`);
            }
        }

        function showEnneagramDetails(type) {
            const details = enneagramDetailedDescriptions[type];
            if (details) {
                showModal(details.title, details.content);
            } else {
                showModal(`Type ${type} - Description`, `<p>Description d√©taill√©e du type ${type} en cours de d√©veloppement.</p>`);
            }
        }

        function showAboutProject() {
            const content = `
                <div class="space-y-4">
                    <p class="text-gray-700">"Personnalit√© Compar√©e" est n√© de la volont√© de cr√©er un outil plus objectif pour comprendre sa personnalit√©.</p>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Notre approche unique :</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <i class="fas fa-eye text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Vision objective</h4>
                            <p class="text-sm text-gray-600">Combiner plusieurs perspectives pour une analyse plus compl√®te</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <i class="fas fa-shield-alt text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Confidentialit√©</h4>
                            <p class="text-sm text-gray-600">Vos donn√©es sont prot√©g√©es et ne sont jamais partag√©es</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <i class="fas fa-graduation-cap text-green-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold">Base scientifique</h4>
                            <p class="text-sm text-gray-600">Fond√© sur les recherches en psychologie de la personnalit√©</p>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Pourquoi cette approche ?</h3>
                    <p class="text-gray-700">Contrairement aux tests traditionnels qui reposent uniquement sur l'auto-√©valuation, notre approche combine votre perception avec celle de votre entourage pour un r√©sultat plus nuanc√© et fid√®le.</p>
                    
                    <h3 class="text-lg font-semibold text-gray-900">Comment √ßa marche ?</h3>
                    <ol class="list-decimal list-inside text-gray-700 space-y-1">
                        <li>Vous r√©pondez √† 16 questions d'auto-√©valuation</li>
                        <li>Vous partagez votre code unique avec vos proches</li>
                        <li>Ils r√©pondent √† 20 questions sur votre personnalit√©</li>
                        <li>Notre algorithme combine toutes les r√©ponses avec une pond√©ration scientifique</li>
                        <li>Vous obtenez votre profil MBTI et Enn√©agramme avec un score de certitude</li>
                    </ol>
                </div>
            `;
            showModal('√Ä propos du projet', content);
        }

        // Fonctions pour les pages l√©gales et contact
        function showPrivacyPolicy() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Politique de Confidentialit√©</h3>
                    <p class="text-gray-700">Derni√®re mise √† jour : ${new Date().toLocaleDateString('fr-FR')}</p>
                    
                    <h4 class="font-semibold text-gray-900">Collecte des donn√©es</h4>
                    <p class="text-gray-700">Nous collectons uniquement les donn√©es n√©cessaires au fonctionnement du test de personnalit√© : vos r√©ponses aux questions et les √©valuations de vos proches.</p>
                    
                    <h4 class="font-semibold text-gray-900">Utilisation des donn√©es</h4>
                    <p class="text-gray-700">Vos donn√©es sont utilis√©es exclusivement pour calculer votre profil de personnalit√©. Elles ne sont jamais partag√©es avec des tiers.</p>
                    
                    <h4 class="font-semibold text-gray-900">Stockage et s√©curit√©</h4>
                    <p class="text-gray-700">Toutes les donn√©es sont stock√©es localement dans votre navigateur. Aucune information n'est transmise √† nos serveurs.</p>
                    
                    <h4 class="font-semibold text-gray-900">Vos droits</h4>
                    <p class="text-gray-700">Vous pouvez supprimer vos donn√©es √† tout moment en vidant le cache de votre navigateur.</p>
                </div>
            `;
            showModal('Politique de Confidentialit√©', content);
        }

        function showTermsOfService() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Conditions d'Utilisation</h3>
                    <p class="text-gray-700">Derni√®re mise √† jour : ${new Date().toLocaleDateString('fr-FR')}</p>
                    
                    <h4 class="font-semibold text-gray-900">Utilisation du service</h4>
                    <p class="text-gray-700">Ce service est fourni gratuitement √† des fins √©ducatives et de d√©veloppement personnel. Il ne remplace pas un conseil professionnel en psychologie.</p>
                    
                    <h4 class="font-semibold text-gray-900">Pr√©cision des r√©sultats</h4>
                    <p class="text-gray-700">Les r√©sultats sont bas√©s sur des mod√®les psychologiques reconnus mais ne constituent pas un diagnostic m√©dical ou psychologique.</p>
                    
                    <h4 class="font-semibold text-gray-900">Responsabilit√©</h4>
                    <p class="text-gray-700">L'utilisation de ce service se fait sous votre propre responsabilit√©. Nous ne sommes pas responsables des d√©cisions prises sur la base des r√©sultats.</p>
                </div>
            `;
            showModal('Conditions d\'Utilisation', content);
        }

        function showLegalNotices() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Mentions L√©gales</h3>
                    
                    <h4 class="font-semibold text-gray-900">√âditeur du site</h4>
                    <p class="text-gray-700">Personnalit√© Compar√©e<br>
                    Site web √©ducatif<br>
                    Contact : contact@personnalite-comparee.fr</p>
                    
                    <h4 class="font-semibold text-gray-900">H√©bergement</h4>
                    <p class="text-gray-700">Ce site est h√©berg√© par Manus Cloud Platform</p>
                    
                    <h4 class="font-semibold text-gray-900">Propri√©t√© intellectuelle</h4>
                    <p class="text-gray-700">Le contenu de ce site est prot√©g√© par le droit d'auteur. Les mod√®les MBTI et Enn√©agramme sont utilis√©s √† des fins √©ducatives.</p>
                    
                    <h4 class="font-semibold text-gray-900">Cookies</h4>
                    <p class="text-gray-700">Ce site utilise uniquement le stockage local du navigateur pour sauvegarder votre progression. Aucun cookie de suivi n'est utilis√©.</p>
                </div>
            `;
            showModal('Mentions L√©gales', content);
        }

        function showContact() {
            const content = `
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-900">Nous Contacter</h3>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-900">Email</h4>
                        <p class="text-blue-700">contact@personnalite-comparee.fr</p>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-900">Support technique</h4>
                        <p class="text-blue-700">Pour toute question technique ou probl√®me avec le test, n'h√©sitez pas √† nous √©crire en d√©taillant votre probl√®me.</p>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-900">Suggestions</h4>
                        <p class="text-green-700">Vos suggestions d'am√©lioration sont les bienvenues ! Aidez-nous √† am√©liorer l'exp√©rience utilisateur.</p>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-900">Temps de r√©ponse</h4>
                        <p class="text-yellow-700">Nous nous effor√ßons de r√©pondre √† tous les messages dans les 48 heures.</p>
                    </div>
                </div>
            `;
            showModal('Contact', content);
        }

        // Fonction pour d√©marrer l'√©valuation externe
        function startExternalEvaluation() {
            const codeInput = document.querySelector('input[placeholder="Ex: ABC123"]');
            const relationInputs = document.querySelectorAll('input[name="relation"]');
            
            if (!codeInput || !codeInput.value.trim()) {
                alert('Veuillez entrer le code unique de la personne √† √©valuer.');
                return;
            }
            
            let selectedRelation = null;
            relationInputs.forEach(input => {
                if (input.checked) {
                    selectedRelation = input.value;
                }
            });
            
            if (!selectedRelation) {
                alert('Veuillez s√©lectionner votre relation avec cette personne.');
                return;
            }
            
            // Sauvegarder les informations de l'√©valuation externe
            localStorage.setItem('externalEvaluationCode', codeInput.value.trim().toUpperCase());
            localStorage.setItem('externalEvaluationRelation', selectedRelation);
            
            // Ouvrir les questions d'√©valuation externe dans une fen√™tre modale
            showExternalEvaluationQuestions();
        }

        // Fonction pour afficher les questions d'√©valuation externe
        function showExternalEvaluationQuestions() {
            const code = localStorage.getItem('externalEvaluationCode');
            const relation = localStorage.getItem('externalEvaluationRelation');
            
            const relationLabels = {
                'family': 'Membre de la famille',
                'partner': 'Partenaire amoureux',
                'friend': 'Ami(e)',
                'colleague': 'Coll√®gue de travail'
            };
            
            const content = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                        <div class="bg-blue-600 px-6 py-4 flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold text-white">√âvaluation externe</h2>
                                <p class="text-blue-100 mt-1">Code: ${code} | Relation: ${relationLabels[relation]}</p>
                            </div>
                            <span class="close" onclick="closeModal()" style="color: white;">&times;</span>
                        </div>
                        <div class="p-6">
                            <form id="eval-form">
                                <div id="external-questions-content">
                                    <!-- Les questions seront ajout√©es ici -->
                                </div>
                                <div class="mt-6 flex justify-between">
                                    <button type="button" id="prev-external-question" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" style="display: none;">
                                        <i class="fas fa-arrow-left mr-2"></i> Question pr√©c√©dente
                                    </button>
                                    <button type="button" id="next-external-question" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                                        Question suivante <i class="fas fa-arrow-right ml-2"></i>
                                    </button>
                                    <button type="submit" id="submit-eval" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700" style="display: none;">
                                        <i class="fas fa-check mr-2"></i> Terminer l'√©valuation
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            showModal('', content);

            // Masquer l'en-t√™te par d√©faut de la modale et ajuster la taille
            const defaultHeader = document.querySelector('#current-modal .modal-header');
            if (defaultHeader) defaultHeader.style.display = 'none';

            const modalContent = document.querySelector('#current-modal .modal-content');
            if (modalContent) {
                modalContent.style.maxWidth = '900px';
                modalContent.style.width = '90%';
                modalContent.style.padding = '0';
            }

            // Initialiser les questions externes
            currentExternalQuestionIndex = 0;
            externalAnswers = {};
            displayExternalQuestion(0);
            setupExternalQuestionNavigation();
            setupEvalFormSubmit();
        }
        
        // Variables pour l'√©valuation externe
        let currentExternalQuestionIndex = 0;
        let externalAnswers = {};
        
        // Questions pour l'√©valuation externe (20 questions)
        const EXTERNAL_EVALUATION_QUESTIONS = [
            {
                id: 1,
                question: "Cette personne pr√©f√®re g√©n√©ralement :",
                options: [
                    { text: "√ätre entour√©e de beaucoup de monde", mbti: { E: 3 }, enneagram: { 3: 1, 7: 2 } },
                    { text: "Passer du temps seule ou avec quelques proches", mbti: { I: 3 }, enneagram: { 4: 2, 5: 2 } },
                    { text: "Alterner entre moments sociaux et moments seuls", mbti: { E: 1, I: 1 }, enneagram: { 9: 2 } },
                    { text: "Cela d√©pend de son humeur", mbti: { P: 1 }, enneagram: { 4: 1, 7: 1 } }
                ]
            },
            {
                id: 2,
                question: "Quand cette personne prend des d√©cisions, elle :",
                options: [
                    { text: "Analyse tous les faits et donn√©es", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "Suit son instinct et ses √©motions", mbti: { F: 3, P: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "Demande l'avis de plusieurs personnes", mbti: { F: 2, E: 1 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Prend du temps pour r√©fl√©chir", mbti: { I: 2, J: 1 }, enneagram: { 5: 2, 9: 1 } }
                ]
            },
            {
                id: 3,
                question: "Cette personne est motiv√©e principalement par :",
                options: [
                    { text: "Le d√©sir d'aider les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "L'atteinte de ses objectifs personnels", mbti: { T: 2, J: 1 }, enneagram: { 3: 3 } },
                    { text: "La recherche de nouvelles exp√©riences", mbti: { N: 2, P: 2 }, enneagram: { 7: 3 } },
                    { text: "Le maintien de l'harmonie", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 4,
                question: "Face au stress, cette personne :",
                options: [
                    { text: "Devient plus organis√©e et contr√¥lante", mbti: { J: 3, T: 1 }, enneagram: { 1: 2, 8: 2 } },
                    { text: "Cherche du soutien aupr√®s des autres", mbti: { F: 2, E: 2 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Se retire et r√©fl√©chit seule", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } },
                    { text: "√âvite le probl√®me ou le minimise", mbti: { P: 2, F: 1 }, enneagram: { 7: 2, 9: 2 } }
                ]
            },
            {
                id: 5,
                question: "Cette personne communique de mani√®re :",
                options: [
                    { text: "Directe et factuelle", mbti: { T: 3, S: 1 }, enneagram: { 1: 1, 8: 2 } },
                    { text: "Chaleureuse et empathique", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Cr√©ative et m√©taphorique", mbti: { N: 3, F: 1 }, enneagram: { 4: 3 } },
                    { text: "Diplomatique et nuanc√©e", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            }
            // ... (15 autres questions similaires)
        ];
        
        // Ajouter les 15 questions manquantes
        EXTERNAL_EVALUATION_QUESTIONS.push(
            {
                id: 6,
                question: "Cette personne g√®re le changement en :",
                options: [
                    { text: "S'adaptant rapidement et avec enthousiasme", mbti: { P: 3, E: 1 }, enneagram: { 7: 3 } },
                    { text: "Prenant le temps d'analyser les implications", mbti: { J: 2, T: 2 }, enneagram: { 5: 2, 6: 1 } },
                    { text: "Cherchant du soutien aupr√®s des autres", mbti: { F: 2, E: 1 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "R√©sistant au d√©but puis s'adaptant", mbti: { J: 2, I: 1 }, enneagram: { 1: 1, 9: 2 } }
                ]
            },
            {
                id: 7,
                question: "Dans son travail, cette personne privil√©gie :",
                options: [
                    { text: "La qualit√© et la perfection", mbti: { J: 3, T: 1 }, enneagram: { 1: 3 } },
                    { text: "L'efficacit√© et les r√©sultats", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "La collaboration et l'harmonie", mbti: { F: 3 }, enneagram: { 2: 2, 9: 2 } },
                    { text: "L'innovation et la cr√©ativit√©", mbti: { N: 3, P: 1 }, enneagram: { 4: 2, 7: 2 } }
                ]
            },
            {
                id: 8,
                question: "Cette personne exprime ses √©motions :",
                options: [
                    { text: "Ouvertement et spontan√©ment", mbti: { E: 3, F: 2 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "De mani√®re contr√¥l√©e et r√©fl√©chie", mbti: { I: 2, T: 2 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "Principalement avec ses proches", mbti: { I: 2, F: 2 }, enneagram: { 4: 2, 6: 1 } },
                    { text: "Rarement, pr√©f√®re les garder pour elle", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } }
                ]
            },
            {
                id: 9,
                question: "Face √† une critique, cette personne :",
                options: [
                    { text: "L'accepte et cherche √† s'am√©liorer", mbti: { J: 2, T: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "Se d√©fend et explique son point de vue", mbti: { E: 2, T: 1 }, enneagram: { 3: 2, 8: 2 } },
                    { text: "Se sent bless√©e mais n'en parle pas", mbti: { I: 2, F: 2 }, enneagram: { 4: 3 } },
                    { text: "Minimise et √©vite le conflit", mbti: { P: 2, F: 1 }, enneagram: { 7: 1, 9: 3 } }
                ]
            },
            {
                id: 10,
                question: "Cette personne prend des risques :",
                options: [
                    { text: "Rarement, pr√©f√®re la s√©curit√©", mbti: { J: 2, S: 2 }, enneagram: { 6: 3 } },
                    { text: "Apr√®s une analyse approfondie", mbti: { T: 3, J: 1 }, enneagram: { 5: 2, 1: 1 } },
                    { text: "Quand cela peut aider les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Souvent, aime l'aventure", mbti: { P: 3, N: 1 }, enneagram: { 7: 3 } }
                ]
            },
            {
                id: 11,
                question: "Cette personne organise son espace de vie :",
                options: [
                    { text: "De mani√®re tr√®s ordonn√©e et syst√©matique", mbti: { J: 3, S: 1 }, enneagram: { 1: 3 } },
                    { text: "Fonctionnellement, selon ses besoins", mbti: { T: 2, J: 1 }, enneagram: { 3: 2, 5: 1 } },
                    { text: "De fa√ßon cr√©ative et personnelle", mbti: { N: 2, F: 2 }, enneagram: { 4: 3 } },
                    { text: "De mani√®re d√©contract√©e, parfois d√©sordonn√©e", mbti: { P: 3 }, enneagram: { 7: 2, 9: 2 } }
                ]
            },
            {
                id: 12,
                question: "Cette personne apprend mieux :",
                options: [
                    { text: "En suivant une m√©thode structur√©e", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 6: 1 } },
                    { text: "En exp√©rimentant par elle-m√™me", mbti: { P: 3, N: 1 }, enneagram: { 7: 2, 8: 1 } },
                    { text: "En √©changeant avec d'autres", mbti: { E: 3, F: 1 }, enneagram: { 2: 2, 3: 1 } },
                    { text: "En r√©fl√©chissant seule", mbti: { I: 3, T: 1 }, enneagram: { 5: 3 } }
                ]
            },
            {
                id: 13,
                question: "Cette personne g√®re son temps :",
                options: [
                    { text: "Avec des plannings d√©taill√©s", mbti: { J: 3, S: 1 }, enneagram: { 1: 2, 3: 1 } },
                    { text: "En se concentrant sur les priorit√©s", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "De mani√®re flexible selon l'humeur", mbti: { P: 3, F: 1 }, enneagram: { 4: 2, 7: 2 } },
                    { text: "En procrastinant souvent", mbti: { P: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            },
            {
                id: 14,
                question: "Cette personne r√©sout les probl√®mes en :",
                options: [
                    { text: "Analysant logiquement les faits", mbti: { T: 3, J: 1 }, enneagram: { 5: 3 } },
                    { text: "Cherchant des solutions cr√©atives", mbti: { N: 3, P: 1 }, enneagram: { 4: 2, 7: 2 } },
                    { text: "Demandant conseil √† son entourage", mbti: { F: 2, E: 2 }, enneagram: { 2: 1, 6: 3 } },
                    { text: "Agissant rapidement et directement", mbti: { E: 2, S: 2 }, enneagram: { 8: 3 } }
                ]
            },
            {
                id: 15,
                question: "Cette personne exprime son affection :",
                options: [
                    { text: "Par des gestes concrets et des services", mbti: { S: 3, F: 1 }, enneagram: { 2: 2, 6: 1 } },
                    { text: "Par des mots et des compliments", mbti: { E: 2, F: 2 }, enneagram: { 2: 3 } },
                    { text: "Par sa pr√©sence et son √©coute", mbti: { I: 2, F: 3 }, enneagram: { 9: 3 } },
                    { text: "De mani√®re subtile et discr√®te", mbti: { I: 3, T: 1 }, enneagram: { 5: 2, 4: 1 } }
                ]
            },
            {
                id: 16,
                question: "Cette personne fait face aux √©checs :",
                options: [
                    { text: "En analysant ce qui n'a pas march√©", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "En rebondissant rapidement", mbti: { E: 2, P: 2 }, enneagram: { 3: 2, 7: 2 } },
                    { text: "En cherchant du soutien √©motionnel", mbti: { F: 3, E: 1 }, enneagram: { 2: 1, 6: 2 } },
                    { text: "En se remettant en question profond√©ment", mbti: { I: 2, F: 2 }, enneagram: { 4: 3 } }
                ]
            },
            {
                id: 17,
                question: "Cette personne prend des d√©cisions importantes :",
                options: [
                    { text: "Apr√®s avoir pes√© tous les pour et contre", mbti: { T: 3, J: 2 }, enneagram: { 5: 2, 6: 2 } },
                    { text: "En suivant son intuition", mbti: { N: 3, F: 1 }, enneagram: { 4: 2, 7: 1 } },
                    { text: "En consultant ses proches", mbti: { F: 2, E: 2 }, enneagram: { 2: 2, 6: 2 } },
                    { text: "Rapidement, en faisant confiance √† son exp√©rience", mbti: { S: 2, E: 2 }, enneagram: { 8: 3 } }
                ]
            },
            {
                id: 18,
                question: "Cette personne se ressource :",
                options: [
                    { text: "En passant du temps seule", mbti: { I: 3 }, enneagram: { 5: 3 } },
                    { text: "En √©tant entour√©e d'amis", mbti: { E: 3 }, enneagram: { 7: 2, 2: 1 } },
                    { text: "En aidant les autres", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "En pratiquant ses hobbies", mbti: { P: 2, N: 1 }, enneagram: { 4: 2, 9: 2 } }
                ]
            },
            {
                id: 19,
                question: "Cette personne exprime son d√©saccord :",
                options: [
                    { text: "Directement et clairement", mbti: { T: 3, E: 2 }, enneagram: { 8: 3 } },
                    { text: "De mani√®re diplomatique", mbti: { F: 3, I: 1 }, enneagram: { 9: 3 } },
                    { text: "En argumentant avec des faits", mbti: { T: 3, J: 1 }, enneagram: { 1: 2, 5: 2 } },
                    { text: "En √©vitant le conflit si possible", mbti: { F: 2, I: 2 }, enneagram: { 9: 2, 6: 1 } }
                ]
            },
            {
                id: 20,
                question: "Cette personne se sent le plus √©panouie quand :",
                options: [
                    { text: "Elle atteint ses objectifs personnels", mbti: { T: 2, J: 2 }, enneagram: { 3: 3 } },
                    { text: "Elle aide quelqu'un √† r√©ussir", mbti: { F: 3 }, enneagram: { 2: 3 } },
                    { text: "Elle d√©couvre quelque chose de nouveau", mbti: { N: 3, P: 1 }, enneagram: { 5: 2, 7: 2 } },
                    { text: "Elle maintient l'harmonie autour d'elle", mbti: { F: 2, I: 1 }, enneagram: { 9: 3 } }
                ]
            }
        );

        // Ajout de l'option "Je ne sais pas" √† chaque question d'√©valuation externe
        EXTERNAL_EVALUATION_QUESTIONS.forEach(q => {
            q.options.push({ text: "Je ne sais pas", mbti: {}, enneagram: {} });
        });

        // Fonction pour afficher une question externe
        function displayExternalQuestion(index) {
            const question = EXTERNAL_EVALUATION_QUESTIONS[index];
            if (!question) return;
            
            const progress = ((index + 1) / EXTERNAL_EVALUATION_QUESTIONS.length) * 100;
            const questionsContent = document.getElementById('external-questions-content');
            
            questionsContent.innerHTML = `
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-medium text-blue-600">Question ${index + 1}/${EXTERNAL_EVALUATION_QUESTIONS.length}</span>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 ml-4">
                            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <h3 class="text-xl font-medium text-gray-900 mb-6">${question.question}</h3>
                    
                    <div class="space-y-4">
                        ${question.options.map((option, optionIndex) => {
                            const value = optionIndex === question.options.length - 1 ? 0 : optionIndex + 1;
                            const extraClass = optionIndex === question.options.length - 1 ? ' mt-1' : '';
                            const dataChoice = value === 0 ? ' data-choice="unknown"' : '';
                            return `
                            <div class="flex items-start${extraClass}">
                                <input id="eq${question.id}-${optionIndex}" name="external_question${question.id}" type="radio" value="${value}"${dataChoice} class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 mt-1" ${externalAnswers[question.id] === value ? 'checked' : ''}>
                                <label for="eq${question.id}-${optionIndex}" class="ml-3 block text-sm font-medium text-gray-700 cursor-pointer hover:text-gray-900 transition-colors">
                                    ${option.text}
                                </label>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `;

            // √âcouter les changements de r√©ponse
            const radioButtons = questionsContent.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    externalAnswers[question.id] = parseInt(this.value);
                    updateExternalNavigationButtons();
                });
            });
            
            updateExternalNavigationButtons();
        }
        
        // Configuration de la navigation pour les questions externes
        function setupExternalQuestionNavigation() {
            const prevButton = document.getElementById('prev-external-question');
            const nextButton = document.getElementById('next-external-question');
            
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    if (currentExternalQuestionIndex > 0) {
                        currentExternalQuestionIndex--;
                        displayExternalQuestion(currentExternalQuestionIndex);
                    }
                });
            }
            
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    if (externalAnswers[EXTERNAL_EVALUATION_QUESTIONS[currentExternalQuestionIndex].id] !== undefined) {
                        if (currentExternalQuestionIndex < EXTERNAL_EVALUATION_QUESTIONS.length - 1) {
                            currentExternalQuestionIndex++;
                            displayExternalQuestion(currentExternalQuestionIndex);
                        }
                    } else {
                        alert('Veuillez s√©lectionner une r√©ponse avant de continuer.');
                    }
                });
            }
        }
        
        // Mise √† jour des boutons de navigation externes
        function updateExternalNavigationButtons() {
            const prevButton = document.getElementById('prev-external-question');
            const nextButton = document.getElementById('next-external-question');
            const finishButton = document.getElementById('submit-eval');

            if (prevButton) {
                prevButton.style.display = currentExternalQuestionIndex > 0 ? 'inline-flex' : 'none';
            }

            const isLastQuestion = currentExternalQuestionIndex === EXTERNAL_EVALUATION_QUESTIONS.length - 1;
            const hasAnswer = externalAnswers[EXTERNAL_EVALUATION_QUESTIONS[currentExternalQuestionIndex].id] !== undefined;

            if (nextButton && finishButton) {
                if (isLastQuestion) {
                    nextButton.style.display = 'none';
                    finishButton.style.display = hasAnswer ? 'inline-flex' : 'none';
                } else {
                    nextButton.style.display = 'inline-flex';
                    finishButton.style.display = 'none';
                }
            }
        }

        function setupEvalFormSubmit() {
            const form = document.getElementById('eval-form');
            const btn = document.getElementById('submit-eval');
            if (!form || !btn) return;

            function setLoadingState() {
                btn.disabled = true;
                btn.classList.remove('bg-green-500', 'bg-red-500');
                btn.removeAttribute('aria-live');
                btn.innerHTML = '<span class="spinner"></span> Veuillez patienter, nous enregistrons vos r√©ponses...';
            }

            function setSuccessState() {
                btn.disabled = true;
                btn.classList.remove('bg-red-500', 'bg-green-600', 'hover:bg-green-700');
                btn.classList.add('bg-green-500', 'text-white');
                btn.removeAttribute('aria-live');
                btn.innerHTML = 'Succ√®s ‚úÖ';
            }

            function setErrorState() {
                btn.disabled = true;
                btn.classList.remove('bg-green-500', 'bg-green-600', 'hover:bg-green-700');
                btn.classList.add('bg-red-500', 'text-white');
                btn.innerHTML = 'Erreur ‚ùå';
                btn.setAttribute('aria-live', 'polite');
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                if (btn.disabled) return;
                if (Object.keys(externalAnswers).length !== EXTERNAL_EVALUATION_QUESTIONS.length) {
                    alert('Veuillez r√©pondre √† toutes les questions avant de terminer.');
                    return;
                }
                setLoadingState();
                await new Promise(r => setTimeout(r, 0));

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 12000);
                try {
                    await Promise.race([
                        submitExternalEvaluation(),
                        new Promise((_, reject) => {
                            controller.signal.addEventListener('abort', () => reject(new DOMException('Timeout', 'AbortError')));
                        })
                    ]);
                    setSuccessState();
                } catch (err) {
                    if (err.name === 'AbortError') {
                        alert('La requ√™te a expir√©. Veuillez r√©essayer.');
                    } else {
                        console.error(err);
                        alert('Une erreur est survenue lors de l\'enregistrement.');
                    }
                    setErrorState();
                } finally {
                    clearTimeout(timeoutId);
                }
            }, { once: false });
        }

        // Fonction pour soumettre l'√©valuation externe
        async function submitExternalEvaluation() {
            const code = localStorage.getItem('externalEvaluationCode');
            const relation = localStorage.getItem('externalEvaluationRelation');
            
            // Calculer les scores MBTI et Enn√©agramme pour cette √©valuation
            const mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const enneagramScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 };
            Object.keys(externalAnswers).forEach(questionId => {
                const question = EXTERNAL_EVALUATION_QUESTIONS.find(q => q.id === parseInt(questionId));
                const value = externalAnswers[questionId];
                if (value === 0) {
                    return;
                }
                const selectedOption = question.options[value - 1];
                // Ajouter les scores MBTI
                Object.keys(selectedOption.mbti).forEach(trait => {
                    mbtiScores[trait] += selectedOption.mbti[trait];
                });
                // Ajouter les scores Enn√©agramme
                Object.keys(selectedOption.enneagram).forEach(type => {
                    enneagramScores[type] += selectedOption.enneagram[type];
                });
            });
            // Enregistrer dans Supabase
            await saveExternalEvaluationToSupabase(code, relation, mbtiScores, enneagramScores);
            // Nettoyer le stockage local temporaire
            localStorage.removeItem('externalEvaluationCode');
            localStorage.removeItem('externalEvaluationRelation');
            // Afficher un message de confirmation
            const questionsContainer = document.getElementById('questions-container');
            questionsContainer.innerHTML = `
                <div class="max-w-2xl mx-auto text-center">
                    <div class="bg-white shadow-lg rounded-lg p-8">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <i class="fas fa-check text-green-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">√âvaluation termin√©e !</h2>
                        <p class="text-gray-600 mb-6">
                            Merci d'avoir pris le temps d'√©valuer cette personne. Votre √©valuation a √©t√© enregistr√©e avec le code <strong>${code}</strong>.
                        </p>
                        <p class="text-sm text-gray-500 mb-6">
                            La personne recevra ses r√©sultats complets une fois que toutes les √©valuations seront termin√©es.
                        </p>
                        <button onclick="location.reload()" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            <i class="fas fa-home mr-2"></i> Retour √† l'accueil
                        </button>
                    </div>
                </div>
            `;
        }

        // Chargement de la progression au d√©marrage
        if (loadProgress()) {
            displayQuestion(currentQuestionIndex);
        }
        
        // Gestion du menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuIcon = document.getElementById('menu-icon');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    const isOpen = mobileMenu.style.display === 'block';
                    
                    if (isOpen) {
                        mobileMenu.style.display = 'none';
                        menuIcon.className = 'fas fa-bars';
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    } else {
                        mobileMenu.style.display = 'block';
                        menuIcon.className = 'fas fa-times';
                        mobileMenuButton.setAttribute('aria-expanded', 'true');
                    }
                });
                
                // Fermer le menu quand on clique sur un lien
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.style.display = 'none';
                        menuIcon.className = 'fas fa-bars';
                        mobileMenuButton.setAttribute('aria-expanded', 'false');
                    });
                });
            }
        });
        
        // ===== ESPACE PERSONNEL =====
        
        // Base de donn√©es simul√©e des profils (non utilis√©e, conserv√©e pour r√©f√©rence)
        /* const profilesDatabase = {
            'ABC123': {
                name: 'Jean Dupont',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Ami(e)', completed: true, completedAt: '2024-01-15' },
                    { relation: 'Membre de la famille', completed: true, completedAt: '2024-01-16' },
                    { relation: 'Coll√®gue de travail', completed: false, completedAt: null }
                ],
                results: {
                    mbti: 'ENFJ',
                    enneagram: 'Type 2',
                    certainty: 91
                }
            },
            'XYZ789': {
                name: 'Marie Martin',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Partenaire amoureux', completed: true, completedAt: '2024-01-10' },
                    { relation: 'Ami(e)', completed: false, completedAt: null },
                    { relation: 'Membre de la famille', completed: false, completedAt: null }
                ],
                results: null
            },
            'DEF456': {
                name: 'Pierre Durand',
                selfEvaluationCompleted: true,
                externalEvaluations: [
                    { relation: 'Ami(e)', completed: true, completedAt: '2024-01-12' },
                    { relation: 'Coll√®gue de travail', completed: true, completedAt: '2024-01-13' },
                    { relation: 'Membre de la famille', completed: true, completedAt: '2024-01-14' }
                ],
                results: {
                    mbti: 'INTJ',
                    enneagram: 'Type 5',
                    certainty: 87
                }
            }
        }; */

        // Fonctions de gestion de la modale
        function openProfileModal(prefillCode) {
            document.getElementById('profile-modal').classList.add('show');
            resetProfileModal();
            if (prefillCode) {
                const input = document.getElementById('profile-code');
                input.value = prefillCode.trim().toUpperCase();
                checkProfileCode();
            }
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('show');
        }

        function resetProfileModal() {
            // Cacher toutes les √©tapes
            document.querySelectorAll('.profile-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Afficher l'√©tape de saisie du code
            document.getElementById('code-input-step').style.display = 'block';
            
            // R√©initialiser le champ de saisie
            document.getElementById('profile-code').value = '';
        }

        async function checkProfileCode() {
            const code = document.getElementById('profile-code').value.trim().toUpperCase();

            if (!code) {
                alert('Veuillez entrer un code');
                return;
            }

            // R√©cup√©ration du profil via Supabase
            let result = await fetchUserProfileFromSupabase(code);
            console.log("üß† R√©sultat brut depuis Supabase :", result);
            console.log("üìò MBTI :", result.user?.mbti_type);
            console.log("üìó Enn√©agramme :", result.user?.enneagram_type);

            if (!result || !result.user) {
                // Afficher le message d'erreur
                document.querySelectorAll('.profile-step').forEach(step => {
                    step.style.display = 'none';
                });
                document.getElementById('error-message').style.display = 'block';
                return;
            }
            if (result.evaluations.length > 0) {
                const updated = await calculateFinalProfile(code);
                if (updated) {
                    result = updated;
                }
            }

            const { user, evaluations } = result;
            const overallCertainty = result.overallCertainty ?? user.certainty_score ?? null;
            // Construire un objet de profil simplifi√© compatible avec displayProfile
            const simplifiedProfile = {
                name: user.mbti_type && user.enneagram_type
                    ? `${user.mbti_type} ‚Äî type ${user.enneagram_type}`
                    : user.mbti_type || 'Profil',
                selfEvaluationCompleted: true,
                externalEvaluations: evaluations.map(ev => ({
                    relation: ev.relation,
                    completed: true,
                    completedAt: ev.created_at
                })),
                results: user.mbti_type && user.enneagram_type
                    ? {
                        mbti: user.mbti_type,
                        enneagram: user.enneagram_type,
                        certainty: overallCertainty
                    }
                    : null
            };
            displayProfile(code, simplifiedProfile);
        }

        function displayProfile(code, profile) {
            // Cacher toutes les √©tapes
            document.querySelectorAll('.profile-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Afficher l'√©tape du statut
            document.getElementById('profile-status-step').style.display = 'block';
            
            // Remplir les informations du profil
            document.getElementById('profile-name').textContent = profile.name;
            document.getElementById('display-code').textContent = code;
            
            // Calculer le statut des √©valuations
            const completedEvaluations = profile.externalEvaluations.filter(ev => ev.completed).length;
            // Dans notre syst√®me, un minimum de trois √©valuations externes est requis
            const totalEvaluationsRequired = 3;
            const totalProgress = profile.selfEvaluationCompleted ? completedEvaluations + 1 : completedEvaluations;
            const maxProgress = totalEvaluationsRequired + 1; // +1 pour l'auto-√©valuation
            
            // Mettre √† jour le statut des √©valuations
            const evaluationsStatus = document.getElementById('evaluations-status');
            // Si toutes les √©valuations requises sont termin√©es, afficher le statut vert, sinon statut orange.
            if (completedEvaluations >= totalEvaluationsRequired) {
                evaluationsStatus.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                evaluationsStatus.innerHTML = '<i class="fas fa-check mr-1"></i> Toutes termin√©es';
            } else {
                evaluationsStatus.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800';
                evaluationsStatus.innerHTML = `<i class="fas fa-clock mr-1"></i> ${completedEvaluations}/${totalEvaluationsRequired} termin√©es`;
            }
            
            // Mettre √† jour la barre de progression
            const progressPercent = (totalProgress / maxProgress) * 100;
            document.getElementById('progress-bar').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = `${totalProgress}/${maxProgress} termin√©`;
            
            // Afficher le message selon le statut (3 √©valuations requises)
            displayStatusMessage(profile, completedEvaluations, 3);
            
            // Afficher/cacher le bouton "Voir mes r√©sultats"
            const viewResultsBtn = document.getElementById('view-results-btn');
            if (completedEvaluations >= 1) {
                viewResultsBtn.style.display = 'block';
            } else {
                viewResultsBtn.style.display = 'none';
            }
        }

        function displayStatusMessage(profile, completedEvaluations, totalEvaluations) {
            const statusMessage = document.getElementById('status-message');
            const totalRequired = 3;
            const remaining = totalRequired - completedEvaluations;
            
            if (completedEvaluations >= totalRequired) {
                statusMessage.className = 'rounded-lg p-4 mb-4 bg-green-50 border border-green-200';
                statusMessage.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-green-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Analyse compl√®te !</h3>
                            <div class="mt-2 text-sm text-green-700">
                                <p>F√©licitations ! Toutes les √©valuations ont √©t√© compl√©t√©es. Vous pouvez maintenant consulter votre profil de personnalit√© complet.</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                statusMessage.className = 'rounded-lg p-4 mb-4 bg-yellow-50 border border-yellow-200';
                const personText = remaining === 1 ? 'personne' : 'personnes';
                const verbText = remaining === 1 ? 'compl√®te' : 'compl√®tent';
                statusMessage.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-clock text-yellow-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800">√âvaluations en cours</h3>
                            <div class="mt-2 text-sm text-yellow-700">
                                <p>Il reste <strong>${remaining} ${personText}</strong> qui ${remaining === 1 ? 'doit' : 'doivent'} ${verbText} l'√©valuation pour am√©liorer votre niveau de certitude.</p>
                                <p class="mt-1">Partagez votre code unique avec vos proches pour qu'ils puissent vous √©valuer.</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function shareProfileCode() {
            const code = document.getElementById('display-code').textContent;
            const shareText = `Salut ! Peux-tu m'aider √† mieux comprendre ma personnalit√© ? Utilise ce code ${code} sur https://personnalite-comparee.fr pour m'√©valuer. Merci ! üòä`;
            
            if (navigator.share) {
                navigator.share({
                    title: '√âvaluation de personnalit√©',
                    text: shareText
                });
            } else {
                // Fallback: copier dans le presse-papiers
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Message copi√© dans le presse-papiers ! Vous pouvez le partager avec vos proches.');
                }).catch(() => {
                    // Fallback ultime: afficher le texte
                    prompt('Copiez ce message pour le partager:', shareText);
                });
            }
        }

        async function viewResults(codeParam) {
            const userCode = (codeParam || document.getElementById('display-code').textContent)
                .trim()
                .toUpperCase();

            if (!userCode) {
                alert('Veuillez entrer un code');
                return;
            }

            const initial = await fetchUserProfileFromSupabase(userCode);

            if (!initial) {
                alert('Code introuvable');
                return;
            }

            if (initial.evaluations.length === 0) {
                alert('Au moins une √©valuation externe est n√©cessaire pour afficher le r√©sultat final.');
                return;
            }

            const selfProfile = getProfileFromScores(initial.user.mbti_scores || {}, initial.user.enneagram_scores || {});

            const result = await calculateFinalProfile(userCode);

            if (!result || !result.user.mbti_type || !result.user.enneagram_type) {
                alert('Le r√©sultat final n‚Äôest pas encore pr√™t.');
                return;
            }

            const externalProfiles = result.evaluations.map(ev => {
                const { mbtiType, enneagramType } = getProfileFromScores(ev.mbti_scores, ev.enneagram_scores);
                const coherenceMBTI = getCoh√©renceMBTI(ev.mbti_scores);
                const coherenceEnneagramme = getCoh√©renceEnn√©agramme(ev.enneagram_scores);
                return {
                    relation: ev.relation,
                    mbti: mbtiType,
                    enneagram: enneagramType,
                    coherenceMBTI,
                    coherenceEnneagramme,
                    completed: true,
                    completedAt: ev.created_at
                };
            });
            const certaintyScore = result.overallCertainty ??
                (result.user.certainty_score != null ? Number(result.user.certainty_score) : null);
            const finalProfile = {
                uniqueCode: userCode,
                name: `${result.user.mbti_type} ‚Äî type ${result.user.enneagram_type}`,
                self: { mbti: selfProfile.mbtiType, enneagram: selfProfile.enneagramType },
                results: {
                    mbti: result.user.mbti_type,
                    mbtiCertainty: result.mbtiCertainty ?? certaintyScore,
                    enneagram: result.user.enneagram_type,
                    enneagramCertainty: result.enneagramCertainty ?? certaintyScore,
                    overallCertainty: certaintyScore
                },
                externalEvaluations: externalProfiles,
                mbtiScores: result.user.mbti_scores,
                enneagramScores: result.user.enneagram_scores,
                externalCount: result.evaluations.length
            };
            closeProfileModal();
            displayDetailedResults(finalProfile, userCode);
        }

        function displayDetailedResults(profile, code) {
            // Cr√©er une nouvelle modale pour les r√©sultats
            const resultsModal = document.createElement('div');
            resultsModal.id = 'results-modal';
            resultsModal.className = 'modal show';
            resultsModal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2 class="text-xl font-bold text-gray-900">R√©sultats D√©taill√©s - ${profile.name}</h2>
                        <span class="close" onclick="closeResultsModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-6">
                            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                                <i class="fas fa-chart-pie text-green-600 text-2xl"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Analyse Compl√®te</h3>
                            <p class="text-sm text-gray-500">Code: <span class="font-mono font-bold">${code}</span></p>
                        </div>

                        <!-- R√©sultats MBTI et Enn√©agramme -->
        <div class="grid md:grid-cols-2 gap-6 mb-6">
          <div class="bg-blue-50 rounded-lg p-4">
            <h4 class="font-semibold text-blue-900 mb-2">Type MBTI</h4>
            <div class="text-2xl font-bold text-blue-600 mb-2">${profile.results.mbti}</div>
            <div class="mt-2">
              ${
                profile.results.mbtiCertainty != null
                  ? `<p class="mb-1">Certitude</p>
                     <div class="relative w-full bg-gray-200 h-6 rounded overflow-hidden" data-aos="fade-right">
                       <div class="certainty-bar absolute left-0 top-0 h-full rounded bg-blue-500 transition-all duration-1000" data-width="${profile.results.mbtiCertainty}" style="width:0"></div>
                       <span class="absolute w-full text-center text-white font-bold text-sm leading-6">${profile.results.mbtiCertainty}%</span>
                     </div>`
                  : `<p>Certitude : Donn√©es en cours...</p>`
              }
            </div>
          </div>
          <div class="bg-purple-50 rounded-lg p-4">
            <h4 class="font-semibold text-purple-900 mb-2">Enn√©agramme</h4>
            <div class="text-2xl font-bold text-purple-600 mb-2">${profile.results.enneagram}</div>
            <div class="mt-2">
              ${
                profile.results.enneagramCertainty != null
                  ? `<p class="mb-1">Certitude</p>
                     <div class="relative w-full bg-gray-200 h-6 rounded overflow-hidden" data-aos="fade-right">
                       <div class="certainty-bar absolute left-0 top-0 h-full rounded bg-purple-500 transition-all duration-1000" data-width="${profile.results.enneagramCertainty}" style="width:0"></div>
                       <span class="absolute w-full text-center text-white font-bold text-sm leading-6">${profile.results.enneagramCertainty}%</span>
                     </div>`
                  : `<p>Certitude : Donn√©es en cours...</p>`
              }
            </div>
          </div>
        </div>

        <!-- Certitude globale -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          ${
            profile.results.overallCertainty != null
              ? `<p class="mb-1">Certitude globale</p>
                 <div class="relative w-full bg-gray-200 h-6 rounded overflow-hidden" data-aos="fade-right">
                   <div class="certainty-bar absolute left-0 top-0 h-full rounded bg-green-500 transition-all duration-1000" data-width="${profile.results.overallCertainty}" style="width:0"></div>
                   <span class="absolute w-full text-center text-white font-bold text-sm leading-6">${profile.results.overallCertainty}%</span>
                 </div>`
              : `<p>Certitude : Donn√©es en cours...</p>`
          }
          <p class="text-sm text-gray-600 mt-2">Bas√© sur les √©valuations de vos proches</p>
          ${profile.externalCount < 3 ? `<p class="text-sm text-yellow-700 mt-2">üîé Augmentez votre niveau de certitude en compl√©tant les 3 √©valuations externes (famille, partenaire, ami ou coll√®gue).</p>` : ''}
        </div>


        <!-- Graphiques MBTI & Enn√©agramme -->
        <div class="grid md:grid-cols-2 gap-6 mb-6">
          <div class="bg-white rounded-lg p-4">
            <h4 class="font-semibold text-gray-900 mb-3">Dichotomies MBTI</h4>
            <canvas id="mbtiChart" height="220"></canvas>
          </div>
          <div class="bg-white rounded-lg p-4">
            <h4 class="font-semibold text-gray-900 mb-3">Types Enn√©agramme</h4>
            <canvas id="enneagramChart" height="220"></canvas>
          </div>
        </div>

        <div id="ai-profile-summary" class="mt-6 bg-gray-50 rounded-lg p-5 shadow-sm mb-6">
            <h4 class="font-semibold text-gray-900 text-lg mb-3">Description succincte du profil par Psycho'Bot</h4>
            <div id="ai-summary-content" class="relative text-sm leading-relaxed text-gray-700 max-h-80 overflow-y-auto">
                G√©n√©ration en cours‚Ä¶
                <div id="scroll-indicator" aria-hidden="true" class="pointer-events-none hidden absolute inset-x-0 bottom-0 h-10 bg-gradient-to-b from-transparent to-white flex items-end justify-center pb-1 text-gray-500">
                    <span class="text-xl animate-bounce">‚åÑ</span>
                </div>
            </div>
        </div>

                            <!-- D√©tail des √©valuations -->
                        <div class="mb-6">
                            <h4 class="font-semibold text-gray-900 mb-3">D√©tail des √©valuations</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                    <div>
                                        <span class="text-sm font-medium text-gray-700">Auto-√©valuation</span>
                                        <div class="text-xs text-gray-500">${profile.self.mbti} ‚Äî type ${profile.self.enneagram}</div>
                                    </div>
                                    <span class="text-sm text-green-600 font-medium">‚úì Compl√©t√©e</span>
                                </div>
                                ${profile.externalEvaluations.map(eval => `
                                    <div class="flex items-center justify-between p-3 ${eval.completed ? 'bg-green-50' : 'bg-gray-50'} rounded-lg">
                                        <div>
                                            <span class="text-sm font-medium text-gray-700">${eval.relation}</span>
                                            <div class="text-xs text-gray-500">${eval.mbti} ‚Äî type ${eval.enneagram} ‚Äî MBTI : <strong>Coh√©rence ${eval.coherenceMBTI}</strong> ‚Äî Enn√©agramme : <strong>Coh√©rence ${eval.coherenceEnneagramme}</strong></div>
                                        </div>
                                        <span class="text-sm ${eval.completed ? 'text-green-600' : 'text-gray-500'} font-medium">
                                            ${eval.completed ? '‚úì Compl√©t√©e le ' + new Date(eval.completedAt).toLocaleDateString('fr-FR') : '‚è≥ En attente'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

<div class="mt-8 mb-6 p-4 rounded-lg bg-gray-100 border border-gray-300 text-xs text-gray-700 leading-relaxed">
  <p class="mb-2"><strong> Coh√©rence</strong> : d√©termine dans quelle mesure les r√©ponses d‚Äôun proche sont logiquement stables.</p>
  <ul class="list-disc list-inside space-y-1">
    <li><strong>Forte</strong> ‚Üí peu voire pas de contradictions, r√©ponses align√©es</li>
    <li><strong>Moyenne</strong> ‚Üí quelques h√©sitations ou contradictions</li>
    <li><strong>Faible</strong> ‚Üí r√©ponses peu coh√©rentes entre elles</li>
  </ul>
</div>

<div class="mt-6 mb-6 flex justify-center">
  <img src="nouveau logo.JPEG" alt="Logo Personnalit√© Compar√©e" class="h-24 object-contain opacity-90" />
</div>




                        <!-- Actions -->
                        <div class="flex space-x-3">
                            <button onclick="downloadResultsPDF('${code}')" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                <i class="fas fa-download mr-2"></i>
                                T√©l√©charger PDF
                            </button>
                            <button onclick="shareProfileResults('${code}')" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                                <i class="fas fa-share mr-2"></i>
                                Partager
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Ajouter la modale au DOM
            document.body.appendChild(resultsModal);
            initCountUp(resultsModal);

            // Animer les barres de certitude
            resultsModal.querySelectorAll('.certainty-bar').forEach(bar => {
                const width = bar.dataset.width;
                requestAnimationFrame(() => {
                    bar.style.width = width + '%';
                });
            });
            if (window.AOS) {
                AOS.refresh();
            }
            renderCharts(profile, resultsModal);
            initAiProfileSummary(profile, code);
        }

        function renderCharts(profile, container) {
            const mbtiCanvas = container.querySelector('#mbtiChart');
            const enneaCanvas = container.querySelector('#enneagramChart');
            const enoughEvaluations = profile.externalCount >= 3;
            const hasMbtiScores = profile.mbtiScores && Object.values(profile.mbtiScores).some(v => v > 0);
            const hasEnneaScores = profile.enneagramScores && Object.values(profile.enneagramScores).some(v => v > 0);

            if (!enoughEvaluations || !hasMbtiScores || !hasEnneaScores) {
                const message = document.createElement('p');
                message.className = 'text-sm text-gray-500 text-center';
                message.textContent = 'Donn√©es en attente (minimum 3 √©valuations externes requises).';
                if (mbtiCanvas) {
                    mbtiCanvas.remove();
                    mbtiCanvas.parentElement.appendChild(message.cloneNode(true));
                }
                if (enneaCanvas) {
                    enneaCanvas.remove();
                    enneaCanvas.parentElement.appendChild(message);
                }
                return;
            }

            const mbtiCtx = mbtiCanvas.getContext('2d');
            const mbtiPairs = [
                { label: 'E / I', a: 'E', b: 'I' },
                { label: 'S / N', a: 'S', b: 'N' },
                { label: 'T / F', a: 'T', b: 'F' },
                { label: 'J / P', a: 'J', b: 'P' }
            ];
            const mbtiData = mbtiPairs.map(pair => {
                const aScore = profile.mbtiScores[pair.a];
                const bScore = profile.mbtiScores[pair.b];
                const dominant = aScore > bScore ? pair.a : pair.b;
                const value = Math.round((Math.max(aScore, bScore) / (aScore + bScore)) * 100);
                return { label: pair.label, value, dominant };
            });
            const mbtiDescriptions = { E: 'Extraversion', I: 'Introversion', S: 'Sensation', N: 'Intuition', T: 'Pens√©e', F: 'Sentiment', J: 'Jugement', P: 'Perception' };
            Chart.register(ChartDataLabels);
            new Chart(mbtiCtx, {
                type: 'bar',
                data: {
                    labels: mbtiData.map(d => d.label),
                    datasets: [{
                        data: mbtiData.map(d => d.value),
                        backgroundColor: '#93C5FD',
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: { beginAtZero: true, max: 100 }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${mbtiDescriptions[mbtiData[ctx.dataIndex].dominant]}: ${ctx.parsed.x}%`
                            }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: (value, ctx) => `${value}% ${mbtiData[ctx.dataIndex].dominant}`
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutCubic'
                    }
                }
            });

            const enneaCtx = enneaCanvas.getContext('2d');
            const enneaLabels = Object.keys(profile.enneagramScores).sort();
            const enneaValues = enneaLabels.map(k => Math.round(profile.enneagramScores[k]));
            const maxIndex = enneaValues.indexOf(Math.max(...enneaValues));
            const enneaColors = enneaValues.map((v, i) => i === maxIndex ? '#A855F7' : '#D8B4FE');
            const enneagramDescriptions = {
                1: 'Le R√©formateur',
                2: "L'Altruiste",
                3: 'Le Performeur',
                4: "L'Individualiste",
                5: "L'Investigateur",
                6: 'Le Loyaliste',
                7: "L'√âpicurien",
                8: 'Le Chef',
                9: 'Le M√©diateur'
            };
            new Chart(enneaCtx, {
                type: 'bar',
                data: {
                    labels: enneaLabels.map(t => `Type ${t}`),
                    datasets: [{
                        data: enneaValues,
                        backgroundColor: enneaColors,
                        borderColor: enneaValues.map((v, i) => i === maxIndex ? '#7C3AED' : 'transparent'),
                        borderWidth: enneaValues.map((v, i) => i === maxIndex ? 2 : 0),
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: { beginAtZero: true, max: 100 }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.parsed.x}% - ${enneagramDescriptions[enneaLabels[ctx.dataIndex]]}`
                            }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: value => `${value}%`
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        function setupScrollIndicator(container) {
            if (!container || container.__scrollIndicatorInitialized) return;
            const indicator = container.querySelector('#scroll-indicator');
            if (!indicator) return;

            const update = () => {
                const needsScroll = container.scrollHeight > container.clientHeight + 1;
                const scrolled = container.scrollTop > 8;
                const atBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 4;
                if (needsScroll && !scrolled && !atBottom) {
                    indicator.classList.remove('hidden');
                } else {
                    indicator.classList.add('hidden');
                }
            };

            container.addEventListener('scroll', update);
            window.addEventListener('resize', update);
            const observer = new MutationObserver(() => requestAnimationFrame(update));
            observer.observe(container, { childList: true, characterData: true, subtree: true });

            container.__scrollIndicatorInitialized = true;
            requestAnimationFrame(update);
        }

        async function initAiProfileSummary(profile, code) {
            const container = document.querySelector('#results-modal #ai-summary-content');
            if (!container || container.dataset.loading === '1') return;

            const { mbti, enneagram } = profile.results || {};
            const cacheKey = `ai-summary:${code}:${mbti}:${enneagram}`;
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                console.info('[AI Summary]', 'cache hit', cacheKey);
                container.textContent = cached;
                setupScrollIndicator(container);
                return;
            }

            console.info('[AI Summary]', 'cache miss', cacheKey);
            container.setAttribute('data-loading', '1');

            let messages = [
                { role: 'system', content: 'Tu es un psychologue p√©dagogique. √âcris en fran√ßais, clair et nuanc√©, sans jargon.' },
                { role: 'user', content: `Profil combin√© : MBTI=${mbti}, Enn√©agramme=${enneagram}.\nR√©dige une description concise (max 150 mots) :\n1) forces principales, 2) point faible r√©current, 3) piste d‚Äôam√©lioration.\nLangage clair, ton positif, phrases courtes.` }
            ];

            let totalText = '';
            let attempts = 0;

            while (true) {
                try {
                    const response = await fetch('/api/psy-results', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ messages })
                    });

                    if (!response.ok) throw new Error('bad response');
                    const data = await response.json();
                    totalText += data.content || '';

                    if (data.finish_reason && data.finish_reason !== 'stop') {
                        messages.push({ role: 'assistant', content: data.content || '' });
                        messages.push({ role: 'user', content: 'continue' });
                        continue;
                    }

                    const finalText = totalText.trim();
                    container.textContent = finalText || "Description indisponible pour le moment.";
                    if (finalText) localStorage.setItem(cacheKey, finalText);
                    break;
                } catch (e) {
                    console.error('Erreur IA:', e);
                    attempts++;
                    if (attempts < 2) {
                        container.textContent = "√âchec de la g√©n√©ration, nouvelle tentative‚Ä¶";
                        continue;
                    }
                    container.textContent = "Impossible de terminer la description";
                    break;
                }
            }

            container.removeAttribute('data-loading');
            setupScrollIndicator(container);
        }

        function closeResultsModal() {
            const modal = document.getElementById('results-modal');
            if (modal) {
                modal.remove();
            }
        }

        function downloadResultsPDF(code) {
            const modal = document.getElementById('results-modal');
            if (!modal) return;

            const clone = modal.cloneNode(true);

            const actions = clone.querySelector('.flex.space-x-3');
            if (actions) actions.remove();

            const canvases = modal.querySelectorAll('canvas');
            const cloneCanvases = clone.querySelectorAll('canvas');
            canvases.forEach((canvas, idx) => {
                const img = document.createElement('img');
                img.src = canvas.toDataURL('image/png');
                const rect = canvas.getBoundingClientRect();
                img.style.width = rect.width + 'px';
                img.style.height = rect.height + 'px';
                cloneCanvases[idx].replaceWith(img);
            });

            clone.style.position = 'absolute';
            clone.style.left = '-9999px';
            document.body.appendChild(clone);

            const element = clone.querySelector('.modal-content');
            const opt = {
                margin: 0,
                filename: 'ma-personnalite-comparee.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                document.body.removeChild(clone);
            });
        }

        async function shareProfileResults(code) {
            // R√©cup√©rer le profil final √† partager
            const result = await fetchUserProfileFromSupabase(code);
            if (!result || !result.user.mbti_type || !result.user.enneagram_type) {
                alert('Impossible de partager : le profil complet n‚Äôest pas encore disponible.');
                return;
            }
            const overallCertainty = result.user.certainty_score ?? 0;
            const shareText = `Je viens de d√©couvrir mon profil de personnalit√© complet ! Je suis ${result.user.mbti_type} (type ${result.user.enneagram_type}) avec ${overallCertainty}% de certitude. D√©couvrez le v√¥tre sur https://personnalite-comparee.fr`;
            if (navigator.share) {
                navigator.share({
                    title: 'Mon profil de personnalit√©',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('R√©sultats copi√©s dans le presse-papiers !');
                }).catch(() => {
                    prompt('Copiez ce message pour le partager:', shareText);
                });
            }
        }


        // Fermer la modale en cliquant √† l'ext√©rieur
        window.onclick = function(event) {
            const profileModal = document.getElementById('profile-modal');
            const resultsModal = document.getElementById('results-modal');
            
            if (event.target === profileModal) {
                closeProfileModal();
            }
            if (event.target === resultsModal) {
                closeResultsModal();
            }
        }

        // Permettre la saisie du code avec Entr√©e
        document.addEventListener('DOMContentLoaded', function() {
            const profileCodeInput = document.getElementById('profile-code');
            if (profileCodeInput) {
                profileCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkProfileCode();
                    }
                });
                
                // Forcer la saisie en majuscules
                profileCodeInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase();
                });
            }
        });
    </script>

    <!-- Modales pour les descriptions d√©taill√©es -->
    <div id="modal-container"></div>

    <!-- Modale Espace Personnel -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="text-xl font-bold text-gray-900">Mon Espace Personnel</h2>
                <span class="close" onclick="closeProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- √âtape 1: Saisie du code -->
                <div id="code-input-step" class="profile-step">
                    <div class="text-center mb-6">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                            <i class="fas fa-key text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Acc√©dez √† votre profil</h3>
                        <p class="text-sm text-gray-500">Entrez votre code unique pour consulter vos r√©sultats</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="profile-code" class="block text-sm font-medium text-gray-700 mb-2">Code unique</label>
                            <input type="text" id="profile-code" placeholder="Entrez votre code (ex: ABC123)" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-center text-lg font-mono tracking-wider uppercase">
                        </div>
                        <button onclick="checkProfileCode()" class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i class="fas fa-sign-in-alt mr-2"></i>
                            Acc√©der √† mon profil
                        </button>
                    </div>
                </div>

                <!-- √âtape 2: Statut des √©valuations -->
                <div id="profile-status-step" class="profile-step" style="display: none;">
                    <div class="text-center mb-6">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                            <i class="fas fa-user-circle text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Profil de <span id="profile-name"></span></h3>
                        <p class="text-sm text-gray-500">Code: <span id="display-code" class="font-mono font-bold"></span></p>
                    </div>

                    <!-- Statut des √©valuations -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="font-medium text-gray-900 mb-3">Statut des √©valuations</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Votre auto-√©valuation</span>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <i class="fas fa-check mr-1"></i> Termin√©e
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">√âvaluations des proches</span>
                                <span id="evaluations-status" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium">
                                    <!-- Sera rempli dynamiquement -->
                                </span>
                            </div>
                        </div>
                        
                        <!-- Barre de progression -->
                        <div class="mt-4">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Progression globale</span>
                                <span id="progress-text">0/4 termin√©</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Message selon le statut -->
                    <div id="status-message" class="rounded-lg p-4 mb-4">
                        <!-- Sera rempli dynamiquement -->
                    </div>

                    <!-- Actions -->
                    <div class="flex space-x-3">
                        <button onclick="shareProfileCode()" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            <i class="fas fa-share mr-2"></i>
                            Partager mon code
                        </button>
                        <button id="view-results-btn" onclick="viewResults()" class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" style="display: none;">
                            <i class="fas fa-chart-pie mr-2"></i>
                            Voir mes r√©sultats
                        </button>
                    </div>
                </div>

                <!-- Message d'erreur -->
                <div id="error-message" class="profile-step" style="display: none;">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Code introuvable</h3>
                        <p class="text-sm text-gray-500 mb-4">Le code que vous avez entr√© n'existe pas ou est incorrect.</p>
                        <button onclick="resetProfileModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            R√©essayer
                        </button>
                    </div>
                </div>
    </div>
        </div>
    </div>

<script>
  const LIMIT_MESSAGE = "Tu as atteint ta limite de 10 messages pour aujourd‚Äôhui ü§ñ<br>Psycho‚ÄôBot a besoin de recharger ses batteries neuronales !<br>Reviens demain‚Ä¶ ou discute avec mon grand fr√®re sur chat.openai.com üòÑ";

  async function sendChatMessage(message) {
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'gpt-5-mini',
          messages: [
            { role: 'system', content: 'Tu es un assistant sp√©cialis√© en MBTI et Enn√©agramme.' },
            { role: 'user', content: message }
          ]
        })
      });

      if (response.status === 429) {
        return { message: LIMIT_MESSAGE, limitError: true };
      }

      if (!response.ok) {
        console.error("Erreur de l‚ÄôAPI OpenAI:", await response.text());
        return { message: "Impossible de contacter l'IA pour le moment." };
      }

      const data = await response.json();
      return { message: data.message || "R√©ponse vide de l'IA." };

    } catch (err) {
      console.error("Erreur r√©seau:", err);
      return { message: "Une erreur est survenue lors de la communication avec l'IA." };
    }
  }

  let currentTyped = null;
  let limitErrorShown = false;
  function safeScrollToBottom(el) {
    el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' });
  }

  function appendMessage(role, text, options = {}) {
    const { limitError = false } = options;
    if (limitError && limitErrorShown) return;
    if (limitError) limitErrorShown = true;
    const chatBox = document.getElementById('chat-box');
    if (!chatBox) return;
    const wrapper = document.createElement('div');
    wrapper.className = `chat-row ${role === 'user' ? 'user' : 'assistant'}`;
    const bubble = document.createElement('div');
    let classes = `chat-bubble ${role === 'user' ? 'user-bubble' : 'assistant-bubble'}`;
    if (limitError) classes += ' limit-error';
    bubble.className = classes;
    wrapper.appendChild(bubble);
    chatBox.appendChild(wrapper);
    safeScrollToBottom(chatBox);

    if (role === 'assistant') {
      if (currentTyped) {
        currentTyped.destroy();
        currentTyped.el.innerHTML =
          currentTyped.el.dataset.fullText || currentTyped.el.innerHTML;
      }
      bubble.dataset.fullText = text;
      const observer = new MutationObserver(() => safeScrollToBottom(chatBox));
      observer.observe(bubble, { childList: true, subtree: true, characterData: true });
      currentTyped = new Typed(bubble, {
        strings: [text],
        typeSpeed: 30,
        showCursor: false,
        loop: false,
        contentType: 'html',
        onStringTyped: () => {
          safeScrollToBottom(chatBox);
        },
        onComplete: () => {
          safeScrollToBottom(chatBox);
          currentTyped = null;
          observer.disconnect();
        },
      });
    } else {
      bubble.textContent = text;
    }

    safeScrollToBottom(chatBox);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const sendBtn = document.getElementById('chat-send');
    const input = document.getElementById('chat-input');
    const suggestionButtons = document.querySelectorAll('.suggestion-bubble');
    if (sendBtn && input) {
      const typingEl = document.getElementById('pc-typing-indicator');
      let showTimer;
      function showTyping() {
        if (!typingEl) return;
        typingEl.hidden = false;
        const chatBox = document.getElementById('chat-box');
        if (chatBox) {
          const atBottom = Math.abs(chatBox.scrollHeight - chatBox.clientHeight - chatBox.scrollTop) <= 5;
          if (atBottom) safeScrollToBottom(chatBox);
        }
      }
      function hideTyping() {
        if (typingEl) typingEl.hidden = true;
      }

      const sendMessage = async () => {
        const question = input.value.trim();
        if (!question) return;
        const suggestionContainer = document.getElementById('chat-suggestions');
        if (suggestionContainer) suggestionContainer.remove();
        appendMessage('user', question);
        input.value = '';
        clearTimeout(showTimer);
        let shown = false;
        showTimer = setTimeout(() => { showTyping(); shown = true; }, 200);
        try {
          const { message, limitError } = await sendChatMessage(question);
          appendMessage('assistant', message, { limitError });
        } catch (e) {
          console.error(e);
        } finally {
          clearTimeout(showTimer);
          if (shown) hideTyping();
        }
      };
      sendBtn.addEventListener('click', sendMessage);
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage();
        }
      });
      suggestionButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          input.value = btn.dataset.question || btn.textContent.trim();
          sendMessage();
        });
      });
    }
  });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const homeLinks = document.querySelectorAll('.scroll-top-link');
      const brand = document.getElementById('brand-home');

      function handleScrollTop(e) {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        document.body.classList.add('scroll-highlight');
        setTimeout(() => document.body.classList.remove('scroll-highlight'), 1000);
      }

      homeLinks.forEach(link => link.addEventListener('click', handleScrollTop));
      if (brand) brand.addEventListener('click', handleScrollTop);
    });
  </script>

  <script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = "https://swjnpvfkloubshksobau.supabase.co";
  const supabaseKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3am5wdmZrbG91YnNoa3NvYmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwOTUxMzEsImV4cCI6MjA2OTY3MTEzMX0.A6rnIJyfIIxDT0c2XW_zGeUXpdYCgBFd6MTzBGFZ-Cg";

  const supabase = createClient(supabaseUrl, supabaseKey);
  window.supabase = supabase;

  const externalForm = document.getElementById("external-form");

  const params = new URLSearchParams(window.location.search);
  const code = params.get("code")?.toUpperCase();
  const encodedCode = code ? encodeURIComponent(code) : null;

  if (encodedCode) {
    (async () => {
      if (externalForm) {
        externalForm.style.display = "none";
      }

      try {
        const { data: user, error } = await supabase
          .from("users")
          .select("id")
          .eq("code", encodedCode)
          .single();

        if (error || !user) {
          alert("Code invalide ou introuvable.");
          return;
        } else if (externalForm) {
          externalForm.style.display = "";
        }
      } catch (err) {
        console.error("Erreur lors de la v√©rification du code :", err);
        alert("Code invalide ou introuvable.");
        return;
      }
    })();
  }

  if (externalForm) {
    externalForm.addEventListener("submit", (e) => {
      e.preventDefault();
      alert("Merci pour votre participation. Les r√©sultats sont disponibles dans la section 'Mon profil'.");
      externalForm.reset();
      externalForm.style.display = "none";
    });
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 600,
    easing: 'ease-out',
    once: true
  });
</script>

<script>
(function(){
  const wrap = (()=>{
    // Essaie plusieurs s√©lecteurs raisonnables
    return document.querySelector('section#hero, section.hero, .hero, .banner, [data-hero]') ||
           [...document.querySelectorAll('section')].find(s => /vraiment|analyse/i.test(s.textContent)) ||
           document.body;
  })();

  // Si pas d√©j√† pr√©sent, injecte le canvas
  let canvas = document.getElementById('pc-constellation');
  if(!canvas){
    canvas = document.createElement('canvas');
    canvas.id = 'pc-constellation';
    wrap.prepend(canvas);
  }
  // Classe de position si n√©cessaire
  if(getComputedStyle(wrap).position === 'static'){ wrap.classList.add('pc-hero'); }

  const ctx = canvas.getContext('2d', { alpha: true });
  const DPR = Math.min(window.devicePixelRatio || 1, 2);

  const N = 110;              // nombre de points
  let LINK_DIST = 120;        // distance de connexion
  let MAX_LINKS = N;          // connexions maximales par point
  let BASE_OPACITY = 0.30;    // opacit√© maximale des lignes
  const mouse = { x:0, y:0, inside:false };
  const DRIFT = 0.013;                  // amplitude du drift autonome
  const ALLOW_DRIFT = matchMedia('(pointer: coarse)').matches;
  let pts = [], W=0, H=0;

  function resize(){
    const r = canvas.getBoundingClientRect();
    W = canvas.width  = Math.floor(r.width * DPR);
    H = canvas.height = Math.floor(r.height * DPR);
    canvas.style.width  = r.width + 'px';
    canvas.style.height = r.height + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    if(!pts.length){
      pts = Array.from({length:N}, ()=>({
        x: Math.random()*r.width,
        y: Math.random()*r.height,
        vx: (Math.random()-.5)*.25,
        vy: (Math.random()-.5)*.25
      }));
    }
  }

  function updateConnectivity(){
    if(window.innerWidth <= 768){
      LINK_DIST = 60;      // distance divis√©e par 2 sur mobile
      MAX_LINKS = 3;       // l√©g√®re augmentation des connexions pour la visibilit√©
      BASE_OPACITY = 0.80; // opacit√© renforc√©e pour mieux percevoir les lignes
    } else {
      LINK_DIST = 120;     // param√®tres d'origine sur desktop
      MAX_LINKS = N;
      BASE_OPACITY = 0.30; // opacit√© d'origine
    }
  }

  resize();
  updateConnectivity();
  addEventListener('resize', () => { resize(); updateConnectivity(); });

  // Suivi souris uniquement dans la banni√®re
  wrap.addEventListener('mouseenter', ()=>mouse.inside = true);
  wrap.addEventListener('mouseleave', ()=>mouse.inside = false);
  wrap.addEventListener('mousemove', e=>{
    const r = canvas.getBoundingClientRect();
    mouse.x = e.clientX - r.left;
    mouse.y = e.clientY - r.top;
  });

  let stop = matchMedia('(prefers-reduced-motion: reduce)').matches;
  matchMedia('(prefers-reduced-motion: reduce)').addEventListener?.('change', e=>{ stop = e.matches; });

  function frame(){
    if(stop) return; // respect R.M.
    const r = canvas.getBoundingClientRect();
    ctx.clearRect(0,0,r.width,r.height);

    // --- Move
    for(const p of pts){
      if(mouse.inside){
        const dx = mouse.x - p.x, dy = mouse.y - p.y;
        const d = Math.hypot(dx,dy) || 1;
        // Attraction "un cran au-dessus de mod√©r√©"
        const force = Math.min(0.035, 9/(d*d));
        p.vx += (dx/d)*force;
        p.vy += (dy/d)*force;
      } else if(ALLOW_DRIFT){
        // l√©ger mouvement autonome sur mobile
        p.vx += (Math.random()-.5)*DRIFT;
        p.vy += (Math.random()-.5)*DRIFT;
      }
      // friction + clamp
      p.vx *= 0.991; p.vy *= 0.991;
      const vmax = 1.2; // vitesse max
      const sp = Math.hypot(p.vx,p.vy);
      if(sp>vmax){ p.vx = p.vx/sp*vmax; p.vy = p.vy/sp*vmax; }

      p.x += p.vx; p.y += p.vy;
      if(p.x<0||p.x>r.width)  p.vx *= -1;
      if(p.y<0||p.y>r.height) p.vy *= -1;
    }

    // --- Lines
    ctx.lineWidth = 0.7;
    const linksCount = new Array(N).fill(0);
    for(let i=0;i<N;i++){
      for(let j=i+1;j<N;j++){
        const a=pts[i], b=pts[j];
        const dx=a.x-b.x, dy=a.y-b.y, d=Math.hypot(dx,dy);
        if(d<LINK_DIST && linksCount[i] < MAX_LINKS && linksCount[j] < MAX_LINKS){
          const o = 1 - d/LINK_DIST;
          ctx.strokeStyle = `rgba(59,130,246,${(o*BASE_OPACITY).toFixed(3)})`; // bleu #3B82F6
          ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
          linksCount[i]++;
          linksCount[j]++;
        }
      }
    }

    // --- Dots
    ctx.fillStyle = getComputedStyle(document.documentElement)
      .getPropertyValue('--pc-dot') || 'rgba(10,15,26,.62)';
    for(const p of pts){ ctx.beginPath(); ctx.arc(p.x,p.y,1.2,0,Math.PI*2); ctx.fill(); }

    requestAnimationFrame(frame);
  }
  frame();
})();
</script>
<style>
  /* Arrondis forc√©s pour la fen√™tre de chat et la zone de saisie */
  #chat-window {
    border-radius: 32px !important;
    overflow: hidden !important;
  }
  #chat-input {
    border-radius: 9999px 0 0 9999px !important;
  }
  #chat-send {
    border-radius: 0 9999px 9999px 0 !important;
  }
</style>

</body>
</html>



      
